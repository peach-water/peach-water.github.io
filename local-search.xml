<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>[æç¬‘]-ç‰›é©¬è¡¨</title>
    <link href="/2025/04/25/%E6%90%9E%E7%AC%91-%E7%89%9B%E9%A9%AC%E8%A1%A8/"/>
    <url>/2025/04/25/%E6%90%9E%E7%AC%91-%E7%89%9B%E9%A9%AC%E8%A1%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="ç‰›é©¬è¡¨"><a href="#ç‰›é©¬è¡¨" class="headerlink" title="ç‰›é©¬è¡¨"></a>ç‰›é©¬è¡¨</h1><p>&emsp;&emsp;è‡£æœ¬ç¤¾ç•œï¼Œèº¬è€•äºèŒåœºã€‚è‹Ÿå…¨å°å‘½ä¸èŒåœºï¼Œä¸æ±‚é—»è¾¾äºé«˜ç®¡ã€‚è€æ¿ä¸ä»¥è‡£é©½é’ï¼ŒçŒ¥è‡ªæ‰é¡¾ï¼Œä¸‰é¡¾è‡£äºå·¥ä½é—´ï¼Œå’¨è‡£ä»¥å·¥ä½œä¹‹äº‹ï¼Œç”±æ˜¯æ„Ÿæ¿€ï¼Œé‚è®¸è€æ¿ä»¥é©±é©°ã€‚<br>&emsp;&emsp;åå€¼é¡¹ç›®æ€¥ï¼Œå—ä»»åŠ¡äºå‹åŠ›ä¹‹é™…ã€‚å¥‰å‘½äºç†¬å¤œä¹‹é—´ï¼Œå°”æ¥åŠ ç­æ— æ•°çŸ£ï¼Œä»Šä»»åŠ¡ç»ˆäº†ï¼Œæˆæœåˆæ˜¾ï¼Œéš¾å…³çš†ç ´ï¼Œä¸è´Ÿè€æ¿ä¹‹æ‰€æ‰˜ã€‚æ­¤åå½“å‹¤å‹‰å¦‚æ—§ï¼Œä¸å…¬å¸æºæ‰‹å†åˆ›ä½³ç»©ã€‚</p><blockquote><p>çœŸçš„åº”äº†é‚£å¥è¯ï¼Œç ”ç©¶ç”Ÿåªæœ‰ä¸¤ä¸ªæ—¶åˆ»æ˜¯å¼€å¿ƒçš„ã€‚ä¸€ä¸ªæ˜¯å…¥å­¦çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªæ˜¯æ¯•ä¸šçš„æ—¶å€™ã€‚<br><br>å†™ç‚¹æ–‡å­—å‘å‘ç‰¢éªšã€‚</p></blockquote>]]></content>
    
    
    
    <tags>
      
      <tag>æç¬‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[æŠ˜è…¾]-Anything+Ollamaéƒ¨ç½²è‡ªå·±çš„å¤§æ¨¡å‹</title>
    <link href="/2025/01/09/%E6%8A%98%E8%85%BE-Anything-Ollama%E9%83%A8%E7%BD%B2%E8%87%AA%E5%B7%B1%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B/"/>
    <url>/2025/01/09/%E6%8A%98%E8%85%BE-Anything-Ollama%E9%83%A8%E7%BD%B2%E8%87%AA%E5%B7%B1%E7%9A%84%E5%A4%A7%E6%A8%A1%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è®°å½•åœ¨æœ¬åœ°åˆ©ç”¨Ollamaåç«¯å’ŒAnythingLLMå‰ç«¯ï¼Œéƒ¨ç½²è‡ªå·±ç§æœ‰åŒ–å¤§æ¨¡å‹çš„è¿‡ç¨‹ï¼Œæ–¹ä¾¿æ—¥åæŸ¥æ‰¾ã€‚<br>é‡‡ç”¨dockeré•œåƒå®‰è£…çš„å½¢å¼ï¼Œæ–¹ä¾¿ç®¡ç†å’Œç‰ˆæœ¬æ›´æ–°ã€‚</p><h1 id="ä¸€ã€å‰æœŸå‡†å¤‡"><a href="#ä¸€ã€å‰æœŸå‡†å¤‡" class="headerlink" title="ä¸€ã€å‰æœŸå‡†å¤‡"></a>ä¸€ã€å‰æœŸå‡†å¤‡</h1><blockquote><p>ç¡®ä¿ä¸»æœºä¸Šå®‰è£…æœ‰dockerï¼Œä¸”èƒ½æ­£å¸¸è®¿é—®docker hubå®˜ç½‘ï¼ˆæˆ–è€…è‡ªè¡Œæ›´æ”¹é•œåƒæºä½¿ç”¨å›½å†…é•œåƒç«™ï¼‰ã€‚<br><a href="https://github.com/brittlewis12/autogguf">Autogguf</a>æ˜¯å†™æ–‡æ¡£æ—¶ä½¿ç”¨çš„safetensorè½¬ggufå·¥å…·ã€‚å·¥å…·æœ‰å¯èƒ½é•¿ä¹…æ²¡æœ‰æ›´æ–°ï¼Œä¸ä¿è¯åœ¨å·¥å…·ä¹‹åçš„å¤§æ¨¡å‹å¯ä»¥è¢«å·¥å…·æ­£ç¡®è½¬æ¢ã€‚</p></blockquote><p>ä»docker hubå¤„è·å¾—<code>ollama</code>å’Œ<code>anythingllm</code>çš„æœ€æ–°ç‰ˆæœ¬é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull ollama/ollama:latest<br>docker pull minplexlabs/anythingllm:latest<br></code></pre></td></tr></table></figure><p>æœ‰äº›æ—¶å€™ï¼Œä¸»æœºæ˜¯<del>å®éªŒå®¤æœåŠ¡å™¨</del>ä¸å¤ªå¯èƒ½èƒ½ç›´è¿å¤–ç½‘ï¼Œéœ€è¦ç”¨è‡ªå·±çš„æœºå™¨å…ˆä¸‹è½½å¥½ç›¸å…³çš„é•œåƒå†ä¸Šä¼ ã€‚è¿™é‡Œè®°å½•dockerå¯¼å‡ºå’Œå¯¼å…¥é•œåƒçš„ä¸¤ç§æ–¹å¼ã€‚</p><h2 id="1ã€é•œåƒè¿ç§»"><a href="#1ã€é•œåƒè¿ç§»" class="headerlink" title="1ã€é•œåƒè¿ç§»"></a>1ã€é•œåƒè¿ç§»</h2><p>dockeræœ‰ä¸¤ç»„æŒ‡ä»¤ç”¨äºå®¹å™¨ä¸é•œåƒçš„è¿ç§»å·¥ä½œï¼Œå…¶ä¸­<code>export</code>å’Œ<code>import</code>ç”¨äºå®¹å™¨çš„å¯¼å‡ºä¸åŠ è½½ï¼Œ<code>save</code>å’Œ<code>load</code>ç”¨äºé•œåƒçš„å¯¼å‡ºä¸ä»·å€¼ï¼Œ<strong>æ³¨æ„ä¸è¦æ··ç”¨ä¸¤ç»„æŒ‡ä»¤</strong>ã€‚<br>è¿™é‡Œæˆ‘ä»¬åªæ˜¯ç”¨è‡ªå·±çš„æœºå™¨ä¸‹è½½äº†é•œåƒï¼Œæ²¡æœ‰å¯¹åŸå§‹é•œåƒåšä¿®æ”¹ï¼Œå› æ­¤ä½¿ç”¨<code>save</code>å’Œ<code>load</code>å‘½ä»¤ç»„ã€‚ä¸‹é¢çš„<code>[image ID]</code>è‡ªè¡Œä¿®æ”¹ä¸ºå®é™…IDï¼Œ<code>[XXX]</code>ä¿®æ”¹ä¸ºä»»æ„åå­—å‡å¯ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker save [image ID] -o [XXX].tar<br>æˆ–è€…<br>docker save [image ID] &gt; [XXX].tar<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨å„ç§å·¥å…·ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šåï¼Œåˆ©ç”¨<code>load</code>æŒ‡ä»¤åŠ è½½é•œåƒã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker load -i [XXX].tar<br>æˆ–è€…<br>docker load &lt; [XXX].tar<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼Œloadçš„é•œåƒæ˜¯æ²¡æœ‰å¯¹åº”çš„tagå’Œrepositoryåï¼Œéœ€è¦æ‰‹åŠ¨é‡æ–°æŒ‡å®šã€‚å¯¼å…¥é•œåƒæ—¶æœ€å¥½åŒæ—¶æŒ‡å®šé•œåƒåå­—ï¼Œå°†æ¥ä¾¿äºè¿›è¡Œé•œåƒçš„ç®¡ç†ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker tag [image ID] ollama/ollama:latest<br></code></pre></td></tr></table></figure><h1 id="äºŒã€å¯åŠ¨é•œåƒ"><a href="#äºŒã€å¯åŠ¨é•œåƒ" class="headerlink" title="äºŒã€å¯åŠ¨é•œåƒ"></a>äºŒã€å¯åŠ¨é•œåƒ</h1><p>anythingllmå¯åŠ¨é•œåƒï¼Œæ³¨æ„å¯¹äº<code>STORAGE_LOCATION</code>å˜é‡çš„èµ‹å€¼ï¼Œå°†æ¥çš„èŠå¤©è®°å½•ä»¥åŠè®¾ç½®ç­‰ç­‰é…ç½®æ–‡ä»¶å‡ä¼šå­˜æ”¾åœ¨å®¿ä¸»æœºçš„è¿™ä¸ªç›®å½•ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">export STORAGE_LOCATION=$HOME/anythingllm<br>mkdir -p $STORAGE_LOCATION<br>touch &quot;$STORAGE_LOCATION/.env&quot;<br>docker run -d -p 3001:3001 --cap-add SYS_ADMIN -v $&#123;STORAGE_LOCATION&#125;:/app/server/storage -v $&#123;STORAGE_LOCATION&#125;/.env:app/server/.env -e STORAGE_DIR=&quot;/app/server/storage&quot; mintplexlabs/anything<br></code></pre></td></tr></table></figure><p>ollamaå¯åŠ¨é•œåƒï¼Œæ³¨æ„<code>-v</code>å‚æ•°åé¢çš„<code>$HOME/ollama</code>æŒ‡å®šå®¿ä¸»æœºæ¨¡å‹æ–‡ä»¶å­˜æ”¾ä½ç½®ï¼Œ<code>/root/ollama</code>æ˜¯æ˜ å°„åˆ°å®¹å™¨å†…éƒ¨çš„ä½ç½®ï¼Œç¨ååœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰¾åˆ°å®¿ä¸»æœºå­˜æ”¾çš„æ¨¡å‹æ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -d -v $HOME/ollama:/root/ollama -p 11434:11434 --name ollama ollama/ollama:latest<br></code></pre></td></tr></table></figure><h1 id="ä¸‰ã€è½¬åŒ–æ¨¡å‹"><a href="#ä¸‰ã€è½¬åŒ–æ¨¡å‹" class="headerlink" title="ä¸‰ã€è½¬åŒ–æ¨¡å‹"></a>ä¸‰ã€è½¬åŒ–æ¨¡å‹</h1><blockquote><p>Ollamaä½¿ç”¨onnxä½œä¸ºå¤§æ¨¡å‹æ¨ç†åç«¯ï¼Œä½¿ç”¨çš„æ¨¡å‹æ–‡ä»¶æ ¼å¼ä¸ºonnxå®šä¹‰çš„<code>gguf</code>æ ¼å¼ã€‚ä¸€èˆ¬ä»HuggingFaceæˆ–è€…å…¶ä»–åœ°æ–¹ä¸‹è½½çš„æ˜¯<code>safetensor</code>æˆ–è€…<code>pt</code>çš„pytorchä¿å­˜æ ¼å¼ã€‚éœ€è¦ç»è¿‡è½¬åŒ–åæ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚</p><ul><li>é€‰æ‹©å·²ç»é‡åŒ–å¥½çš„æ¨¡å‹ä¸‹è½½ä¹Ÿæ˜¯ä¸€ç§é€”å¾„ã€‚</li><li>å…¶ä¸­ä½¿ç”¨ollamaæä¾›çš„æŒ‡ä»¤æ¥éƒ¨ç½²æ¨¡å‹ä¹Ÿæ˜¯ä¸€ç§æ–¹æ¡ˆã€‚ä¼˜ç‚¹æ˜¯ä¸éœ€è¦è‡ªå·±å»æŠ˜è…¾æ¨¡å‹æ ¼å¼è½¬åŒ–çš„é—®é¢˜ï¼›ç¼ºç‚¹æ˜¯ä¸ªæ€§åŒ–ç¨‹åº¦ä½ã€‚</li></ul></blockquote><p>è¿™é‡Œé€‰æ‹©<code>Qwen2.5</code>ä½œä¸ºç¤ºä¾‹ï¼Œä¸»è¦æ˜¯å› ä¸ºQwenåœ¨é˜¿é‡Œè‡ªå®¶çš„<a href="https://www.modelscope.cn/">modelscopeï¼ˆé­”æ­ï¼‰</a>ç¤¾åŒºä¸Šæœ‰å…¨å¥—ï¼Œä¸”æœåŠ¡å™¨åœ¨å›½å†…ï¼Œå®¹æ˜“ä¸‹è½½ã€‚<br><del>æœ¬æ–‡æ‰¾åˆ°é­”æ­ä¸€ä¸ªç”¨æˆ·ï¼Œä»–åˆ¶ä½œä¸€ç³»åˆ—Qwen2.5çš„GGUFä¼˜åŒ–æ¨¡å‹ã€‚å¹¶ä»ä¸­é€‰æ‹©7B-GGUF-V3-LOTæ ¼å¼ã€‚</del>æ–‡ç« å¾ˆæ—©å¼€å§‹å†™ï¼Œä½†æ˜¯å†™åˆ°ä¸€åŠå‘ç°æ–°å‘å¸ƒçš„deepseekç«éå…¨çƒï¼Œè¿™é‡Œç«é€Ÿæ”¹æˆ<a href="https://www.modelscope.cn/models/unsloth/DeepSeek-R1-Distill-Qwen-7B-GGUF">deepseekè’¸é¦çš„Qwen</a>ä½œä¸ºæ•™ç¨‹ã€‚<br>æ‰“å¼€é“¾æ¥ä¼šå‘ç°é‡Œé¢åŒ…å«å¤šä¸ªæ¨¡å‹ï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹å„ä¸ªåç¼€çš„é‡åŒ–å«ä¹‰ã€‚é¦–å…ˆæ¨¡å‹çš„åå­—<code>DeepSeek-R1-Distill-Qwen-7B</code>ï¼Œç„¶åæ˜¯å­—æ¯æ•°å­—å’Œä¸‹åˆ’çº¿æ„æˆçš„åç¼€ã€‚<br>åç¼€éµå¾ªç‰¹å®šçš„å‘½åçº¦å®šï¼šâ€œQâ€+æƒé‡çš„ç²¾åº¦ï¼ˆbitä½æ•°ï¼‰+ç‰¹å®šé‡åŒ–å˜ä½“ã€‚ä»¥ä¸‹ä¸¾ä¾‹å„ç§åç¼€ä»£è¡¨çš„å«ä¹‰ã€‚æ¥æº<a href="https://github.com/ggerganov/ggml/blob/master/docs/gguf.md">llama.cpp</a>ã€‚</p><ul><li>å®šä¹‰åŸºç¡€é‡åŒ–åç¼€<ul><li>F32ï¼šæƒé‡ä¸º32ä½æµ®ç‚¹æ•°</li><li>F16ï¼šæƒé‡ä¸º16ä½æµ®ç‚¹æ•°</li><li>Q4_0ï¼šä»£è¡¨ç¬¬0ç§ç±»å‹çš„4ä½é‡åŒ–ï¼Œ$w&#x3D;d*q$ï¼Œå…¶ä¸­$d$æ˜¯ç¼©æ”¾å› å­ã€‚</li><li>Q4_1ï¼šä»£è¡¨ç¬¬1ç§ç±»å‹çš„4ä½é‡åŒ–ï¼Œ$w&#x3D;d*q+m$ï¼Œå…¶ä¸­$d$æ˜¯ç¼©æ”¾å› å­ï¼Œ$m$æ˜¯ä¸€ä¸ªé‡åŒ–å—ä¸­æœ€å°çš„æ•°å­—ã€‚</li></ul></li><li>åŸºäºä»¥ä¸ŠåŸºç¡€åç¼€ç»„åˆ<ul><li>Kç³»åˆ—åç¼€<ul><li>äºŒé‡é‡åŒ–åŸºç¡€è¯´æ˜<ul><li>Q2_Kï¼šï¼ˆ1ç±»å‹ï¼‰å¯¹åŒ…å«16ä¸ªé‡åŒ–å—çš„è¶…çº§å—è¿›è¡Œ2bité‡åŒ–ï¼Œæ¯ä¸ªé‡åŒ–å—åŒ…å«16ä¸ªæƒé‡ï¼Œå—çš„$q$å’Œ$m$åˆ™æ˜¯4bitã€‚å¹³å‡<code>2.5625</code>bitæ¯ä¸ªæƒé‡å‚æ•°ã€‚</li><li>Q3_Kï¼šï¼ˆ0ç±»å‹ï¼‰å¯¹åŒ…å«16ä¸ªé‡åŒ–å—çš„è¶…çº§å—è¿›è¡Œ3bité‡åŒ–ï¼Œæ¯ä¸ªé‡åŒ–å—åŒ…å«16ä¸ªæƒé‡ï¼Œå—çš„$q$åˆ™æ˜¯6bitã€‚å¹³å‡<code>3.4375</code>bitæ¯ä¸ªæƒé‡å‚æ•°ã€‚</li><li>Q4_Kï¼šï¼ˆ1ç±»å‹ï¼‰å¯¹åŒ…å«8ä¸ªé‡åŒ–å—çš„è¶…çº§å—è¿›è¡Œ4bité‡åŒ–ï¼Œæ¯ä¸ªé‡åŒ–å—åŒ…å«32ä¸ªæƒé‡ï¼Œå—çš„$q$å’Œ$m$åˆ™æ˜¯6bitã€‚å¹³å‡<code>4.5</code>bitæ¯ä¸ªæƒé‡å‚æ•°ã€‚</li><li>Q5_Kï¼šï¼ˆ1ç±»å‹ï¼‰ç±»ä¼¼<code>Q4_K</code>ï¼Œå¹³å‡<code>5.5</code>bitæ¯ä¸ªæƒé‡å‚æ•°ã€‚</li><li>Q6_Kï¼šï¼ˆ0ç±»å‹ï¼‰å¯¹åŒ…å«16ä¸ªé‡åŒ–å—çš„è¶…çº§å—è¿›è¡Œ6bité‡åŒ–ï¼Œæ¯ä¸ªé‡åŒ–å—åŒ…å«16ä¸ªæƒé‡ï¼Œå—çš„$q$åˆ™æ˜¯8bitã€‚å¹³å‡<code>6.5625</code>bitæ¯ä¸ªæƒé‡å‚æ•°ã€‚</li><li>Q8_Kï¼šï¼ˆ0ç±»å‹ï¼‰ç›¸æ¯”<code>Q8_0</code>é‡åŒ–ï¼Œå—å¤§å°å˜æˆ256ï¼Œä¸”æ‰€æœ‰çš„ç‚¹ç§¯ç»“æœéƒ½è¢«é‡åŒ–åˆ°2-6bitã€‚</li></ul></li><li>åŸºäºKç³»åˆ—åç¼€çš„æ··åˆé‡åŒ–è¯´æ˜<a href="https://github.com/ggerganov/llama.cpp/pull/1684">issue1684</a><ul><li>LLM-Q2_Kï¼šç”¨<code>Q4_K</code>é‡åŒ–<code>attention.wv</code>å’Œ<code>feed_forward.w2</code>ï¼Œå…¶ä½™éƒ¨åˆ†ç”¨<code>Q2_K</code>è¿›è¡Œé‡åŒ–ã€‚</li><li>LLM-Q3_K_Sï¼šä½¿ç”¨<code>Q3_K</code>é‡åŒ–æ‰€æœ‰å¼ é‡ã€‚</li><li>LLM-Q3_K_Mï¼šç”¨<code>Q4_K</code>é‡åŒ–<code>attention.wv</code>ï¼Œ<code>attention.wo</code>å’Œ<code>feed_forward.w2</code>ï¼Œå…¶ä½™éƒ¨åˆ†ç”¨<code>Q3_K</code>é‡åŒ–ã€‚</li><li>LLM-Q3_K_Lï¼šç”¨<code>Q5_K</code>é‡åŒ–<code>attention.wv</code>ï¼Œ<code>attention.wo</code>å’Œ<code>feed_forward.w2</code>ï¼Œå…¶ä½™éƒ¨åˆ†ç”¨<code>Q3_K</code>ã€‚</li><li>LLM-Q4_K_Sï¼šä½¿ç”¨<code>Q4_K</code>é‡åŒ–æ‰€æœ‰å¼ é‡ã€‚</li><li>LLM-Q4_K_Mï¼šä½¿ç”¨<code>Q6_K</code>é‡åŒ–<code>attention.wv</code>å’Œ<code>feed_forward.w2</code>ä¸€åŠçš„å¼ é‡ï¼Œå…¶ä½™éƒ¨åˆ†ç”¨<code>Q4_K</code>ã€‚</li><li>LLM-Q5_K_Sï¼šç”¨<code>Q5_K</code>é‡åŒ–æ‰€æœ‰å¼ é‡ã€‚</li><li>LLM-Q5_K_Mï¼šä½¿ç”¨<code>Q6_K</code>é‡åŒ–<code>attention.wv</code>å’Œ<code>feed_forward.w2</code>ä¸€åŠçš„å¼ é‡ï¼Œå…¶ä½™éƒ¨åˆ†ç”¨<code>Q5_K</code>ã€‚</li><li>LLM-Q6_Kï¼šä½¿ç”¨6bitçš„<code>Q8_K</code>é‡åŒ–æ‰€æœ‰æƒé‡ã€‚</li></ul></li></ul></li><li>IQç³»åˆ—ï¼Œå¸¦é‡è¦æ€§çŸ©é˜µçš„é‡åŒ–<a href="https://github.com/ggerganov/llama.cpp/pull/4773">SOTA 2-bit quants by ikawrakow Â· Pull Request #4773 Â· ggerganov&#x2F;llama.cpp Â· GitHub</a></li></ul></li><li></li></ul><h1 id="å››ã€é…ç½®è°ƒè¯•"><a href="#å››ã€é…ç½®è°ƒè¯•" class="headerlink" title="å››ã€é…ç½®è°ƒè¯•"></a>å››ã€é…ç½®è°ƒè¯•</h1><p>é…ç½®æœŸé—´å¯èƒ½éœ€è¦å¯åŠ¨å¤šä¸ªç»ˆç«¯ä»¥åŒæ—¶å¼€å±•å¤šä¸ªå·¥ä½œï¼Œè¿™é‡Œè®°å½•ä¸‹å¦‚ä½•åœ¨ä¸€ä¸ªå®¹å™¨å†…å¯åŠ¨å¤šä¸ªç»ˆç«¯çš„æ–¹æ³•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> docker <span class="hljs-built_in">exec</span> -it [CONTAINER] bash<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>æŠ˜è…¾</tag>
      
      <tag>LLM</tag>
      
      <tag>éƒ¨ç½²åº”ç”¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[æŠ˜è…¾]CUDA11.7ä¹Ÿè¦ç©LLM</title>
    <link href="/2024/11/19/%E6%8A%98%E8%85%BE-CUDA11-7%E4%B9%9F%E8%A6%81%E7%8E%A9LLM/"/>
    <url>/2024/11/19/%E6%8A%98%E8%85%BE-CUDA11-7%E4%B9%9F%E8%A6%81%E7%8E%A9LLM/</url>
    
    <content type="html"><![CDATA[<h1 id="é›¶ã€èµ·å› "><a href="#é›¶ã€èµ·å› " class="headerlink" title="é›¶ã€èµ·å› "></a>é›¶ã€èµ·å› </h1><p>åœ¨è¶…ç®—ä¸­å¿ƒçš„è®¡ç®—èŠ‚ç‚¹ä¸Šç ”ç©¶LLMæ¨ç†ä¸è®­ç»ƒï¼Œå¹¶æµ‹è¯•ä¸€äº›æ¨¡å‹ã€‚ç„¶è€Œè¶…ç®—ä¸­å¿ƒè®¡ç®—èŠ‚ç‚¹é‚£æ˜¯â€œç›¸å½“å…ˆè¿›â€ï¼Œæ— è®º3090-24GBè¿˜æ˜¯A10-24GBéƒ½æ˜¯ CUDA 11.7 ç‰ˆæœ¬ï¼Œå”¯ä¸€è¾ƒå¥½çš„ CUDA 11.8 çš„ A100-40GB è®¡ç®—èŠ‚ç‚¹ä¸€ç›´æ— æ³•ä½¿ç”¨ã€‚</p><blockquote><p><font color="#ff0000">CUDA 11.7</font> å’Œ <font color="#ff0000">CUDA 11.8</font> æ˜¯ pytorch çš„ä¸€ä¸ªåˆ†æ°´å²­ï¼Œä» <code>torch 2.1.0</code> å¼€å§‹ä¸æ”¯æŒ CUDA11.7 ï¼Œç„¶è€Œå¾ˆå¤šLLMçš„æ–°æŠ€æœ¯åœ¨ <code>torch 2.1.0</code> ä»¥åå¼€å§‹è¢«å¼•å…¥ï¼Œä¾‹å¦‚ <code>sparce attention</code> <code>flash attention</code> ç­‰ç­‰åŠ é€Ÿå¤§æ¨¡å‹æ¨ç†çš„æŠ€æœ¯ã€‚</p></blockquote><p>å› ä¸ºæ²¡æœ‰åˆé€‚çš„ torch ç‰ˆæœ¬ï¼Œå› æ­¤å†³å®šè‡ªå·±åŠ¨æ‰‹ç¼–ä¸€ä¸ª <code>CUDA 11.7</code> ç‰ˆæœ¬çš„ <code>torch 2.3.0</code> ï¼ˆç†è®ºä¸Šå¯è¡Œï¼‰è¸©å‘è®°å½•å¦‚ä¸‹ï¼š<a href="https://peach-water.github.io/2024/09/18/%E6%8A%98%E8%85%BE-%E7%BC%96%E8%AF%91pytorch/">æŠ˜è…¾-ç¼–è¯‘pytorch</a> ã€‚</p><h1 id="ä¸€ã€ç¯å¢ƒå®‰è£…"><a href="#ä¸€ã€ç¯å¢ƒå®‰è£…" class="headerlink" title="ä¸€ã€ç¯å¢ƒå®‰è£…"></a>ä¸€ã€ç¯å¢ƒå®‰è£…</h1><h2 id="1ã€Vllm-æ¨ç†å¼•æ“"><a href="#1ã€Vllm-æ¨ç†å¼•æ“" class="headerlink" title="1ã€Vllm æ¨ç†å¼•æ“"></a>1ã€Vllm æ¨ç†å¼•æ“</h2><p>ä½¿ç”¨ <a href="https://github.com/hiyouga/LLaMA-Factory">llamafactory</a> æ”¯æŒ <code>transformers</code> å’Œ <code>vllm</code> è¿™ä¸¤ä¸ªæ¨ç†å¼•æ“ï¼Œä¸è¿‡æ¯”è¾ƒå¯æƒœï¼Œ<code>vllm</code> å®˜æ–¹ä»…æ”¯æŒ CUDA 11.8ï¼Œå› æ­¤è¿™ä¸ªæ¨ç†å¼•æ“åº”è¯¥æ˜¯ç”¨ä¸äº†äº†ï¼Œå¦‚æœä¸ç”¨ CUDA é‚£ä¹ˆä½¿ç”¨è¿™ä¸ªå¼•æ“æ²¡æœ‰æ„ä¹‰ã€‚</p><h1 id="äºŒã€é”™è¯¯ä¿®å¤"><a href="#äºŒã€é”™è¯¯ä¿®å¤" class="headerlink" title="äºŒã€é”™è¯¯ä¿®å¤"></a>äºŒã€é”™è¯¯ä¿®å¤</h1><h2 id="1ã€RuntimeError-â€œtriu-tril-cuda-templateâ€-not-implemented-for-â€˜BFloat16â€™"><a href="#1ã€RuntimeError-â€œtriu-tril-cuda-templateâ€-not-implemented-for-â€˜BFloat16â€™" class="headerlink" title="1ã€RuntimeError: â€œtriu_tril_cuda_templateâ€ not implemented for â€˜BFloat16â€™"></a>1ã€RuntimeError: â€œtriu_tril_cuda_templateâ€ not implemented for â€˜BFloat16â€™</h2><p>é”™è¯¯åˆ†æï¼šè¿™æ˜¯ <code>torch 2.1.0</code> ä»¥å‰å¯¹ <code>triu</code> å’Œ <code>tril</code> è¿™ä¸¤ä¸ªçš„ CUDA ç®—å­ç¼ºå°‘å®ç°å¯¼è‡´çš„é”™è¯¯ã€‚<br>è§£å†³æ–¹æ¡ˆï¼š<font color="ffff00">â‘ </font>æœ€ä¼˜çš„å½“ç„¶å°±æ˜¯ç›´æ¥å®‰è£…æœ€æ–°ç‰ˆ torch ã€‚ç„¶è€Œæ­£å¦‚å‰é¢æåˆ°çš„ï¼Œ<code>torch 2.1.0</code> å®˜æ–¹ä¸æ”¯æŒ CUDA 11.7 ã€‚</p><p><font color="ffff00">â‘¡</font>æ¬¡ä¼˜çš„è§£å†³æ–¹æ¡ˆï¼Œè¿è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼Œå¯ä»¥å®‰è£…ä¸€ä¸ª pytorch çš„ 2.1.0 é¢„è§ˆç‰ˆï¼Œè§£å†³ä¸Šè¿°é—®é¢˜ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip3 install numpy --pre torch --force-reinstall --index-url https://download.pytorch.org/whl/nightly/cu117<br></code></pre></td></tr></table></figure><p>å½“ç„¶è¿™ä¼šå¯¼è‡´ torchvision å’Œ torchaudio è¿™ä¸¤ä¸ªåº“çš„ä¸åŒ¹é…ï¼Œä¸è¿‡åæ­£ç”¨ä¸ä¸Šä¹Ÿå°±æ— æ‰€è°“äº†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>æŠ˜è…¾</tag>
      
      <tag>LLM</tag>
      
      <tag>CUDA</tag>
      
      <tag>Pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[æŠ˜è…¾]ç¼–è¯‘ merlin compiler</title>
    <link href="/2024/11/15/%E6%8A%98%E8%85%BE-%E7%BC%96%E8%AF%91-merlin-compiler/"/>
    <url>/2024/11/15/%E6%8A%98%E8%85%BE-%E7%BC%96%E8%AF%91-merlin-compiler/</url>
    
    <content type="html"><![CDATA[<p>èƒŒæ™¯ï¼šä¸ºäº†æµ‹è¯• HLS ï¼Œéœ€è¦ merlin compiler è¿™ä¸ª VLS ç¼–è¯‘å™¨ã€‚è¿™ä¸ªåº“éœ€è¦ <code>gcc 4.9.4</code> <code>llvm6</code> ä»¥åŠ</p><h1 id="é›¶ã€é˜…è¯»é¡»çŸ¥"><a href="#é›¶ã€é˜…è¯»é¡»çŸ¥" class="headerlink" title="é›¶ã€é˜…è¯»é¡»çŸ¥"></a>é›¶ã€é˜…è¯»é¡»çŸ¥</h1><p>âš å…ˆå¼„å¥½å¥½gcc4.9.4ç„¶åå¼€å§‹åé¢<code>llvm</code>ã€<code>boost</code>ã€<code>clang</code>åº“çš„å¤„ç†ã€‚<br>è¿™æ˜¯ä¸€ä¸ªè€é¡¹ç›®äº†ï¼Œä¸ç¡®å®šä½¿ç”¨æœ€æ–°çš„åº“æ–‡ä»¶æ˜¯å¦æ­£å¸¸ç¼–è¯‘ã€‚ä¸”æœ¬æ•™ç¨‹æœ€ååªèƒ½ç¼–è¯‘å¾—åˆ°ç¼–è¯‘å™¨æœ¬èº«ï¼Œé™„å¸¦çš„ä¸€äº›åŠŸèƒ½ä»ç„¶ç¼–è¯‘å¤±è´¥ã€‚</p><h1 id="ä¸€ã€gcc4-9-4"><a href="#ä¸€ã€gcc4-9-4" class="headerlink" title="ä¸€ã€gcc4.9.4"></a>ä¸€ã€gcc4.9.4</h1><h2 id="1ã€å‡†å¤‡å·¥ä½œ"><a href="#1ã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="1ã€å‡†å¤‡å·¥ä½œ"></a>1ã€å‡†å¤‡å·¥ä½œ</h2><p>ä»ä»¥ä¸‹<a href="https://github.com/gcc-mirror/gcc/tree/releases/gcc-4.9.4">ä½ç½®</a>ä¸‹å¸¦æºä»£ç ã€‚<br>ä¸€å¹¶ä¸‹è½½ç¼–è¯‘<code>gcc</code>æ‰€éœ€çš„ä¾èµ–åº“ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget ftp://ftp.gnu.org/gnu/gmp/gmp-4.3.2.tar.bz2 -o gmp.tar.bz2<br>wget https://www.mpfr.org/mpfr-3.1.0/mpfr-3.1.0.tar.bz2 -o mpfr.tar.bz2<br>wget https://ftp.gnu.org/gnu/mpc/mpc-1.0.1.tar.gz -o mpc.tar.gz<br></code></pre></td></tr></table></figure><h2 id="2ã€å¼€å§‹ç¼–è¯‘"><a href="#2ã€å¼€å§‹ç¼–è¯‘" class="headerlink" title="2ã€å¼€å§‹ç¼–è¯‘"></a>2ã€å¼€å§‹ç¼–è¯‘</h2><p>è¿›å…¥gccæ–‡ä»¶ç›®å½•<code>cd ./gcc.4.9.4</code>ï¼Œç„¶åè®¾å®šç¼–è¯‘å‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./configure --prefix=[ä½¿ç”¨æœ¬åœ°ç›®å½•å³å¯]/gcc4  --enable-bootstrap  --enable-checking=release --enable-languages=c,c++<br></code></pre></td></tr></table></figure><p>ç›´æ¥å¼€å§‹ç¼–è¯‘ï¼Œå»ºè®®å¼€å•çº¿ç¨‹ï¼Œå› ä¸ºç¼–è¯‘ä¼šå‡ºéå¸¸å¤šçš„é”™è¯¯ï¼Œå•çº¿ç¨‹æ–¹ä¾¿å®šä½é”™è¯¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">make -j 1<br></code></pre></td></tr></table></figure><h2 id="3ã€é”™è¯¯ä¿®å¤"><a href="#3ã€é”™è¯¯ä¿®å¤" class="headerlink" title="3ã€é”™è¯¯ä¿®å¤"></a>3ã€é”™è¯¯ä¿®å¤</h2><p><del>è¿™ç¼–è¯‘å¤šæ˜¯ä¸€ä»¶ç¾äº‹å•Šï¼Œç¼–ï¼ŒTNNDï¼Œä¸ºä»€ä¹ˆä¸ç¼–</del><br>å› ä¸ºç°åœ¨ç³»ç»Ÿç¯å¢ƒä¸Šé»˜è®¤çš„ <code>gcc 11.3</code> åŠå…¶ä¹‹åçš„ç‰ˆæœ¬é»˜è®¤å¸¦ <code>c++17</code> æ ‡å‡†ï¼Œæ‰€ä»¥ç¼–è¯‘è·¯ä¸Šä¼šæœ‰å¾ˆå¤šé”™è¯¯ã€‚</p><blockquote><p>âš æ³¨æ„ä»¥ä¸‹è§£å†³æ–¹æ¡ˆä¸­çš„ cd è·¯å¾„éœ€è¦æ ¹æ®å®é™…æƒ…å†µè‡ªè¡Œä¿®æ”¹ï¼Œä¸å¯ç…§æŠ„</p></blockquote><h3 id="aã€type-bool-in-operator-is-forbidden-in-c-1789"><a href="#aã€type-bool-in-operator-is-forbidden-in-c-1789" class="headerlink" title="aã€type bool in operator++ is forbidden in c++1789"></a>aã€type bool in operator++ is forbidden in c++1789</h3><p>åŸå› ï¼šå› ä¸º C++17 æ ‡å‡†ä¸å…è®¸ bool å˜é‡ä½¿ç”¨ ++ æ“ä½œç¬¦ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">../.././gcc/reload1.c: In <span class="hljs-keyword">function</span> â€˜void init_reload()â€™:../.././gcc/reload1.c:89:24: error: use of an operand of <span class="hljs-built_in">type</span> â€˜boolâ€™ <span class="hljs-keyword">in</span> â€˜operator++â€™ is forbidden <span class="hljs-keyword">in</span> C++1789 |   (this_target_reload-&gt;x_spill_indirect_levels)|   ~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~<br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ./host-x86_64-unknown-linux-gnu/gcc<br></code></pre></td></tr></table></figure><p>ä»ç¼–è¯‘æ—¥å¿—æ‰¾åˆ°é”™è¯¯çš„ç¼–è¯‘å‘½ä»¤åŠ ä¸Š <code>-std=c++11</code> é‡æ–°æ‰§è¡Œï¼Œç„¶åå›åˆ°ä¸Šå±‚ç›®å½•é‡æ–° <code>make -j 1</code> å³å¯ã€‚</p><h3 id="bã€dereferencing-pointer-to-incomplete-type"><a href="#bã€dereferencing-pointer-to-incomplete-type" class="headerlink" title="bã€dereferencing pointer to incomplete type"></a>bã€dereferencing pointer to incomplete type</h3><p>åŸå› ï¼šæ•°æ®ç±»å‹ä¸åŒ¹é…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">./md-unwind-support.h: åœ¨å‡½æ•°<span class="hljs-string">&#x27;x86_64_fallback_frame_state&#x27;</span>ä¸­:<br>./md-unwind-support.h:65:47: é”™è¯¯: dereferencing pointer to incomplete <span class="hljs-built_in">type</span><br>    sc = (struct sigcontext *) (void *) &amp;uc_-&gt;uc_context;<br>make[3]: *** [../.././libgcc/shared-object.mk:14: unwind-dw2.o] é”™è¯¯ 1<br></code></pre></td></tr></table></figure><p>ç±»ä¼¼çš„é”™è¯¯è¿˜æœ‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">./md-unwind-support.h: åœ¨å‡½æ•°â€˜x86_fallback_frame_stateâ€™ä¸­:<br>./md-unwind-support.h:141:18: é”™è¯¯ï¼š å­—æ®µâ€˜ucâ€™çš„ç±»å‹ä¸å®Œå…¨<br>  struct ucontext uc;<br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ¡ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> [path to gcc]/gcc4.9.4/x86_64-unknown-linux-gnu/libgcc<br></code></pre></td></tr></table></figure><p>è™½ç„¶æŠ¥é”™æ˜¯åœ¨ç¬¬ 65 è¡Œï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦ä¿®æ”¹ç¬¬ 61 è¡Œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ucontext</span> *<span class="hljs-title">uc_</span> =</span> context-&gt;cfa<br><span class="hljs-comment">// æ”¹æˆ</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ucontext_t</span> *<span class="hljs-title">uc_</span> =</span> context-&gt;cfa<br></code></pre></td></tr></table></figure><p>å¯¹äºç¬¬141è¡Œçš„é”™è¯¯åˆ™å¦‚ä¸‹ä¿®æ”¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ucontext</span> <span class="hljs-title">uc</span>;</span><br><span class="hljs-comment">// æ”¹æˆ</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ucontext_t</span> <span class="hljs-title">uc</span>;</span><br></code></pre></td></tr></table></figure><h3 id="cã€Handler-stackæœªå®šä¹‰"><a href="#cã€Handler-stackæœªå®šä¹‰" class="headerlink" title="cã€Handler_stackæœªå®šä¹‰"></a>cã€Handler_stackæœªå®šä¹‰</h3><p>åŸå› ä¸çŸ¥é“ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">../../.././libsanitizer/sanitizer_common/sanitizer_stoptheworld_linux_libcdep.cc: åœ¨å‡½æ•°â€˜int __sanitizer::TracerThread(void*)â€™ä¸­:<br>../../.././libsanitizer/sanitizer_common/sanitizer_stoptheworld_linux_libcdep.cc:241:22: é”™è¯¯ï¼š èšåˆâ€˜sigaltstack handler_stackâ€™ç±»å‹ä¸å®Œå…¨ï¼Œæ— æ³•è¢«å®šä¹‰<br>   struct sigaltstack handler_stack;<br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ¡ˆï¼ˆå‚è€ƒ<a href="https://reviews.llvm.org/D35246">llvm</a>ï¼‰</p><ul><li>æ‰“å¼€ <code>sanitizer_common/sanitizer_linux.h</code> å»æ‰å…¶ä¸­çš„ <code>struct sigaltstack;</code> å¹¶æŠŠä¹‹åå‡ºç°çš„ä¸¤å¤„ <code>struct sigaltstack</code> æ¢æˆ <code>void</code> ã€‚</li><li>æ‰“å¼€ <code>sanitizer_common/sanitizer_linux.cc</code> æ–‡ä»¶å‡ºç°çš„ä¸¤å¤„ <code>struct sigaltstack</code> æ¢æˆ <code>void</code> ã€‚</li><li>æ‰“å¼€ <code>sanitizer_common/sanitizer_stoptheworld_linux_libcedep.cc</code> æŠŠ <code>struct sigaltstack handler_stack;</code> æ¢æˆ <code>stack_t handler_stack</code> ã€‚</li><li>æ‰“å¼€ <code>tsan/rtl/tsan_platform_linux.cc</code> æ–‡ä»¶æŠŠ <code>__res_state *statp = (__res_state*)state;</code> æ¢æˆ <code>struct __res_state *statp = (struct __res_state*) state;</code> ã€‚</li></ul><h3 id="dã€SIGSEGV-undefined"><a href="#dã€SIGSEGV-undefined" class="headerlink" title="dã€SIGSEGV undefined"></a>dã€SIGSEGV undefined</h3><p>é”™è¯¯åŸå› ä¸çŸ¥é“ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">../../.././libsanitizer/asan/asan_linux.cc: åœ¨å‡½æ•°â€˜bool __asan::AsanInterceptsSignal(int)â€™ä¸­:<br>../../.././libsanitizer/asan/asan_linux.cc:107:20: é”™è¯¯ï¼š â€˜SIGSEGVâ€™åœ¨æ­¤ä½œç”¨åŸŸä¸­å°šæœªå£°æ˜<br>   <span class="hljs-built_in">return</span> signum == SIGSEGV &amp;&amp; flags()-&gt;handle_segv;<br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ¡ˆ</p><ul><li>æ‰“å¼€ <code>libsanitizer/asan/asan_linux.cc</code> ä¸­æ·»åŠ å¤´æ–‡ä»¶ <code>#include &lt;signal.h&gt;</code> å³å¯ã€‚</li></ul><h1 id="äºŒã€LLVM6-0-0"><a href="#äºŒã€LLVM6-0-0" class="headerlink" title="äºŒã€LLVM6.0.0"></a>äºŒã€LLVM6.0.0</h1><h2 id="1ã€å‡†å¤‡å·¥ä½œ-1"><a href="#1ã€å‡†å¤‡å·¥ä½œ-1" class="headerlink" title="1ã€å‡†å¤‡å·¥ä½œ"></a>1ã€å‡†å¤‡å·¥ä½œ</h2><p>ä»è¿™ä¸ª<a href="https://github.com/llvm/llvm-project/tree/llvmorg-6.0.0">é“¾æ¥</a>ä¸‹è½½ llvm6 çš„æºç ã€‚</p><h2 id="2ã€å¼€å§‹ç¼–è¯‘-1"><a href="#2ã€å¼€å§‹ç¼–è¯‘-1" class="headerlink" title="2ã€å¼€å§‹ç¼–è¯‘"></a><del>2ã€å¼€å§‹ç¼–è¯‘</del></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c++">mkdir llvm-project-llvmorg<span class="hljs-number">-6.0</span><span class="hljs-number">.0</span>/llvm/build<br>cd llvm-project-llvmorg<span class="hljs-number">-6.0</span><span class="hljs-number">.0</span>/llvm/build<br>cmake -G <span class="hljs-string">&quot;Unix Makefiles&quot;</span> -DLLVM_ENABLE_PROJECTS=<span class="hljs-string">&quot;clang&quot;</span> -DCMAKE_BUILD_TYPE=Release ../<br>make -j <span class="hljs-number">1</span>~~<br></code></pre></td></tr></table></figure><p><del>ç„¶åä¸éœ€è¦æ‰§è¡Œmake installåœ¨buildæ–‡ä»¶å¤¹ä¸‹ä¼šå­˜åœ¨ç¼–è¯‘å¥½çš„ç»“æœï¼ŒæŠŠbuildæ–‡ä»¶å¤¹æ”¾åˆ°merlin compiler&#x2F;trunk&#x2F;libä¸‹å³å¯ã€‚åŒæ—¶æ”¹åä¸merlin_setting.shä¸­çš„LLVM_ROOT_DIRå˜é‡ä¸€è‡´ã€‚</del><br><del>è¿™é‡Œå°±æ”¹åä¸º llvm6.0.0 ã€‚</del></p><h1 id="ä¸‰ã€Clang6-0-0"><a href="#ä¸‰ã€Clang6-0-0" class="headerlink" title="ä¸‰ã€Clang6.0.0"></a>ä¸‰ã€Clang6.0.0</h1><p>å‚è€ƒLLVM6é‚£ä¸€èŠ‚ï¼Œå·²ç»ä¸‹è½½å¥½æºä»£ç äº†ã€‚llvmè¿™ä¸ªé¡¹ç›®çš„ç‰¹ç‚¹æ˜¯ï¼Œæ‰€æœ‰çš„åº“éƒ½éœ€è¦<code>llvm-project-llvmorg-6.0.0/llvm</code>ä¸ºç¼–è¯‘çš„èµ·å§‹ç‚¹ï¼Œé€šè¿‡è®¾ç½®ä¸åŒçš„<code>DLLVM_ENABLE_PROJECTS</code>å˜é‡æ”¹å˜ç¼–è¯‘çš„å¯¹è±¡ï¼Œå¯é€‰çš„å¯¹è±¡æ˜¯åº•ä¸‹æ¯ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚</p><h2 id="1ã€å¼€å§‹ç¼–è¯‘"><a href="#1ã€å¼€å§‹ç¼–è¯‘" class="headerlink" title="1ã€å¼€å§‹ç¼–è¯‘"></a>1ã€å¼€å§‹ç¼–è¯‘</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> llvm-project-llvmorg-6.0.0/build<br><span class="hljs-built_in">cd</span> llvm-project-llvmorg-6.0.0/build<br>cmake -G Ninja ../llvm -DLLVM_ENABLE_PROJECTS=clang -DLLVM_BUILD_TESTS=OFF -DLLVM_TARGETS_TO_BUILD=<span class="hljs-string">&quot;X86&quot;</span> -DBUILD_SHARED_LIBS=OFF<br>ninja<br><span class="hljs-comment"># clang ä¸æ˜ç™½ä¸ºä»€ä¹ˆç›´æ¥makeæ‰¾ä¸åˆ°ï¼Œå¾—è¿è¡ŒninjaæŒ‡ä»¤</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥è¿è¡Œä»¥ä¸‹æŒ‡ä»¤è¿›è¡Œ<code>llvm</code>ç¼–è¯‘ç»“æœæµ‹è¯•ï¼Œå½“ç„¶å‰é¢çš„<code>-DLLVM_BUILD_TESTS=ON</code>æ‰è¡Œã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ninja check <span class="hljs-comment"># Test LLVM Only</span><br>ninja clang-test <span class="hljs-comment"># Test Clang Only</span><br></code></pre></td></tr></table></figure><p>âŒä¸éœ€è¦æ‰§è¡Œ<code>make install</code>ï¼ŒæŠŠ<code>build</code>æ–‡ä»¶å¤¹æ”¾åˆ°<code>merlin compiler/trunk/lib</code>ä¸‹å³å¯ã€‚åŒæ—¶æ”¹åä¸<code>merlin_setting.sh</code>ä¸­çš„<code>LLVM_ROOT_DIR</code>å˜é‡ä¸€è‡´ã€‚<br>è¿™é‡Œå°±æ”¹åä¸º <code>llvm6.0.0</code> ã€‚</p><h1 id="å››ã€boost1-67-0"><a href="#å››ã€boost1-67-0" class="headerlink" title="å››ã€boost1.67.0"></a>å››ã€boost1.67.0</h1><p>ä»<a href="https://www.boost.org/users/history/version_1_67_0.html">é“¾æ¥</a>è·å¾—æºç ï¼ˆè®°å¾—è§£å‹ï¼‰ï¼Œå­˜æ”¾åˆ°<code>merlin_compiler/trunk/source-opt/lib</code>ç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹<code>bootstrap.sh</code>çš„<code>PREFIX</code>å˜é‡å¦‚ä¸‹ï¼ˆâš è¦å’Œ<code>merlin_setting.sh</code>çš„è®¾ç½®ä¸€è‡´ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">PREFIX=[path to merlin]/merlin_compiler/trunk/source-opt/lib/boost<br><span class="hljs-comment"># è¦å’Œä¸‹é¢çš„è®¾ç½®ä¸€è‡´ï¼Œè¿™é¡¹è®¾ç½®æ¥è‡ªäºmerlin_compilerçš„merlin_setting.sh</span><br><span class="hljs-comment"># export boost_path=$MERLIN_PATH/boost</span><br></code></pre></td></tr></table></figure><p>ç„¶åï¼Œä¼šè‡ªåŠ¨åœ¨ç›®å½•ä¸‹ç”Ÿæˆ<code>b2</code>å’Œ<code>bjam</code>ä¸¤ä¸ªæŒ‡ä»¤è„šæœ¬ï¼Œç¡®ä¿å®‰è£…gccå’Œg++ï¼Œä¸€èˆ¬ä¸ä¼šæœ‰bugã€‚</p><h1 id="äº”ã€ç¼–è¯‘merlin-compilerä¸»ä½“"><a href="#äº”ã€ç¼–è¯‘merlin-compilerä¸»ä½“" class="headerlink" title="äº”ã€ç¼–è¯‘merlin_compilerä¸»ä½“"></a>äº”ã€ç¼–è¯‘merlin_compilerä¸»ä½“</h1><h2 id="1ã€å‡†å¤‡å·¥ä½œ-2"><a href="#1ã€å‡†å¤‡å·¥ä½œ-2" class="headerlink" title="1ã€å‡†å¤‡å·¥ä½œ"></a>1ã€å‡†å¤‡å·¥ä½œ</h2><p>åœ¨ä¸Šé¢ç¼–è¯‘è¿‡ç¨‹ä¸­å¤šæ¬¡ä¿®æ”¹ <code>merlin_setting.sh</code> æ–‡ä»¶ï¼Œè¿™é‡Œå¹²è„†æ”¾å‡ºæœ€ç»ˆä¿®æ”¹ç‰ˆæœ¬ï¼ˆTODOï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#######################################</span><br><span class="hljs-comment"># Merlin </span><br><span class="hljs-comment">#######################################</span><br><span class="hljs-built_in">export</span> MERLIN_COMPILER_HOME=/home/w/DSE/merlin-compiler/trunk<br><br><span class="hljs-built_in">export</span> MERLIN_PATH=<span class="hljs-variable">$MERLIN_COMPILER_HOME</span>/source-opt/lib<br><span class="hljs-built_in">export</span> llvm_path=<span class="hljs-variable">$MERLIN_PATH</span>/llvm6.0.0<br><span class="hljs-built_in">export</span> deps_path=<span class="hljs-variable">$MERLIN_PATH</span>/<br><span class="hljs-built_in">export</span> clang_path=<span class="hljs-variable">$MERLIN_PATH</span>/llvm6.0.0/bin<br><span class="hljs-built_in">export</span> rose_path=<span class="hljs-variable">$MERLIN_PATH</span>/rose<br><span class="hljs-built_in">export</span> rjson_path=<span class="hljs-variable">$MERLIN_PATH</span>/rapidjson<br><span class="hljs-built_in">export</span> gcc_path=<span class="hljs-variable">$MERLIN_PATH</span>/gcc4<br><span class="hljs-built_in">export</span> boost_path=<span class="hljs-variable">$MERLIN_PATH</span>/boost<br><br><span class="hljs-built_in">export</span> MERLIN_DEPS=<span class="hljs-variable">$deps_path</span><br><span class="hljs-built_in">export</span> LLVM_ROOT_DIR=<span class="hljs-variable">$llvm_path</span><br><span class="hljs-built_in">export</span> CLANG_ROOT_DIR=<span class="hljs-variable">$llvm_path</span><br><span class="hljs-built_in">export</span> ROSE_ROOT_DIR=<span class="hljs-variable">$rose_path</span><br><span class="hljs-built_in">export</span> RAPIDJSON_ROOT_DIR=<span class="hljs-variable">$rjson_path</span><br><span class="hljs-built_in">export</span> GCC_ROOT_DIR=<span class="hljs-variable">$gcc_path</span><br><span class="hljs-built_in">export</span> BOOST_ROOT=<span class="hljs-variable">$boost_path</span><br><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$gcc_path</span>/bin/:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$llvm_path</span>/bin/:<span class="hljs-variable">$PATH</span><br><br><span class="hljs-comment">#lib32 if lib64 is not available</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$gcc_path</span>/lib64:<span class="hljs-variable">$llvm_path</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> LIBRARY_PATH=<span class="hljs-variable">$llvm_path</span>/lib<br><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$MERLIN_COMPILER_HOME</span>/build/bin:<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„æ‰€æœ‰å‡†å¤‡å·¥ä½œéƒ½å¥½äº†ä»¥åï¼Œå›åˆ°<code>merlin_compiler</code>ä¸»æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> ./merlin_setting.sh<br><span class="hljs-built_in">mkdir</span> trunk/build<br><span class="hljs-built_in">cd</span> trunk/build<br><span class="hljs-comment"># æˆ‘ä¹Ÿæ˜¯ç»·ä¸ä½äº†ï¼Œé»˜è®¤ python3 æ‰§è¡Œä¼šæŠ¥é”™ï¼Œåªå¥½æŒ‡å®š python2</span><br>cmake -DCMAKE_BUILD_TYPE=Release -DPYTHON_EXECUTABLE=/usr/bin/python2 ..<br>make -j 1<br></code></pre></td></tr></table></figure><h2 id="2ã€é”™è¯¯ä¿®å¤"><a href="#2ã€é”™è¯¯ä¿®å¤" class="headerlink" title="2ã€é”™è¯¯ä¿®å¤"></a>2ã€é”™è¯¯ä¿®å¤</h2><h3 id="aã€GLIBCXX-3-4-22-not-found"><a href="#aã€GLIBCXX-3-4-22-not-found" class="headerlink" title="aã€GLIBCXX_3.4.22 not found"></a>aã€GLIBCXX_3.4.22 not found</h3><p>é—®é¢˜åŸå› ï¼šgcc4.9.4è‡ªå¸¦çš„libstdc++ç‰ˆæœ¬å¤ªè€ï¼ˆæˆ‘æ˜¯çœŸä¸æ˜ç™½ï¼Œä¸ºä»€ä¹ˆmerlinæŒ‡å®šç¼–è¯‘ç¯å¢ƒ4.9.4ï¼Œåˆå‡ºç°libstdc++ç‰ˆæœ¬ä¸å¤Ÿçš„é—®é¢˜ï¼Œåªèƒ½è®¤ä¸ºå†™merlinæ—¶çš„æœåŠ¡å™¨å¾ˆè€å¾ˆè€ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ make -j 1<br>/usr/bin/cmake: /home/w/DSE/merlin-compiler/trunk/source-opt/lib/gcc4/lib64/libstdc++.so.6: version `GLIBCXX_3.4.22<span class="hljs-string">&#x27; not found (required by /usr/bin/cmake)</span><br><span class="hljs-string">/usr/bin/cmake: /home/w/DSE/merlin-compiler/trunk/source-opt/lib/gcc4/lib64/libstdc++.so.6: version `CXXABI_1.3.9&#x27;</span> not found (required by /usr/bin/cmake)<br>/usr/bin/cmake: /home/w/DSE/merlin-compiler/trunk/source-opt/lib/gcc4/lib64/libstdc++.so.6: version `GLIBCXX_3.4.21<span class="hljs-string">&#x27; not found (required by /usr/bin/cmake)</span><br><span class="hljs-string">Makefile:1783: recipe for target &#x27;</span>cmake_check_build_system<span class="hljs-string">&#x27; failed</span><br><span class="hljs-string">make: *** [cmake_check_build_system] Error 1</span><br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ¡ˆï¼š<br>ä»å…¶ä»–åœ°æ–¹å€Ÿä¸€ä¸ª<code>libstdc++</code>å°±å¥½ï¼Œæ¯”å¦‚æˆ‘ä»<code>/usr/lib/gcc</code>ç¯å¢ƒï¼ˆå³æœåŠ¡å™¨ä¸Šçš„é«˜ç‰ˆæœ¬gccï¼‰ä¸­å€Ÿä¸€ä¸ªã€‚åœ¨å€Ÿä¹‹å‰å…ˆä¿å­˜åŸç‰ˆï¼Œç„¶åæœç´¢æœ¬åœ°çš„é«˜ç‰ˆæœ¬gccä¸­çš„<code>libstdc++</code>çš„æ–‡ä»¶ä½ç½®æ›¿æ¢<code>gcc4.9.4</code>çš„<code>libstdc++</code>æ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> libstdc++.so.6.0.20 libstdc++.so.6.0.20.old<br><span class="hljs-built_in">mv</span> libstdc++.so.6 libstdc++.so.6.old<br><span class="hljs-built_in">mv</span> libstdc++.so libstdc++.so.old<br><span class="hljs-comment"># è¿™é‡Œå°±å·æ‡’æœä¸€ä¸ªï¼Œä¸€èˆ¬åœ¨ /usr/lib/x86_64-linux-gnu ç›®å½•ä¸‹ä¼šæœ‰</span><br><span class="hljs-built_in">sudo</span> find /usr/lib -name libstdc++*<br><span class="hljs-built_in">cp</span> /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.29 [path to merlin]/merlin_compiler/trunk/source-opt/gcc4/lib64<br></code></pre></td></tr></table></figure><p>æœ€åé‡æ–°å»ºç«‹è½¯è¿æ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -s libstdc++.so.6.0.29 libstdc++.so<br><span class="hljs-built_in">ln</span> -s libstdc++.so.6.0.29 libstdc++.so.6<br></code></pre></td></tr></table></figure><h3 id="bã€MDiag-emitDiagnosticLoc-marked-override-but-does-not-override"><a href="#bã€MDiag-emitDiagnosticLoc-marked-override-but-does-not-override" class="headerlink" title="bã€MDiag::emitDiagnosticLoc() marked override, but does not override"></a>bã€MDiag::emitDiagnosticLoc() marked override, but does not override</h3><p>é—®é¢˜åŸå› ï¼šå­ç±»æ ‡è®°ä¸ºoverrideï¼Œä½†æ˜¯çˆ¶ç±»æ²¡æœ‰æ ‡è®°ä¸ºoverrideã€‚ä¸è¿‡å®é™…æ£€æŸ¥æŠ¥é”™çš„ä½ç½®å‘ç°clangå¯¹åº”ä½ç½®æ˜¯æœ‰overrideæ ‡è®°çš„ï¼Œæ¨æµ‹ç¼–è¯‘merlinæ—¶æŒ‡å®šçš„clangä½ç½®æœ‰é”™è¯¯ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">/home/w/DSE/merlin-compiler/trunk/mars-gen/tools/mcheck/mdiag.h:60:8: é”™è¯¯ï¼š â€˜void MDiag::emitDiagnosticLoc(clang::FullSourceLoc, clang::PresumedLoc, clang::DiagnosticsEngine::Level, llvm::ArrayRef&lt;clang::CharSourceRange&gt;)â€™ marked override, but does not override<br>   void emitDiagnosticLoc(clang::FullSourceLoc, clang::PresumedLoc,<br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ¡ˆï¼šæ‰“å¼€<code>merlin_compiler/trunk/mars-gen/tools/mcheck/mdiag.h</code>å»æ‰å…¶ä¸­ 62ã€63 è¡Œçš„ <code>override</code> ã€‚</p><h3 id="cã€mcheck-mrefactor-undfeind"><a href="#cã€mcheck-mrefactor-undfeind" class="headerlink" title="cã€mcheck mrefactor undfeind"></a>cã€mcheck mrefactor undfeind</h3><p>é—®é¢˜åŸå› ï¼šclangåº“ä¸­ç¡®å®æ²¡æœ‰è¿™äº›å®šä¹‰ï¼Œä¸çŸ¥é“æ˜¯ç‰ˆæœ¬é—®é¢˜è¿˜æ˜¯ä»£ç bugã€‚é”™è¯¯ç±»ä¼¼ä¸‹é¢è¿™ç§ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">using clang::ast_matchers::cxxNewExpr; Undefined<br>using clang::ast_matchers::cxxOperatorCallExpr; Undefined<br></code></pre></td></tr></table></figure><p>âš æ¯”è¾ƒå–å·§çš„è§£å†³æ–¹æ¡ˆæ˜¯æ‰“å¼€<code>merlin-compiler/trunk/mars-gen/tools/mcheck/CMakeLists.txt</code>æ–‡ä»¶å»æ‰ä»¥ä¸‹ä¸¤è¡Œï¼ˆä¸ºä»€ä¹ˆå–å·§å‘¢ï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªæ¨¡å—æ˜¯å·¥å…·ï¼Œä¸ç¡®å®šè¿™æ ·ç¼–è¯‘å‡ºçš„merlinccæ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œå¯„å¸Œæœ›äºè¿™ä¸¤ä¸ªå·¥å…·ä¸å½±å“æ­£å¸¸ç¼–è¯‘ä¸å¤§ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">add_subdirectory(<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/mcheck&quot;</span>)<br>add_subdirectory(<span class="hljs-string">&quot;<span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/mrefactor&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="dã€-usr-bin-ld-lrose"><a href="#dã€-usr-bin-ld-lrose" class="headerlink" title="dã€&#x2F;usr&#x2F;bin&#x2F;ld -lrose"></a>dã€&#x2F;usr&#x2F;bin&#x2F;ld -lrose</h3><p>é—®é¢˜åŸå› ï¼šæ‰¾ä¸åˆ°åº“æ–‡ä»¶ä½ç½®ï¼ˆç»å…¸é”™è¯¯äº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/bin/ld:/home/w/DSE/merlin-compiler/trunk/source-opt/lib/rose/lib/librose.so: file format not recognized; treating as linker script<br></code></pre></td></tr></table></figure><p>ä»gitä¸Šä¸‹è½½çš„æ–‡ä»¶å› ä¸ºä¸¢å¤±é“¾æ¥ä½ç½®ä¿¡æ¯ï¼Œè€Œè‡ªå·±ç¼–è¯‘çš„<code>librose.so</code>æ²¡æœ‰é“¾æ¥æŒ‡å‘å®ƒã€‚è¿™é‡Œåˆ é™¤ç„¶åé‡æ–°å»ºç«‹è½¯é“¾æ¥å³å¯ã€‚éšå³åˆå†’å‡ºå¦ä¸€ä¸ªé—®é¢˜ï¼ˆä¸æ˜¯å“¥ä»¬ï¼Œé‚£ä¹‹å‰æ‰¾åˆ°çš„librose.soç®—ä»€ä¹ˆï¼Ÿï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/bin/ld: æ‰¾ä¸åˆ° -lrose<br>clang: error: linker <span class="hljs-built_in">command</span> failed with <span class="hljs-built_in">exit</span> code 1 (use -v to see invocation)<br></code></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•ï¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæŒ‡å‘<code>librose.so</code>çš„è½¯è¿æ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> merlin-compiler/trunk/source-opt/lib/rose/lib<br><span class="hljs-built_in">rm</span> librose.so<br><span class="hljs-built_in">ln</span> -s librose.so.0.0.0 librose.so<br><span class="hljs-comment"># ç„¶åæ‹·è´åˆ° /usr/bin ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªè½¯è¿æ¥ï¼Œè¿™ä¸€æ­¥éœ€è¦ sudo æƒé™</span><br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cp</span> librose.so.0.0.0 /usr/lib<br><span class="hljs-built_in">cd</span> /usr/lib<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">ln</span> -s librose.so.0.0.0 librose.so<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¹Ÿè§åˆ°å¦ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯é€šè¿‡aptå‘½ä»¤å®‰è£…è¿™ä¸ªåº“ã€‚ä¸è¿‡æ²¡æœ‰å°è¯•ã€‚</p><h1 id="å…­ã€è§è¯æ›™å…‰"><a href="#å…­ã€è§è¯æ›™å…‰" class="headerlink" title="å…­ã€è§è¯æ›™å…‰"></a>å…­ã€è§è¯æ›™å…‰</h1><p>ç»è¿‡ä¸‰å¤©é–æˆ˜ï¼Œèµ°äº†ä¸€å †å¼¯è·¯ä¹‹åï¼Œç»ˆäºè§åˆ°å¦‚ä¸‹çš„è¾“å‡ºã€‚ï¼ˆåº”è¯¥æ˜¯å¥½äº†å§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">[ 92%] Built target DsBitwidthOpt<br>[ 92%] Built target set_cfg<br>[ 93%] Built target DsTiling<br>[ 94%] Built target DsScope<br>[ 95%] Built target DsLoopParallel<br>[ 96%] Built target DsSkeletonExtract<br>[ 97%] Built target DsResourceEval<br>[ 98%] Built target DsPipeline<br>[ 99%] Built target LoopParallel<br>[100%] Linking CXX executable ../../../bin/mars_opt_org<br>[100%] Built target mars_opt_org<br>(base) w@HAS-T640:~/DSE/merlin-compiler/trunk/build$ <br></code></pre></td></tr></table></figure><p>æ€€ç€æ¿€åŠ¨çš„å°æ‰‹~</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">(base) w@HAS-T640:~/DSE/merlin-compiler/trunk/build$ merlincc -h<br>Smartmatch is experimental at /home/w/DSE/merlin-compiler/trunk//mars-gen/scripts/lib/message.pm line 392.<br><br><br>Usage: merlincc &lt;options&gt; &lt;filename&gt;.&lt; c|cpp|mco &gt;<br><br>Options:<br>-v, --version<br>    Display compiler version<br><br>--list-platform<br>    Display supported platforms<br>...<br></code></pre></td></tr></table></figure><p>ç»ˆäºï¼Œc++çš„é«˜å±‚æ¬¡ç»¼åˆåŠŸèƒ½æ˜¯èƒ½ç”¨äº†ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>åˆ†äº«</tag>
      
      <tag>æŠ˜è…¾</tag>
      
      <tag>DSE</tag>
      
      <tag>ç¼–è¯‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[å­¦ä¹ ]C++æ€§èƒ½åˆ†æå®æˆ˜</title>
    <link href="/2024/11/12/%E5%AD%A6%E4%B9%A0-C-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/"/>
    <url>/2024/11/12/%E5%AD%A6%E4%B9%A0-C-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/</url>
    
    <content type="html"><![CDATA[<h1 id="å°-Tips"><a href="#å°-Tips" class="headerlink" title="å° Tips"></a>å° Tips</h1><blockquote><p>âš éœ€è¦æ›´åŠ é«˜çº§ï¼Œç»†è‡´åˆ°CPUæ—¶é’Ÿã€ç¼“å­˜ä¸€è‡´æ€§ã€ç¼“å­˜å‘½ä¸­ç‡å’Œåˆ†æ”¯é¢„æµ‹å‡†ç¡®ç‡çš„ä¼°è®¡è€ƒè™‘ä½¿ç”¨éš”å£çš„ perf å·¥å…·<br>âš gprofåªèƒ½æ£€æŸ¥å·¥ä½œåœ¨ç”¨æˆ·æ€çš„ä»£ç ï¼Œå¦‚printfç­‰å†…æ ¸æ€çš„ä»£ç æ— æ³•å‰–æï¼Œ<br>âš åœ¨é‚£ä¹‹å‰å›é¡¾ c++ ç¨‹åºï¼Œå‡½æ•°çš„å£°æ˜ä¸å‡½æ•°çš„å®šä¹‰äºŒè€…ä¹‹é—´åŒºåˆ«ã€‚<br>âœ”éå¸¸èµèµä½¿ç”¨ git ä»£ç ç®¡ç†å·¥å…·ã€‚<br>âœ”éå¸¸èµåŒåˆä½œå†™ä»£ç æ—¶è§„å®šä¸€ä¸ªç»Ÿä¸€çš„é£æ ¼è§„èŒƒã€‚</p></blockquote><p><img src="/2024/11/12/%E5%AD%A6%E4%B9%A0-C-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E7%A4%BA%E4%BE%8B.PNG"></p><blockquote><p>âœ”æ¨èä½¿ç”¨ Makefile è‡ªåŠ¨æ„å»ºå·¥å…·ã€‚ç†ŸçŸ¥ cmake å·¥å…·ä½¿ç”¨çš„è¯ï¼Œæ›´å¥½ã€‚<br>âœ”ç»™è‡ªå·±çš„ä»£ç åº“å†™ä¸€ä¸ª README.md æ–‡ä»¶</p></blockquote><h2 id="STL-åº“çš„ä½¿ç”¨"><a href="#STL-åº“çš„ä½¿ç”¨" class="headerlink" title="STL åº“çš„ä½¿ç”¨"></a>STL åº“çš„ä½¿ç”¨</h2><blockquote><p>ğŸ“Œå¦‚æœç¼–è¯‘å™¨èƒ½æ­£ç¡®ä¼˜åŒ–è¿™ä¸¤éƒ¨åˆ†çš„è°ƒç”¨ï¼Œä¹Ÿè®¸å·®åˆ«ä¸å¤§ã€‚ä½†åœ¨ä¸€ä¸ªé€»è¾‘å¤æ‚çš„ç±»è°ƒç”¨é‡Œé¢ï¼ŒæŒ‡æœ›ç¼–è¯‘å™¨ä¼˜åŒ–æ˜¯ä¸å¯è¡Œçš„ã€‚<br>âš STLåº“ç›¸æ¯”æŒ‡é’ˆå®ç°çœŸçš„æ…¢éå¸¸å¤šï¼Œå› æ­¤åœ¨è€ƒè™‘ return std::vector std::map std::list ç­‰ç­‰ STL åº“ä¹‹å‰ä¸€å®šè¦æƒ³æ¸…æ¥šï¼ŒçœŸçš„é return è¿™äº›ä¸å¯ï¼Ÿèƒ½ä¸èƒ½ä¼ ä¸€ä¸ª vector map list çš„å¼•ç”¨æˆ–è€…ä¸€ä¸ªæŒ‡é’ˆï¼Ÿ</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">map&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt; <span class="hljs-title">copyReturn</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span></span>&#123;<br>    map&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt; res;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)<br>        res[i] = i;<br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">refReturn</span><span class="hljs-params">(map&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt; &amp;res, <span class="hljs-type">int</span> n)</span></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)<br>        res[i]=i;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸¤ç§å®ç°æ–¹å¼éƒ½å¯ä»¥è·å¾—ä¸€ä¸ªæ“ä½œåçš„ map æ•°æ®ç±»å‹ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯è¿”å›å½¢å¼ï¼Œç¬¬ä¸€ç§è¿”å› stl å®¹å™¨æœ¬èº«ï¼Œç¬¬äºŒç§ stl å®¹å™¨åˆ™ä»¥å¼•ç”¨å‚æ•°çš„å½¢å¼ä¼ é€’ã€‚<br>äºŒè€…æœ€å¤§çš„å·®å¼‚åœ¨äºè¿”å› stl å®¹å™¨ï¼Œä¼šå¼•å…¥é¢å¤–çš„ stl å®¹å™¨çš„åˆ›å»ºå’Œé”€æ¯è¿‡ç¨‹ã€‚è€Œå¼•ç”¨å½¢å¼åˆ™å¯ä»¥é¿å…è¿™éƒ¨åˆ†é¢å¤–å¼€é”€ã€‚å½“æˆ‘ä»¥<code>n=10</code>çš„è§„æ¨¡å¤§é‡è°ƒç”¨è¶…è¿‡<code>1åƒä¸‡</code>æ¬¡æ—¶ï¼ŒäºŒè€…çš„æ€§èƒ½æœ‰æ˜¾è‘—çš„å·®åˆ«ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">wa@HAS-T640:~/EDA8$ g++ b.cpp -o b<br>wa@HAS-T640:~/EDA8$ ./b<br>copyReturn: 35808ms<br>refReturn: 30298ms<br></code></pre></td></tr></table></figure><blockquote><p>âš std::map åŸºäºçº¢é»‘æ ‘ï¼Œè€Œ std::unordered_map æ˜¯çœŸæ­£æ„ä¹‰ä¸ŠåŸºäºæ•£åˆ—å‡½æ•°ï¼Œåœ¨è€ƒè™‘ O(1) å’Œ O(logn) çš„æ—¶é—´å¤æ‚åº¦ä¹‹å‰é—®é—®è‡ªå·±ï¼Œè‡ªå·±çš„æ•°æ®é‡æ˜¯å¦å¤§åˆ°ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦è¶…è¿‡äº†å¸¸æ•°éƒ¨åˆ†ã€‚</p></blockquote><p>åŒæ ·çš„ä»£ç ï¼ŒæŠŠ map æ¢æˆ unordered_map å†æ¬¡æ‰§è¡Œä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">wa@HAS-T640:~/EDA8$ g++ b.cpp -o b<br>wa@HAS-T640:~/EDA8$ ./b<br>copyReturn: 42165ms<br>refReturn: 40512ms<br></code></pre></td></tr></table></figure><p>åŸºäº $O(1)$ å®è·µå¤æ‚åº¦æ•£åˆ—å‡½æ•°çš„å®¹å™¨å¹¶æ²¡æœ‰å¦‚æœŸæœ›é‚£èˆ¬åœ¨è¿è¡Œæ—¶é—´ä¸Šæ‰“è´¥ $O(nlogn)$ æ—¶é—´å¤æ‚åº¦çš„å®¹å™¨ã€‚</p><h2 id="æ­£ç¡®ä½¿ç”¨-Inline-ä¿®é¥°"><a href="#æ­£ç¡®ä½¿ç”¨-Inline-ä¿®é¥°" class="headerlink" title="æ­£ç¡®ä½¿ç”¨ Inline ä¿®é¥°"></a>æ­£ç¡®ä½¿ç”¨ Inline ä¿®é¥°</h2><blockquote><p>âš éœ€è¦å¤§é‡è°ƒç”¨çš„å‡½æ•°ï¼Œä¾‹å¦‚ä»…ä»… return ä¸€ä¸ª class å†… private å€¼ï¼Œä¹Ÿè®¸åº”è¯¥å°è¯•æŠŠ private ç§»åŠ¨åˆ° public ç±»å‹ä¸­ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚è¿™ä¾¿æ˜¯ inline ä¿®é¥°çš„æ„ä¹‰ã€‚<br>âš åŠ ä¸Š inline å…³é”®å­—å¹¶å¼€å¯ -O2 ä»¥ä¸Šçš„ä¼˜åŒ–çº§åˆ«ï¼Œå‰©ä¸‹çš„é ç¼–è¯‘å™¨ã€‚å½“ç„¶ï¼Œè¦ç†ŸçŸ¥ inline å…³é”®å­—ä¿®é¥°çš„æœ¬è´¨ï¼Œå†™çš„ inline å…³é”®å­—æ‰èƒ½è¢«çœŸæ­£è¯†åˆ«ã€‚</p></blockquote><p>Inline å…³é”®å­—çš„æœ¬è´¨æ˜¯æŠŠå‡½æ•°å®šä¹‰æ’å…¥åˆ°è°ƒç”¨çš„åœ°æ–¹ï¼Œä»è€Œå‡å°‘è°ƒç”¨æ ˆçš„å¼€é”€ã€‚<br>ä»¥ä¸‹ä¸¾ä¾‹æ¥è‡ªæŸå°é˜Ÿçš„ä»£ç å®ç°ã€‚<br>ä»£ç ä¸­æœ‰ä¸€å¤„è®¡ç®—ç”¨çš„ç‰¹åˆ«å¤šï¼Œè®¡ç®—ä¸¤ä¸ªç‚¹çš„æ›¼å“ˆé¡¿è·ç¦»ï¼Œä»–ä»¬åœ¨ *.hpp æ–‡ä»¶å£°æ˜äº†è¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getManhatonDistance</span><span class="hljs-params">(Position &amp;u, Position &amp;v)</span></span>;<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨å¯¹åº”çš„<code>*.cpp</code>æ–‡ä»¶å®ç°è¿™ä¸ªå‡½æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getManhatonDistance</span><span class="hljs-params">(Position &amp;u, Position &amp;v)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(u.x - v.x) + <span class="hljs-built_in">abs</span>(u.y - v.y);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘ç¨‹åºå¼€å¯äº†<code>-O2</code>çº§åˆ«çš„ä¼˜åŒ–ï¼Œç†è®ºä¸Šç¼–è¯‘å™¨è¯†åˆ«è¿™ç§<code>inline</code>çš„å‡½æ•°ååˆ†è½»æ¾ï¼Œæ˜¯ä¸åº”è¯¥å‡ºç°ä¸ä¼˜åŒ–çš„æƒ…å†µçš„ã€‚äº‹å®ä¸ç„¶ï¼Œæµ‹è¯•å®é™…ï¼Œè¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨42äº¿æ¬¡ï¼Œä¸”éƒ½æ˜¯æ­£å¸¸å‡½æ•°è°ƒç”¨æ ˆã€‚</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs txt">Flat profile:<br><br>Each sample counts as 0.01 seconds.<br>  %   cumulative   self              self     total           <br> time   seconds   seconds    calls   s/call   s/call  name    <br> 38.56      5.19     5.19       94     0.06     0.09  KMeans::assignLabels(std::vector&lt;Position, std::allocator&lt;Position&gt; &gt;&amp;)<br> 37.75     10.27     5.08 4218676471     0.00     0.00  getManhatonDistance(Position&amp;, Position&amp;)<br> 18.28     12.73     2.46        4     0.62     0.97  KMeans::initCenters(std::vector&lt;Position, std::allocator&lt;Position&gt; &gt;&amp;)<br>  5.20     13.43     0.70   146159     0.00     0.00  frame_dummy<br>  0.07     13.44     0.01    49680     0.00     0.00  ClockTreeNode::setFather(ClockTreeNode&amp;)<br>  0.07     13.45     0.01     5885     0.00     0.00  void std::vector&lt;int, std::allocator&lt;int&gt; &gt;::_M_realloc_insert&lt;int const&amp;&gt;(__gnu_cxx::__normal_iterator&lt;int*, std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;, int const&amp;)<br>  0.07     13.46     0.01       51     0.00     0.00  void std::vector&lt;ClockTreeNode, std::allocator&lt;ClockTreeNode&gt; &gt;::_M_realloc_insert&lt;ClockTreeNode const&amp;&gt;(__gnu_cxx::__normal_iterator&lt;ClockTreeNode*, std::vector&lt;ClockTreeNode, std::allocator&lt;ClockTreeNode&gt; &gt; &gt;, ClockTreeNode const&amp;)<br>  0.00     13.46     0.00   101270     0.00     0.00  std::vector&lt;Position, std::allocator&lt;Position&gt; &gt;::_M_default_append(unsigned long)<br>  0.00     13.46     0.00    49681     0.00     0.00  ClockTreeNode::printComponent(std::ostream&amp;)<br>  0.00     13.46     0.00    49680     0.00     0.00  ClockTreeNode::addChild(ClockTreeNode&amp;)<br>  0.00     13.46     0.00      988     0.00     0.00  ClockTreeNode::printNet(std::ostream&amp;)<br>  0.00     13.46     0.00       94     0.00     0.00  KMeans::updateNewCenters(std::vector&lt;Position, std::allocator&lt;Position&gt; &gt;&amp;)<br>  0.00     13.46     0.00       34     0.00     0.00  void std::vector&lt;Position, std::allocator&lt;Position&gt; &gt;::_M_realloc_insert&lt;Position const&amp;&gt;(__gnu_cxx::__normal_iterator&lt;Position*, std::vector&lt;Position, std::allocator&lt;Position&gt; &gt; &gt;, Position const&amp;)<br>  0.00     13.46     0.00        6     0.00     0.00  UnionFind::getRoot(int)<br>  0.00     13.46     0.00        5     0.00     0.00  std::vector&lt;int, std::allocator&lt;int&gt; &gt;::_M_default_append(unsigned long)<br>  0.00     13.46     0.00        4     0.00     0.00  KMeans::deleteEmpty(std::vector&lt;Position, std::allocator&lt;Position&gt; &gt;&amp;)<br>  0.00     13.46     0.00        4     0.00     3.18  KMeans::fit(std::vector&lt;ClockTreeNode, std::allocator&lt;ClockTreeNode&gt; &gt;&amp;)<br>  0.00     13.46     0.00        2     0.00     0.00  std::vector&lt;double, std::allocator&lt;double&gt; &gt;::_M_default_append(unsigned long)<br>  0.00     13.46     0.00        1     0.00     0.00  _GLOBAL__sub_I__Z16parseProblemFileRKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEER11NetlistInfoRSt6vectorI13ClockTreeNodeSaISA_EE<br>  0.00     13.46     0.00        1     0.00     0.00  _GLOBAL__sub_I__ZN6KMeans3fitERSt6vectorI13ClockTreeNodeSaIS1_EE<br>  0.00     13.46     0.00        1     0.00     0.00  _GLOBAL__sub_I__ZN7safeNum3addEi<br>  0.00     13.46     0.00        1     0.00     0.00  _GLOBAL__sub_I_kmeans<br></code></pre></td></tr></table></figure><p>ğŸ“ŒåŸå› å‡ºåœ¨ï¼Œ*.hpp åªç»™å‡ºç¨‹åºå£°æ˜ï¼Œå¹¶æ²¡æœ‰å®šä¹‰ã€‚ç¼–è¯‘å™¨æ— æ³•å°†å‡½æ•°æ’å…¥åˆ°ä»£ç å—ä¸­ï¼Œä¹Ÿå°±æ²¡æœ‰æ‰§è¡Œ inline ä¿®é¥°çš„ä»£ç ä¼˜åŒ–ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">getManhatonDistance</span><span class="hljs-params">(Position &amp;u, Position &amp;v)</span></span>; <span class="hljs-comment">// åœ¨ hpp æ–‡ä»¶å¼ºè¡Œä¿®æ”¹ inline</span><br><span class="hljs-comment">// é”™è¯¯æ–¹æ³•ï¼Œæ³¨æ„è¿™åªæ˜¯å‡½æ•°çš„å£°æ˜ï¼Œæ²¡æœ‰è§£å†³é”™è¯¯</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">double</span> <span class="hljs-title">getManhatonDistance</span><span class="hljs-params">(Position &amp;u, Position &amp;v)</span></span>; <span class="hljs-comment">// ä¼šåœ¨å…¶ä»– cpp æ–‡ä»¶å¼•èµ·å‡½æ•°æœªå®šä¹‰çš„é”™è¯¯</span><br><span class="hljs-comment">// æ­£ç¡®æ–¹æ³•æ˜¯ï¼Œä¿®æ”¹æˆå‡½æ•°çš„å®šä¹‰ï¼ŒåŠ ä¸Šå‡½æ•°å®ç°éƒ¨åˆ†</span><br><span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">double</span> <span class="hljs-title">getManhatonDistance</span><span class="hljs-params">(Position &amp;u, Position &amp;v)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">abs</span>(u.x - v.x) + <span class="hljs-built_in">abs</span>(u.y - v.y);<br>&#125; <span class="hljs-comment">// ç„¶ååœ¨ cpp ä¸­åˆ å»è¿™éƒ¨åˆ†å®ç°ä»£ç ï¼Œé˜²æ­¢é‡å®šä¹‰é”™è¯¯</span><br></code></pre></td></tr></table></figure><p>ğŸ”¥ä»…è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±ä¼˜åŒ–äº†ç¨‹åº 33% çš„è¿è¡Œæ—¶é—´ã€‚</p><h2 id="åˆ¤æ–­æ¡ä»¶-tips"><a href="#åˆ¤æ–­æ¡ä»¶-tips" class="headerlink" title="åˆ¤æ–­æ¡ä»¶ tips"></a>åˆ¤æ–­æ¡ä»¶ tips</h2><blockquote><p>âš å°½é‡ä¸è¦åœ¨åˆ¤æ–­æ¡ä»¶ä¸­å¼•å…¥è¿‡äºå¤æ‚çš„å‡½æ•°ï¼Œæ‰§è¡Œæ—¶é—´å¾ˆé•¿çš„å‡½æ•°ã€‚<br>âš éå†™ä¸å¯ï¼Œéœ€è¦æŒ‰ç…§å„ä¸ªå‡½æ•°æ‰§è¡Œç”¨æ—¶ä»ä½åˆ°é«˜çš„é¡ºåºä»å·¦å¾€å³å†™ã€‚å¦‚æœæŸä¸ªæ¡ä»¶åˆ¤æ–­ false æ¦‚ç‡æ›´é«˜ï¼Œåˆ™å¯ä»¥é€‚å½“æå‰ã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-type">bool</span> result = <span class="hljs-literal">true</span>;<br><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">readInputNodes</span>(inputNodeFileName)) <span class="hljs-comment">// è¯» Node æ–‡ä»¶ï¼Œå¹¶è¿”å› true å’Œ false è¡¨ç¤ºæ˜¯å¦è¯»å®Œ</span><br>&#123;<br>  result = <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (!<span class="hljs-built_in">readInputTiming</span>(inputTimingFileName) &amp;&amp; result) <span class="hljs-comment">// è¯» timing æ–‡ä»¶ï¼Œè¿”å› true å’Œ false è¡¨ç¤ºæ˜¯å¦è¯»å®Œ</span><br>&#123; <span class="hljs-comment">// è¿™é‡Œæ˜¯æ˜æ˜¾å­˜åœ¨ä¾èµ–æ€§çš„ï¼ŒNode è¯»å–ä¸æ­£ç¡®ï¼Œåç»­çš„æ—¶åºå…³é”®å°±æ²¡å¿…è¦ç»§ç»­æ‰§è¡Œï¼Œç›´æ¥è¿”å›ã€‚</span><br>  <span class="hljs-comment">// ä½†æ˜¯è¿™æ ·çš„é¡ºåºï¼Œç¨‹åºä¼šå…ˆæ‰§è¡Œå‡½æ•°ï¼Œç„¶ååˆ¤æ–­ result çš„çŠ¶æ€ï¼Œ</span><br>  <span class="hljs-comment">// å¦‚æœ result ä¸º false é‚£ä¹ˆå‡½æ•°çš„æ‰§è¡Œå·²ç»æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ã€‚</span><br>  result = <span class="hljs-literal">false</span>;<br>&#125;<br><span class="hljs-comment">// ä»¥ä¸‹æ˜¯æ­£ç¡®å†™æ³•</span><br><span class="hljs-keyword">if</span> (result &amp;&amp; !<span class="hljs-built_in">readInputNets</span>(inputNetFileName))&#123;&#125; <span class="hljs-comment">// è¯» net æ–‡ä»¶ï¼Œâ€¦â€¦</span><br></code></pre></td></tr></table></figure><h2 id="makefile-è‡ªåŠ¨æ„å»ºå·¥å…·çš„ä½¿ç”¨"><a href="#makefile-è‡ªåŠ¨æ„å»ºå·¥å…·çš„ä½¿ç”¨" class="headerlink" title="makefile è‡ªåŠ¨æ„å»ºå·¥å…·çš„ä½¿ç”¨"></a>makefile è‡ªåŠ¨æ„å»ºå·¥å…·çš„ä½¿ç”¨</h2><blockquote><p>ğŸ“Œå»ºè®®ä½¿ç”¨è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ã€‚<br>âš ä½†æ˜¯æœ¬æ¯”èµ›ä¸æ¨è cmake å·¥å…·ï¼Œå› ä¸º cmake çš„è¯­æ³•å¤æ‚ï¼Œä¸Šæ‰‹éš¾åº¦è¾ƒé«˜ï¼Œæ—¥åç®¡ç†å¤§å‹é¡¹ç›®æ„å»ºæ—¶ï¼Œå†å­¦ä¹Ÿæ¥å¾—åŠã€‚</p></blockquote><p>åœ¨å½“å‰æ–‡ä»¶å¤¹å†…åˆ›å»º<code>Makefile</code>æ–‡ä»¶ï¼Œå¹¶ä»¥æ‰å¹³å¼åˆ†å¸ƒæ‰€æœ‰çš„æºä»£ç æ–‡ä»¶ã€‚<br>ä¾‹å¦‚ï¼Œç¨‹åºéœ€è¦<code>global.cpp</code> <code>util.cpp</code> <code>rsmt.cpp</code> <code>arch.cpp</code> <code>lib.cpp</code> <code>object.cpp</code> <code>netlist.cpp</code> <code>main.cpp</code> <code>algorithm.cpp</code>å…±è®¡ 9 ä¸ªæºä»£ç æ–‡ä»¶ç¼–è¯‘å¾—åˆ°ï¼Œå†™å‡ºä»¥ä¸‹çš„ makefile å†…å®¹ã€‚</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs makefile">SRC = global.cpp util.cpp rsmt.cpp arch.cpp lib.cpp object.cpp netlist.cpp main.cpp algorithm.cpp<br>OBJ = $(SRC:.cpp=.o)<br>CC = g++<br><br>CFLAGS = -Wall -Wextra -std=c++11<br>CFLAGS += -fopenmp -g<br><br><span class="hljs-section">all: checker</span><br><br><span class="hljs-section">checker: <span class="hljs-variable">$(OBJ)</span></span><br>    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(CFLAGS)</span> -o main <span class="hljs-variable">$(OBJ)</span><br><br><span class="hljs-section">%.o: %.cpp</span><br>    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(CFLAGS)</span> -c <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span><br><br><span class="hljs-section">clean:</span><br>    rm -f main <span class="hljs-variable">$(OBJ)</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œä»¥ä¸‹è§„å®šäº†å½“å‰ç¨‹åºå†…ç¼–è¯‘çš„å†…å®¹ï¼Œå¯¹è±¡å’Œç¼–è¯‘å‚æ•°</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs makefile">SRC = global.cpp util.cpp rsmt.cpp arch.cpp lib.cpp object.cpp netlist.cpp main.cpp algorithm.cpp // ç¼–è¯‘æºæ–‡ä»¶<br>OBJ = $(SRC:.cpp=.o) // æŒ‡å®šç¼–è¯‘å¯¹è±¡<br>CC = g++ // æŒ‡å®šç¼–è¯‘å™¨<br><br>CFLAGS = -Wall -Wextra -std=c++11 // è§„å®šåŸºæœ¬ç¼–è¯‘å‚æ•°<br>CFLAGS += -fopenmp -g // é™„åŠ å‚æ•°<br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯ç¼–è¯‘æŒ‡ä»¤ï¼Œchecker æŒ‡ä»¤è§„å®šäº†ï¼Œæˆ‘ä»¬åœ¨ç»ˆç«¯æ‰§è¡Œ<code>make checker</code>å‘½ä»¤æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">checker: <span class="hljs-variable">$(OBJ)</span> // å†’å·åè¡¨ç¤ºç¼–è¯‘ checker ä¾èµ–ï¼Œ$ ç¬¦å·è¡¨ç¤ºä»¥å˜é‡å½¢å¼çœ‹å¾…</span><br>    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(CFLAGS)</span> -o main <span class="hljs-variable">$(OBJ)</span> // ç¿»è¯‘è¿‡æ¥è¿™é‡Œå†™çš„æ˜¯ g++ -Wall -Wextra -std=c++11 -fopenmp -g -o main [*.o]<br>    <br><span class="hljs-section">%.o: %.cpp // å®é™…ä¸Š <span class="hljs-variable">$(OBJ)</span> æ°å¥½æ˜¯ global.o util.o ç­‰ç­‰çš„ç¼©å†™ï¼Œä¼šåŒ¹é…åˆ°è¿™ä¸ªè§„åˆ™</span><br>    <span class="hljs-variable">$(CC)</span> <span class="hljs-variable">$(CFLAGS)</span> -c <span class="hljs-variable">$&lt;</span> -o <span class="hljs-variable">$@</span><br></code></pre></td></tr></table></figure><p>æœ€åæ˜¯ç”¨äºæ¸…ç†çš„æŒ‡ä»¤ï¼Œåœ¨ç»ˆç«¯æ‰§è¡Œ<code>make clean</code>å®é™…ä¸Šæ‰§è¡Œçš„æ˜¯<code>rm -f main global.o util.o ...</code></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">clean:</span><br>    rm -f main <span class="hljs-variable">$(OBJ)</span><br></code></pre></td></tr></table></figure><h1 id="ä¸€ã€Gprofå·¥å…·çš„ä½¿ç”¨"><a href="#ä¸€ã€Gprofå·¥å…·çš„ä½¿ç”¨" class="headerlink" title="ä¸€ã€Gprofå·¥å…·çš„ä½¿ç”¨"></a>ä¸€ã€Gprofå·¥å…·çš„ä½¿ç”¨</h1><blockquote><p>âš å·¥å…·ä¸»è¦ç”¨äºåˆ†æå‡½æ•°è°ƒç”¨ï¼Œä¸è¦å¼•å…¥å¤šçº¿ç¨‹ï¼Œå°¤å…¶æ˜¯é”æœºåˆ¶ä¼šè¯¯å¯¼çƒ­ç‚¹åˆ†æã€‚<br>âš å»ºè®®å¼€å¯ç¼–è¯‘å™¨ -O2 çº§åˆ«çš„ä¼˜åŒ–ã€‚</p></blockquote><p>gprof é€šå¸¸ä½œä¸º GNU Binutils çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨å¤§å¤šæ˜¯ Linux å‘è¡Œç‰ˆä¸­å·²ç»é›†æˆã€‚<br>gprof æ˜¯ GNU é¡¹ç›®ä¸­æ€§èƒ½åˆ†æå·¥å…·ï¼Œç”¨äºåˆ†ææ¯ä¸ª Cã€C++ å‡½æ•°è°ƒç”¨å’Œå‡½æ•°è°ƒç”¨æ—¶é—´ã€‚å®ƒé€šè¿‡æµ‹é‡ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„å‡½æ•°è°ƒç”¨é¢‘ç‡å’Œè¿è¡Œæ—¶é—´æ¥å¸®åŠ©å®šä½ç¨‹åºçƒ­ç‚¹å’Œçƒ­ç‚¹å‡½æ•°ã€‚ä»è€Œå®šä½å¯èƒ½çš„æ€§èƒ½ç“¶é¢ˆã€‚</p><h2 id="1ã€ä½¿ç”¨æ­¥éª¤"><a href="#1ã€ä½¿ç”¨æ­¥éª¤" class="headerlink" title="1ã€ä½¿ç”¨æ­¥éª¤"></a>1ã€ä½¿ç”¨æ­¥éª¤</h2><h3 id="aã€ç¼–è¯‘å‰"><a href="#aã€ç¼–è¯‘å‰" class="headerlink" title="aã€ç¼–è¯‘å‰"></a>aã€ç¼–è¯‘å‰</h3><p>åœ¨ä½¿ç”¨ gcc ç¼–è¯‘ C++ ç¨‹åºä»£ç æ—¶ï¼Œåœ¨ç¼–è¯‘å‚æ•°å†…åŠ å…¥ <code>-pg</code> å‘Šè¯‰ç¼–è¯‘å™¨å¼•å…¥ gprof ä»£ç ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">g++ -g -pg -o main main.cpp<br></code></pre></td></tr></table></figure><p>è¿™æ®µç¨‹åºä¼šåŒ…å«å¸¦æœ‰ <code>gprof</code> æ€§èƒ½åˆ†ææ‰€éœ€çš„å…¨éƒ¨ä»£ç ã€‚<br>ğŸ”¥æ­£å¼æäº¤ç¨‹åºè®°å¾—åˆ é™¤ç¼–è¯‘å‚æ•° <code>-pg</code> ï¼Œæ€§èƒ½åˆ†ææ‰€éœ€ä»£ç æœ¬èº«ä¼šæ‹–æ…¢ç¨‹åºã€‚</p><h3 id="bã€åƒå¹³å¸¸ä¸€æ ·è¿è¡Œç¨‹åº"><a href="#bã€åƒå¹³å¸¸ä¸€æ ·è¿è¡Œç¨‹åº" class="headerlink" title="bã€åƒå¹³å¸¸ä¸€æ ·è¿è¡Œç¨‹åº"></a>bã€åƒå¹³å¸¸ä¸€æ ·è¿è¡Œç¨‹åº</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./main<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿è¡Œç¨‹åºåï¼Œä¼šåœ¨æœ¬åœ°ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª <code>gmon.out</code> çš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…è®°å½•ç¨‹åºè¿è¡Œçš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><h3 id="cã€å¯è§†åŒ–æŠ¥å‘Š"><a href="#cã€å¯è§†åŒ–æŠ¥å‘Š" class="headerlink" title="cã€å¯è§†åŒ–æŠ¥å‘Š"></a>cã€å¯è§†åŒ–æŠ¥å‘Š</h3><p>è°ƒç”¨ <code>gprof</code> å·¥å…·å¯è§†åŒ– <code>gmon.out</code> æ–‡ä»¶ï¼Œæ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gprof main gmon.out &gt; analysis.txt<br></code></pre></td></tr></table></figure><p>å¾—åˆ°ä¸€ä¸ª <code>analysis.txt</code> çš„æ–‡æœ¬æ–‡ä»¶ï¼Œé‡Œé¢è®°è½½ç¨‹åºè¿è¡Œçš„å‡½æ•°è°ƒç”¨ä¿¡æ¯å’Œæ•°æ®ä¿¡æ¯ã€‚</p><h2 id="2ã€å¦‚ä½•åˆ†æ"><a href="#2ã€å¦‚ä½•åˆ†æ" class="headerlink" title="2ã€å¦‚ä½•åˆ†æ"></a>2ã€å¦‚ä½•åˆ†æ</h2><h3 id="aã€ç¬¬ä¸€éƒ¨åˆ†"><a href="#aã€ç¬¬ä¸€éƒ¨åˆ†" class="headerlink" title="aã€ç¬¬ä¸€éƒ¨åˆ†"></a>aã€ç¬¬ä¸€éƒ¨åˆ†</h3><p>åˆæ¬¡æ‰“å¼€ <code>analysis.txt</code> æ–‡ä»¶ï¼Œçœ‹åˆ°å†…å®¹å¦‚ä¸‹ï¼š<br><img src="/2024/11/12/%E5%AD%A6%E4%B9%A0-C-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/a6e2ecc6-6f1f-46c8-a929-462ef2acdde6.png"></p><p>ä¸€åˆ—ä¸€åˆ—æ¥è§‚å¯Ÿï¼š</p><ol><li>ç¬¬ä¸€åˆ—è¯´æ˜å½“å‰å‡½æ•°è¿è¡Œæ—¶é—´å ç¨‹åºæ€»è¿è¡Œæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚è¿™é‡Œä¸€çœ¼çœ‹åˆ° Pin::getTimingCritical() è°ƒç”¨äº† 12 äº¿æ¬¡ï¼Œå ç”¨æ—¶é—´é«˜è¾¾ 16% ï¼Œä¼˜åŒ–çš„ç¬¬ä¸€æ­¥å¿…ç„¶æ˜¯å®ƒã€‚</li><li>ç¬¬äºŒåˆ—æ˜¯ç´¯è®¡è¿è¡Œæ—¶é—´ï¼Œä¸€èˆ¬ä¸å…³æ³¨ã€‚</li><li>ç¬¬ä¸‰åˆ—æ˜¯å‡½æ•°è¿è¡Œæ—¶é—´ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•° Pin::getTimingCritical æ€»å…±çš„è¿è¡Œæ—¶é—´ä¸º 3 ç§’ã€‚</li><li>ç¬¬å››åˆ—è¯´æ˜å‡½æ•°è¢«è°ƒç”¨æ¬¡æ•°ã€‚æœ‰æ—¶å€™ä¸€ä¸ªå‡½æ•°è¿è¡Œç¼“æ…¢ä¸æ˜¯å‡½æ•°æœ¬èº«é—®é¢˜ï¼Œæ˜¯è¢« call äº†å¤ªå¤šæ¬¡ã€‚å› æ­¤å‡½æ•°æœ¬èº«ä¸æ˜¯ä¼˜åŒ–å¯¹è±¡åº”è¯¥é‡ç‚¹å…³ç…§å…¶è°ƒç”¨æ¬¡æ•°ã€‚</li></ol><h3 id="bã€ç¬¬äºŒéƒ¨åˆ†"><a href="#bã€ç¬¬äºŒéƒ¨åˆ†" class="headerlink" title="bã€ç¬¬äºŒéƒ¨åˆ†"></a>bã€ç¬¬äºŒéƒ¨åˆ†</h3><p>çœ‹å®Œç¬¬ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥åŸºæœ¬äº†è§£ç¨‹åºä¸­çƒ­ç‚¹å’Œçƒ­ç‚¹äº§ç”Ÿçš„åŸå› ï¼Œä½†æ˜¯æ— æ³•å‘Šè¯‰ä½ å¦‚ä½•å»ä¼˜åŒ–ï¼Œæ¯”å¦‚çŸ¥é“ <code>Pin::getTimingCritical</code> å‡½æ•°è¢«è°ƒç”¨å¾ˆå¤šæ¬¡ï¼Œä½†æ˜¯ä¸çŸ¥é“åœ¨å“ªäº›åœ°æ–¹è¢«è°ƒç”¨äº†ã€‚<br>è¿™æ—¶å€™ç»§ç»­å‘ä¸‹æŸ¥çœ‹ï¼Œåœ¨å¤§çº¦ <code>1000~5000</code> è¡Œå·¦å³çš„ä½ç½®ï¼Œè§‚å¯Ÿåˆ°å¦‚ä¸‹æ‰€ç¤ºç»“æœï¼š</p><p><img src="/2024/11/12/%E5%AD%A6%E4%B9%A0-C-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/91567ac0-37e8-4a4d-bdc2-46f36b471837.png"></p><ol><li>ç¬¬ä¸€åˆ—å‘Šè¯‰ä½ ï¼Œå½“å‰å‡½æ•°è¿è¡Œæ—¶é—´å æ€»æ—¶é—´çš„ç™¾åˆ†æ¯”ï¼Œæ‰“å¤´çš„ä¸€å®šæ˜¯ main å‡½æ•°ã€‚</li><li>ç¬¬äºŒåˆ—ï¼Œå‡½æ•°è‡ªèº«ç”¨æ—¶ï¼Œä¸åŒ…æ‹¬å‡½æ•°å†…éƒ¨è°ƒç”¨çš„ç”¨æ—¶ï¼Œä¾‹å¦‚ Tile::sendOutOffer å‡½æ•°å ç”¨äº† 51 ç§’è¿è¡Œæ—¶é—´çš„ 46 ç§’ï¼Œä½†æ˜¯è‡ªèº«è¿è¡Œä»…ä»… 0.03 ç§’ï¼Œå› æ­¤ Tile::sendOutOffer è‡ªèº«ä¸æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œé—®é¢˜åœ¨è¿™ä¸ªå‡½æ•°å†…éƒ¨è°ƒç”¨ä¸Šã€‚</li><li>ç¬¬ä¸‰åˆ—ï¼Œå‡½æ•°åŠ ä¸Šå†…éƒ¨è°ƒç”¨æ€»è¿è¡Œæ—¶é—´ã€‚</li><li>ç¬¬å››åˆ—ï¼Œå·¦è¾¹æ˜¯åœ¨ main ä¸­è¯¥å‡½æ•°è°ƒç”¨æ¬¡æ•°ï¼Œå³è¾¹æ˜¯æ€»è°ƒç”¨æ¬¡æ•°ã€‚ç”¨äºå®šä½è°ƒç”¨æ¬¡æ•°çš„çƒ­ç‚¹ã€‚</li><li>ç¬¬äº”åˆ—ï¼Œå‡½æ•°åç§°ï¼Œé™„å¸¦çš„æ–¹æ‹¬å·æ˜¯ index åˆ—çš„ä½ç½®ã€‚</li></ol><p><img src="/2024/11/12/%E5%AD%A6%E4%B9%A0-C-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/65488e8e-5fc8-4e38-9bc9-9925e1eb4034.png"></p><p>ç»§ç»­å¾€ä¸‹ï¼ŒæŸ¥çœ‹ <code>Tile::sendOutOffer</code> å‡½æ•°çš„è¿è¡Œæ—¶é—´å æ¯”ï¼Œå‘ç° <code>scorecompute</code> æ˜¯å¤§å¤´ã€‚å¹¶ä¸” <code>Tile::sendOutOffer</code> è´¡çŒ®äº† <code>scoreCompute</code> è¶…è¿‡ 99% çš„è°ƒç”¨æ¬¡æ•°ã€‚<br>åŸºæœ¬ç¡®å®šæ–¹é’ˆï¼Œä¼˜åŒ– <code>scoreCompute</code> çš„è¿è¡Œæ—¶é—´ï¼Œå‡å°‘ <code>Tile::sendOutOffer</code> å¯¹ <code>scoreCompute</code> çš„éå¿…è¦è°ƒç”¨ã€‚</p><h2 id="3ã€å¤šçº¿ç¨‹"><a href="#3ã€å¤šçº¿ç¨‹" class="headerlink" title="3ã€å¤šçº¿ç¨‹"></a>3ã€å¤šçº¿ç¨‹</h2><p>è¿™ä¸ªæ–¹æ³•ä¹Ÿèƒ½çœ‹åˆ°å¤šçº¿ç¨‹çš„ç¨‹åºè¿è¡Œæ—¶é—´ï¼Œä½†æ˜¯ä¸å»ºè®®ã€‚é‡Œé¢ç»Ÿè®¡çš„å‡½æ•°è°ƒç”¨æ¬¡æ•°ä¸å¯ä¿¡ï¼Œå­å‡½æ•°è°ƒç”¨æ—¶é—´åŸºæœ¬ä¸å¯ä¿¡ã€‚ä½†æ˜¯åœ¨é”æœºåˆ¶ç­‰ç›¸å…³ä¿¡æ¯çš„æ¢æŸ¥ä¸Šå¯ä»¥çœ‹å‡ºä¸€äº›ç«¯å€ªã€‚<br>æ¯”å¦‚è¯´ï¼šå¦‚æœç¨‹åºä½¿ç”¨è¿‡å¤šé”æœºåˆ¶ï¼Œé”åŒæ­¥æ˜¯ç¨‹åºç¼“æ…¢çš„é‡è¦åŸå› ï¼Œé‚£ä¹ˆå¯ä»¥çœ‹åˆ° lock çš„åŠ é”å‡½æ•°è°ƒç”¨å ç”¨äº†å¤§é‡æ—¶é—´ã€‚</p><h1 id="äºŒã€valgrind-å¤šçº¿ç¨‹æ€§èƒ½åˆ†æ"><a href="#äºŒã€valgrind-å¤šçº¿ç¨‹æ€§èƒ½åˆ†æ" class="headerlink" title="äºŒã€valgrind å¤šçº¿ç¨‹æ€§èƒ½åˆ†æ"></a>äºŒã€valgrind å¤šçº¿ç¨‹æ€§èƒ½åˆ†æ</h1><blockquote><p>æƒ³åˆ°å§ï¼Œå†…å­˜æ£€æµ‹å·¥å…·ä¹Ÿæä¾›äº†å¯¹äºå¤šçº¿ç¨‹é”ç«äº‰çš„æ€§èƒ½åˆ†æã€‚è¿™é‡Œå°è¯•ä½¿ç”¨å…¶ä¸­çº¿ç¨‹åˆ†æå·¥å…·æ¥å®šä½å¤šçº¿ç¨‹ç¨‹åºè¿è¡Œç¼“æ…¢é—®é¢˜ã€‚<br>æœ¬è´¨ä¸Šæ˜¯ä½¿ç”¨ ValGrind çš„å‡½æ•°è°ƒç”¨åˆ†æå·¥å…·å®ç°çš„ã€‚</p></blockquote><p>ä¸€äº›è¯´æ˜</p><ol><li>ç›¸æ¯” gprof åœ¨ç¼–è¯‘ç¨‹åºæ—¶ä¸éœ€è¦é¢å¤–å‚æ•°ï¼Œä½†æ˜¯æ¨èåŠ ä¸Š <code>-g</code> è°ƒè¯•å‚æ•°ã€‚</li><li>è¿™ä¸ªå·¥å…·ä¸å»ºè®®å¼€å¯ä»»ä½•çš„ä»£ç ä¼˜åŒ–é€‰é¡¹ï¼Œå¦‚ <code>-O2</code> ã€ <code>-O3</code> ç­‰ç­‰ï¼Œé˜²æ­¢å®šä½åˆ°é”™è¯¯çš„ä»£ç è¡Œã€‚</li><li>åŸå§‹è¾“å‡ºååˆ†éš¾ä»¥é˜…è¯»ï¼Œå»ºè®®ä½¿ç”¨éƒ¨åˆ†å¼€æºçš„æ•°æ®é˜…è¯»å™¨ï¼ˆå¦‚ <a href="https://github.com/KDE/kcachegrind"><code>kcachegrind</code></a>ï¼‰è¿›è¡Œå¯è§†åŒ–æ€§èƒ½åˆ†æã€‚</li></ol><h2 id="1ã€ä½¿ç”¨æ­¥éª¤-1"><a href="#1ã€ä½¿ç”¨æ­¥éª¤-1" class="headerlink" title="1ã€ä½¿ç”¨æ­¥éª¤"></a>1ã€ä½¿ç”¨æ­¥éª¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">valgrind --tool=callgrind ./a.out<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯å¤šçº¿ç¨‹ï¼Œé‚£ä¹ˆéœ€è¦é¢å¤–åŠ ä¸Šä¸€è¡Œå‚æ•°ï¼Œ<code>valgrind</code> å·¥å…·ä¼šä¸ºæ¯ä¸ªçº¿ç¨‹å•ç‹¬ç”Ÿæˆä¸€ä¸ªè®°å½•æ–‡ä»¶ <code>callgrind.out.xxx</code> ï¼ˆå…¶ä¸­çš„xxxä»£è¡¨è¿›ç¨‹å·ï¼‰ï¼Œæ–¹ä¾¿ä¹‹åæ¢æŸ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">valgrind --tool=callgrind -separate-threads=<span class="hljs-built_in">yes</span> ./a.out<br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨ä¸Šé¢çš„å·¥å…·ï¼Œåˆ™ä¼šç”Ÿæˆå¤šä¸ªè®°å½•æ–‡ä»¶ <code>callgrind.out.xxx</code> å’Œ <code>callgrind.out.xxx-01</code> â€¦â€¦ åé¢çš„æ•°å­—ä»£è¡¨ä¸åŒçš„çº¿ç¨‹ã€‚</p><h2 id="2ã€å¦‚ä½•åˆ†æ-1"><a href="#2ã€å¦‚ä½•åˆ†æ-1" class="headerlink" title="2ã€å¦‚ä½•åˆ†æ"></a>2ã€å¦‚ä½•åˆ†æ</h2><p>æ‰¾åˆ°ä¸Šä¸€æ­¥ç”Ÿæˆçš„æ–‡ä»¶ <code>callgrind.out.xxx</code> ï¼Œå¦‚æœæœ‰å¯è§†åŒ–åˆ†æå·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·æ‰“å¼€æ–‡ä»¶ã€‚è¿™é‡Œå°†è¦è¯´æ˜å¦‚æœæ²¡æœ‰ä¸‹è½½å·¥å…·å¦‚ä½•å»åˆ†æç¨‹åºã€‚</p><h3 id="aã€æ²¡æœ‰å¯è§†åŒ–å·¥å…·æ—¶"><a href="#aã€æ²¡æœ‰å¯è§†åŒ–å·¥å…·æ—¶" class="headerlink" title="aã€æ²¡æœ‰å¯è§†åŒ–å·¥å…·æ—¶"></a>aã€æ²¡æœ‰å¯è§†åŒ–å·¥å…·æ—¶</h3><p>åˆ©ç”¨è‡ªå¸¦çš„ <code>callgrind_annotate</code> å·¥å…·ï¼Œç„¶åæŠŠè¾“å‡ºå†™åˆ° run.log ä¸Šå¹¶æ‰“å¼€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">callgrind_annotate ./callgrind.out.xxx &gt; run.log<br></code></pre></td></tr></table></figure><p>æ‰“å¼€æ–‡ä»¶å‘ç°å¦‚ä¸‹ï¼š<br><img src="/2024/11/12/%E5%AD%A6%E4%B9%A0-C-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/a2efc85e-e7de-41c0-bb43-8725d8eb6b4a.png"></p><ol><li>å¿½ç•¥<font color="#00b0f0">æ·¡è“è‰²æ¡†</font>å†…å®¹ï¼Œé‚£åªæ˜¯ä¸€äº›åŸºæœ¬ä¿¡æ¯ã€‚</li><li><font color="#ff0000">çº¢è‰²æ¡†1</font>ï¼Œå‡½æ•°å¤´å¼€å§‹éƒ¨åˆ†æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œè¯´æ˜æ˜¯æ ‡å‡†åº“çš„è°ƒç”¨ï¼Œè¿™é‡Œä¸¾ä¾‹æ˜¯ malloc å’Œ free æ ‡å‡†åº“ã€‚</li><li><font color="#ff0000">çº¢è‰²æ¡†2</font>ï¼Œå‡½æ•°å¤´æ˜¯ <code>???</code> æ˜¯æœ¬åœ°ä»£ç ï¼Œç¼–è¯‘æ—¶æ²¡æœ‰ç»å¯¹è·¯å¾„ï¼Œå¯ä»¥ä»¥æ­¤åŒºåˆ†æ ‡å‡†åº“å’Œè‡ªå·±å®ç°çš„éƒ¨åˆ†ã€‚<br>ä½†æ˜¯ï¼Œè¿™ä¸ªç¨‹åºçš„åŠŸèƒ½ä¹Ÿå°±åˆ°æ­¤ä¸ºæ­¢äº†ï¼Œåªèƒ½çœ‹åˆ°å“ªäº›å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°æœ€å¤šï¼Œå®Œå…¨çœ‹ä¸è§å„ä¸ªå‡½æ•°çš„æ‰§è¡Œæ—¶é—´ä¸è°ƒç”¨æ ˆçš„åˆ†å¸ƒæƒ…å†µã€‚</li></ol><h3 id="bã€æœ‰å¯è§†åŒ–å·¥å…·æ—¶"><a href="#bã€æœ‰å¯è§†åŒ–å·¥å…·æ—¶" class="headerlink" title="bã€æœ‰å¯è§†åŒ–å·¥å…·æ—¶"></a>bã€æœ‰å¯è§†åŒ–å·¥å…·æ—¶</h3><p>è¿™é‡Œå› ä¸ºæ‰“ä¸å¼€æœåŠ¡å™¨çš„è¿œç¨‹æ¡Œé¢äº†ï¼Œç½‘ä¸Šæ‰¾äº†ä¸€ä¸ªç±»ä¼¼çš„å›¾ï¼Œæ•ˆæœå·®ä¸å¤šã€‚<br><img src="/2024/11/12/%E5%AD%A6%E4%B9%A0-C-%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%E5%AE%9E%E6%88%98/d64eea68-5902-4dd5-9705-9d0cc87c1550.jfif"></p><h2 id="3ã€ç•ªå¤–"><a href="#3ã€ç•ªå¤–" class="headerlink" title="3ã€ç•ªå¤–"></a>3ã€ç•ªå¤–</h2><blockquote><p>valgraindå·¥å…·è¿˜å¯ä»¥æ£€æµ‹é”ç«äº‰å’Œæ­»é”æƒ…å†µã€‚ä½¿ç”¨<code>helgrind</code>å·¥å…·å¯ä»¥æ£€æµ‹é”ç«äº‰æƒ…å†µã€‚</p></blockquote><h1 id="ä¸‰ã€Vtuneå¤šçº¿ç¨‹åˆ†æå·¥å…·"><a href="#ä¸‰ã€Vtuneå¤šçº¿ç¨‹åˆ†æå·¥å…·" class="headerlink" title="ä¸‰ã€Vtuneå¤šçº¿ç¨‹åˆ†æå·¥å…·"></a>ä¸‰ã€Vtuneå¤šçº¿ç¨‹åˆ†æå·¥å…·</h1><blockquote><p>ä»…Intelçš„CPUå¯ç”¨ï¼Œå…·ä½“å¯ä»¥å‚è€ƒintelçš„å®˜ç½‘æ‰‹å†Œã€‚<del>å› ä¸ºæˆ‘æ˜¯ AMD é“ç²‰</del>ï¼Œæ²¡æœ‰ intel çš„ U å°±æ²¡æœ‰ä»‹ç»ã€‚</p></blockquote><p>å°†æ¥ç”¨ä¸Šäº†å†è€ƒè™‘å­¦ä¹ ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>åˆ†äº«</tag>
      
      <tag>å­¦ä¹ </tag>
      
      <tag>æ€§èƒ½åˆ†æ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[æŠ˜è…¾]ç¼–è¯‘pytorch</title>
    <link href="/2024/09/18/%E6%8A%98%E8%85%BE-%E7%BC%96%E8%AF%91pytorch/"/>
    <url>/2024/09/18/%E6%8A%98%E8%85%BE-%E7%BC%96%E8%AF%91pytorch/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><blockquote><p>æœ€å¥½å…¨ç¨‹ç§‘å­¦ä¸Šç½‘ï¼Œé¢„è®¡éœ€è¦5~7GBçš„ä¸‹è½½é‡ã€‚<br>æœ¬æ•™ç¨‹å°è¯•åœ¨ Windows çš„ Docker ç¯å¢ƒä¸‹ç¼–è¯‘ç»™ Ubuntu20.04 çš„ torch&#x3D;2.3.0 CUDA11.7 ã€‚ï¼ˆè‡³äºä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªè¯¦è§LLMåœ¨CUDA11.7å®‰è£…ç»å†ï¼‰</p></blockquote><h1 id="é›¶ã€å‡†å¤‡å·¥ä½œ"><a href="#é›¶ã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="é›¶ã€å‡†å¤‡å·¥ä½œ"></a>é›¶ã€å‡†å¤‡å·¥ä½œ</h1><blockquote><p>âš âš âš è®°ä½ä¸€å®šè¦å…ˆæ£€æŸ¥ç›®æ ‡æœºå™¨æ˜¯å¦æœ‰NVIDIAé©±åŠ¨å’ŒCUDAç¯å¢ƒï¼ŒCUDNNæœ€å¥½ä¹Ÿæ£€æŸ¥ä¸€ä¸‹ï¼Œå¦åˆ™ç¼–è¯‘å¥½äº†åœ¨é‚£è¾¹ä¹Ÿè£…ä¸ä¸Šã€‚</p></blockquote><ol><li>ä»<a href="https://github.com/pytorch/pytorch">github&#x2F;pytorch</a>å¤„è·å¾—æœ€æ–°çš„pytorchæºä»£ç ï¼Œä¹‹åçš„å‘½ä»¤æ‰§è¡Œæ˜¯å‚è€ƒ<code>DockerFile</code>æ¥ç¼–å†™çš„ã€‚</li><li>ä»<code>NVIDIA CUDA 11.7</code>å¤„è·å¾— 11.7 CUDA çš„toolkitåŒ…ã€‚åœ¨å¼€å§‹å‰éœ€è¦ä¸‹è½½è¿™ä¸ªæ–‡ä»¶ã€‚</li><li>åŸºç¡€é•œåƒå‚è€ƒ<code>Dockerfile</code>ä½¿ç”¨çš„æ˜¯<code>Ubuntu:22.04</code>ï¼ˆMDä»å¤´å¼€å§‹è¿˜ä¸å¦‚ç›´æ¥ä¸‹ä¸€ä¸ª CUDA 11.7 çš„é•œåƒï¼Œè®°ä½è¦ä½¿ç”¨å’Œç›®æ ‡è®¡ç®—æœºä¸€æ ·çš„ç¯å¢ƒï¼Œä¾‹å¦‚æœ¬æ¬¡ä½¿ç”¨<code>Ubuntu:20.04</code>ï¼‰ä¹Ÿéœ€è¦æå‰å®‰è£…å®Œæ¯•ã€‚</li><li>ä»”ç»†è§‚å¯Ÿç›®æ ‡ç¯å¢ƒçš„é…ç½®ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºCUDAå®‰è£…ä½ç½®ã€CUDNNå¤´æ–‡ä»¶ä½ç½®ã€å®‰è£…Pythonç­‰ç­‰ï¼Œéœ€è¦åœ¨å®¹å™¨ä¸­å¤ç°ã€‚</li></ol><h1 id="ä¸€ã€å¼€å§‹ç¼–è¯‘"><a href="#ä¸€ã€å¼€å§‹ç¼–è¯‘" class="headerlink" title="ä¸€ã€å¼€å§‹ç¼–è¯‘"></a>ä¸€ã€å¼€å§‹ç¼–è¯‘</h1><h2 id="1ã€é…ç½®docker"><a href="#1ã€é…ç½®docker" class="headerlink" title="1ã€é…ç½®docker"></a>1ã€é…ç½®docker</h2><p>å»ºè®®ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨<code>ubuntu:22.04</code>é•œåƒï¼Œé»˜è®¤çš„å†…å­˜ç©ºé—´å¯èƒ½ä¸å¤Ÿç”¨ï¼Œéœ€è¦é¢å¤–æ‰©å……ä¸€éƒ¨åˆ†swapç©ºé—´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run --name torch_compile --privileged -it ubuntu:20.04 /bin/bash<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -it â€“cap-add SYS_ADMIN ubuntu:20.04 /bin/bash<br></code></pre></td></tr></table></figure><p>è¿›å…¥<code>ubuntu:22.04</code>åç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯æ›´æ–°ç¯å¢ƒï¼Œå®‰è£…å¿…å¤‡å·¥å…·ï¼ˆæœ€å¥½ç§‘å­¦ä¸Šç½‘ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt-get update &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \<br>        build-essential \<br>        ca-certificates \<br>        ccache \<br>        cmake \<br>        curl \<br>        git \<br>        wget \<br>        libjpeg-dev \<br>        libpng-dev &amp;&amp; \<br>    <span class="hljs-built_in">rm</span> -rf /var/lib/apt/lists/*<br></code></pre></td></tr></table></figure><p>å¦å¤–å»ºè®®å…ˆå®‰è£… <font color="#ff0000">NVIDIA CUDA 11.7 toolkit</font> ã€‚</p><h2 id="2ã€å®‰è£…pythonç¯å¢ƒ"><a href="#2ã€å®‰è£…pythonç¯å¢ƒ" class="headerlink" title="2ã€å®‰è£…pythonç¯å¢ƒ"></a>2ã€å®‰è£…pythonç¯å¢ƒ</h2><p>æŒ‡å®šä¸€äº›è¿è¡Œå˜é‡ï¼Œä¸‹è½½ Miniconda åŒ…å®‰è£… Python ç¯å¢ƒã€‚Pythonå’Œç›®æ ‡æœºå™¨ä¸Šçš„ä¸€è‡´ï¼ˆè¿™é‡Œå› ä¸ºç›®æ ‡æœºå™¨ä¸Šçš„Pythonæ˜¯3.11ç‰ˆæœ¬çš„ï¼Œè¿™é‡ŒæŒ‡å®š<code>PYTHON_VERSION</code>ä¸º3.11ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/sbin/update-ccache-symlinks<br><span class="hljs-built_in">mkdir</span> /opt/ccache &amp;&amp; ccache --set-config=cache_dir=/opt/ccache<br><span class="hljs-built_in">export</span> PATH=/opt/conda/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> PYTHON_VERSION=3.11<br><span class="hljs-built_in">export</span> MINICONDA_ARCH=x86_64<br>curl -fsSL -v -o ~/miniconda.sh -O  <span class="hljs-string">&quot;https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-<span class="hljs-variable">$&#123;MINICONDA_ARCH&#125;</span>.sh&quot;</span><br></code></pre></td></tr></table></figure><p>æ‰¾åˆ°<a href="https://github.com/pytorch/pytorch">github&#x2F;pytorch</a>æ–‡ä»¶å¤¹ä¸­çš„<code>requirements.txt</code>æ–‡ä»¶ã€‚å¹¶å¤åˆ¶åˆ°dockerä¸­å­˜æ”¾pytorchæºç çš„æ–‡ä»¶å¤¹ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> [path-to-pytorch-source-code]/requirements.txt .<br></code></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ python ç¯å¢ƒçš„å®‰è£…ï¼Œè¿™é‡Œå°±å®‰è£…åˆ°<code>/opt/conda</code>è¿™ä¸ªä½ç½®äº†ï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ä»¥ä¿è¯condaå‘½ä»¤çš„æ­£ç¡®è¯†åˆ«ã€‚ä¸å»ºè®®æ”¹åŠ¨å®‰è£…ä½ç½®ï¼Œå› ä¸ºæœ¬æ•™ç¨‹ä¹‹åè®¸å¤šæŒ‡ä»¤åŸºäºè¿™ä¸ªå®‰è£…ä½ç½®ç¼–å†™ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x ~/miniconda.sh &amp;&amp; \<br>    bash ~/miniconda.sh -b -p /opt/conda &amp;&amp; \<br>    /opt/conda/bin/conda install -y python=<span class="hljs-variable">$&#123;PYTHON_VERSION&#125;</span> cmake conda-build pyyaml numpy ipython &amp;&amp; \<br>    /opt/conda/bin/python -mpip install -r requirements.txt &amp;&amp; \<br>    /opt/conda/bin/conda clean -ya<br><span class="hljs-built_in">export</span> PATH=/opt/conda/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-comment"># conda install mkl</span><br><span class="hljs-comment"># conda install mkl-include</span><br></code></pre></td></tr></table></figure><h2 id="3ã€è¡¥é½ä»£ç "><a href="#3ã€è¡¥é½ä»£ç " class="headerlink" title="3ã€è¡¥é½ä»£ç "></a>3ã€è¡¥é½ä»£ç </h2><p>ä¸‹è½½ä¸‹æ¥çš„pytorchæºç ä»…åŒ…å«pytorchï¼Œè€Œpytorchè‡ªå·±çš„ä¾èµ–è¿˜éœ€è¦äºŒæ¬¡ä¸‹è½½ã€‚<br>æŠŠ<code>github/pytorch</code>æ‰€æœ‰æ–‡ä»¶ä¸‹è½½åˆ°&#x2F;opt&#x2F;pytorchè¿™ä¸ªä½ç½®ï¼Œæœ€å¥½ä½¿ç”¨ <code>git</code> å‘½ä»¤æ¥è·å¾—ï¼Œç›´æ¥ä¸‹è½½è·å¾—çš„åŒ…ç¼ºå°‘ç¬¬ä¸‰æ–¹åº“ï¼Œéœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œåº“æ–‡ä»¶çš„è¡¥é½ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /opt<br>git <span class="hljs-built_in">clone</span> https://github.com/pytorch/pytorch.git<br><span class="hljs-built_in">cd</span> /opt/pytorch<br>git checkout v2.3.0<br>git submodule update --init --recursive<br></code></pre></td></tr></table></figure><p>å»ºè®®å¤šæ¬¡æ‰§è¡Œï¼Œä»¥ç¡®ä¿æ‰€æœ‰çš„åº“éƒ½èƒ½ä¸‹è½½ä¸‹æ¥ã€‚å¦‚æœç¼–è¯‘æ—¶æŠ¥åº“æ–‡ä»¶çš„é”™ï¼Œéœ€è¦åˆ æ‰æ•´ä¸ªå¯¹åº”çš„åº“æ–‡ä»¶ï¼Œé‡æ–°ä¸‹è½½ã€‚</p><h2 id="4ã€è®¾ç½®ç¼–è¯‘å‚æ•°"><a href="#4ã€è®¾ç½®ç¼–è¯‘å‚æ•°" class="headerlink" title="4ã€è®¾ç½®ç¼–è¯‘å‚æ•°"></a>4ã€è®¾ç½®ç¼–è¯‘å‚æ•°</h2><p><code>PYTHON_VERSION</code>å¾ˆå¥½ç†è§£ï¼Œç›®æ ‡æœºå™¨ä¸Šå®‰è£…ä»€ä¹ˆç‰ˆæœ¬çš„pythonå°±æŒ‡å®šä»€ä¹ˆã€‚<code>CUDA_VERSION</code>æ ¹æ®ç›®æ ‡æœºå™¨ä¸Šå®é™…çš„CUDAç‰ˆæœ¬å†³å®šï¼ˆæœºå™¨ä¸Šåªæœ‰CUDA11.7ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> PYTHON_VERSION=3.11<br><span class="hljs-built_in">export</span> CUDA_VERSION=11.7<br><span class="hljs-built_in">export</span> CUDA_CHANNEL=nvidia<br><span class="hljs-built_in">export</span> INSTALL_CHANNEL=pytorch-nightly<br><span class="hljs-comment"># Automatically set by buildx</span><br>/opt/conda/bin/conda update -y -n base -c defaults conda<br><span class="hljs-comment">#/opt/conda/bin/conda install -c &quot;$&#123;INSTALL_CHANNEL&#125;&quot; -y python=$&#123;PYTHON_VERSION&#125;</span><br><span class="hljs-comment">#/opt/conda/bin/conda install -c &quot;$&#123;INSTALL_CHANNEL&#125;&quot; -c &quot;$&#123;CUDA_CHANNEL&#125;&quot; -y &quot;python=$&#123;PYTHON_VERSION&#125;&quot; pytorch torchvision torchaudio &quot;pytorch-cuda=$(echo $CUDA_VERSION | cut -d&#x27;.&#x27; -f 1-2)&quot;</span><br>/opt/conda/bin/conda clean -ya<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘ï¼Œå…·ä½“æœ‰å“ªäº›å‚æ•°å¯é€‰å¯ä»¥æ£€æŸ¥ <code>setup.py</code> æ–‡ä»¶ï¼Œå¦å¤–ä»¥ä¸‹ä»£ç ä¸­çš„<code>CUDA_HOME</code>å˜é‡éœ€è¦è‡ªè¡Œç¡®å®šã€‚</p><blockquote><p>âš åœ¨æ‰§è¡Œä¸‹é¢å‘½ä»¤å‰å…ˆæ£€æŸ¥<a href="#%E4%BA%8Cgpu%E4%BD%BF%E7%94%A8">GPUä½¿ç”¨ç« èŠ‚</a>æ˜¯å¦æ­£ç¡®å®‰è£…ã€‚<br>âš ç¼–è¯‘è¿‡ç¨‹éœ€è¦è¾ƒå¤šå†…å­˜ç©ºé—´ï¼Œæå‰åˆ†é…è¾ƒå¤§çš„swapç©ºé—´æˆ–è€…åŠ ä¸Š<code>MAX_JOBS=1</code>æ¥é™åˆ¶åŒæ—¶ç¼–è¯‘çš„æ•°é‡é˜²æ­¢OOMé”™è¯¯ã€‚ä½†æ˜¯ä¼šæ˜¾è‘—é™ä½ç¼–è¯‘é€Ÿåº¦ï¼Œå¦‚æœå†…å­˜å¤Ÿå¤§ï¼Œå»ºè®®æŒ‰ç…§CPUæ ¸å¿ƒæ•°é‡æ¥è®¾ç½®ã€‚<br>âš æ­£å¼å¼€å§‹ç¼–è¯‘å‰æœ€å¥½æ£€æŸ¥ä¸€æ¬¡ç”Ÿæˆçš„ç¼–è¯‘é…ç½®ï¼Œæ˜¯å¦æ­£ç¡®å¼€å¯äº† <code>USE_CUDA</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /opt/pytorch<br>make triton<br><span class="hljs-built_in">export</span> USE_CUDA=ON<br><span class="hljs-built_in">export</span> PYTORCH_BUILD_NUMBER=2.3.0<br><span class="hljs-built_in">export</span> USE_NUMPY=ON<br><span class="hljs-built_in">export</span> USE_QNNPACK=ON<br><span class="hljs-built_in">export</span> USE_NNPACK=ON<br><span class="hljs-built_in">export</span> USE_DISTRIBUTED=ON<br><span class="hljs-built_in">export</span> BLAS=MKL <span class="hljs-comment"># å‡ºç° mkl_gemm_bf16bf16f32: ATen not compiled with MKL support é—®é¢˜</span><br><span class="hljs-built_in">export</span> USE_CUDNN=OFF  <span class="hljs-comment"># è¶…ç®—ä¸­å¿ƒæ²¡æœ‰ï¼ˆæˆ‘TMâ€¦â€¦ï¼‰ä¸€å®šè¦æ³¨æ„ï¼Œæœ‰CUDAä¸ç­‰äºæœ‰CUDNN</span><br><span class="hljs-comment"># TORCH_CUDA_ARCH_LIST=&quot;7.0 7.2 7.5 8.0 8.6 8.7 8.9 9.0 9.0a&quot; TORCH_NVCC_FLAGS=&quot;-Xfatbin -compress-all&quot; CMAKE_PREFIX_PATH=&quot;/opt/conda/bin&quot;   USE_MPI=1 USE_OPENMP=1 USE_FLASH_ATTENTION=1 USE_LMDB=1 PYTORCH_BUILD_NUMBER=2.3.0 CUDA_HOME= </span><br>python setup.py bdist_wheel<br></code></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥åœ¨<code>/opt/pytorch/dist</code>ç›®å½•ä¸‹æ‰¾åˆ°åˆšåˆšç¼–è¯‘å¥½çš„å¯ä»¥ç›´æ¥å®‰è£…çš„æ¨¡å—ã€‚<br>å®‰è£…åæ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤å¯ä»¥æ£€æŸ¥torchæ˜¯å¦æ”¯æŒè°ƒç”¨CUDA</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -c <span class="hljs-string">&#x27;import torch ; print(torch.cuda._is_compiled())&#x27;</span><br></code></pre></td></tr></table></figure><h1 id="äºŒã€GPUä½¿ç”¨"><a href="#äºŒã€GPUä½¿ç”¨" class="headerlink" title="äºŒã€GPUä½¿ç”¨"></a>äºŒã€GPUä½¿ç”¨</h1><p>â—ä»¥ä¸‹æŒ‡ä»¤å‡éœ€è¦rootæƒé™ï¼Œå¦‚æœæ˜¯dockerç¯å¢ƒå¯ä»¥æ— è§†ã€‚<br>å¿½ç„¶å‘ç°è¿è¡Œä»<a href="https://developer.nvidia.com/cuda-11-7-0-download-archive?target_os=Linux&target_arch=x86_64&Distribution=Ubuntu&target_version=20.04&target_type=runfile_local">NVIDIA CUDA 11.7</a>è¿™é‡Œè·å¾—çš„åŒ…æ—¶ï¼Œä¸éœ€è¦å®‰è£… Driver å¯ä»¥ç›´æ¥å®‰è£… toolkit ï¼Œåæ­£åªæ˜¯è·‘ç¼–è¯‘è€Œå·²ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰ Driver éƒ½æ— æ‰€è°“äº†ã€‚<del>ï¼ˆäºæˆ‘è¿˜æäº†å¥½ä¹…å¼„ WSL å®‰è£… NVIDIA Driverï¼Œè‰¹ï¼‰</del></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x cuda_11.7.0_515.43.04_linux.run<br>sh cuda_11.7.0_515.43.04_linux.run <br></code></pre></td></tr></table></figure><p>å½“ä½ çœ‹åˆ°ä¸‹é¢çš„å†…å®¹æ—¶ï¼Œè¯´æ˜ CUDA å·²ç»å®‰è£…å®Œæ¯•ï¼Œéœ€è¦å‘<code>PATH</code>å˜é‡åŠ å…¥cudaçš„å¯æ‰§è¡Œæ–‡ä»¶ä½ç½®ï¼Œä»¥åŠlibä½ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@2345f5f46b09:~# sh cuda_11.7.0_515.43.04_linux.run<br>===========<br>= Summary =<br>===========<br><br>Driver:   Not Selected<br>Toolkit:  Installed <span class="hljs-keyword">in</span> /usr/local/cuda-11.7/<br><br>Please make sure that<br> -   PATH includes /usr/local/cuda-11.7/bin<br> -   LD_LIBRARY_PATH includes /usr/local/cuda-11.7/lib64, or, add /usr/local/cuda-11.7/lib64 to /etc/ld.so.conf and run ldconfig as root<br><br>To uninstall the CUDA Toolkit, run cuda-uninstaller <span class="hljs-keyword">in</span> /usr/local/cuda-11.7/bin<br>***WARNING: Incomplete installation! This installation did not install the CUDA Driver. A driver of version at least 515.00 is required <span class="hljs-keyword">for</span> CUDA 11.7 functionality to work.<br>To install the driver using this installer, run the following <span class="hljs-built_in">command</span>, replacing &lt;CudaInstaller&gt; with the name of this run file:<br>    <span class="hljs-built_in">sudo</span> &lt;CudaInstaller&gt;.run --silent --driver<br><br>Logfile is /var/log/cuda-installer.log<br></code></pre></td></tr></table></figure><p>âš æ³¨æ„è¿™é‡Œåªå®‰è£…äº†CUDAï¼Œæ²¡æœ‰<code>CUDNN</code>ï¼Œä»ç„¶éœ€è¦åˆ°<a href="https://developer.nvidia.com/cudnn">CUDNN</a>è¿™é‡Œä¸‹è½½ç›¸å…³æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨æŒ‡ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://developer.download.nvidia.com/compute/cudnn/9.2.1/local_installers/cudnn-local-repo-ubuntu2204-9.2.1_1.0-1_amd64.deb<br>dpkg -i cudnn-local-repo-ubuntu2204-9.2.1_1.0-1_amd64.deb<br>apt-get update<br><span class="hljs-comment"># ç„¶åæ ¹æ®CUDA11è¿˜æ˜¯CUDA12æŒ‰ç…§éœ€æ±‚è¿è¡Œä¸‹é¢çš„æŒ‡ä»¤ï¼Œä¸ªäººå®é™…æµ‹è¯•å‘ç° dpkg ä¹‹åcudnnå°±èƒ½æ‰¾åˆ°äº†</span><br>apt install cudnn-cuda-11<br><span class="hljs-comment"># æˆ–è€…</span><br>apt install cudnn-cuda-12<br></code></pre></td></tr></table></figure><p>éšååˆ©ç”¨ä»¥ä¸‹æŒ‡ä»¤å¯ä»¥æ£€æŸ¥cudnnæ˜¯å¦æˆåŠŸå®‰è£…ã€‚çœ‹åˆ°ä¸‹å›¾æ‰€ç¤ºè¯´æ˜CUDNNå¥½äº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /usr/include/cudnn_version.h | grep CUDNN_MAJOR -A 2<br></code></pre></td></tr></table></figure><p><img src="/2024/09/18/%E6%8A%98%E8%85%BE-%E7%BC%96%E8%AF%91pytorch/5ac1836c-f60d-49e8-beca-c0d1cbe36316.png"></p><h1 id="ä¸‰ã€tmuxå¤šç»ˆç«¯å·¥å…·ä½¿ç”¨"><a href="#ä¸‰ã€tmuxå¤šç»ˆç«¯å·¥å…·ä½¿ç”¨" class="headerlink" title="ä¸‰ã€tmuxå¤šç»ˆç«¯å·¥å…·ä½¿ç”¨"></a>ä¸‰ã€tmuxå¤šç»ˆç«¯å·¥å…·ä½¿ç”¨</h1><p>åœ¨æ­¤æœŸé—´ä¼šæ‰“å¼€è®¸å¤šçª—å£ç”¨äºç¼–è¯‘å’Œæµ‹è¯•ï¼Œåœ¨æœ¬åœ°å¤šå¼€ç»ˆç«¯ä¸ä»…ååˆ†ç¹çï¼Œè€Œä¸”ä¼šå¿˜è®°æ¯ä¸ªç»ˆç«¯çš„åŠŸèƒ½ï¼Œä¸”ä¸èƒ½å……åˆ†åˆ©ç”¨ç°æœ‰ç»ˆç«¯çš„ç©ºé—´ã€‚å› æ­¤<code>tmux</code>å·¥å…·åº”è¿è€Œç”Ÿï¼Œè¿™é‡Œç®€è¦ä»‹ç»ä¸€éƒ¨åˆ†å…¶ä¸­çš„å¿«æ·é”®ï¼Œè¶³ä»¥åº”ä»˜æœ¬åœºæ™¯ã€‚<br>ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤åˆ›å»ºä¸€ä¸ª<code>tmux</code>ç»ˆç«¯æœåŠ¡ã€‚æŒ‡å®šåå­—ä¸ä»…å®¹æ˜“å¤ç°ï¼Œè€Œä¸”æ–¹ä¾¿æ—¥åæ¢å¤å·¥ä½œå°ã€‚è¿™é‡Œå› ä¸ºæˆ‘ä»¬æ˜¯ç¼–è¯‘pytorchï¼Œæ‰€ä»¥å–åä¸ºâ€œtorchâ€ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tmux new -s torch<br></code></pre></td></tr></table></figure><p>ç®€è¦ä»‹ç»ä¸€ä¸‹ä¸€äº›åŸºç¡€å¿«æ·é”®ï¼ˆâš åœ¨è¿›å…¥tmuxç»ˆç«¯åæ‰æœ‰æ•ˆï¼‰</p><ol><li><code>Ctrl</code>+<code>B</code>ï¼Œ<code>&quot;</code>æ˜¯å‚ç›´åˆ†å‰²å½“å‰ç»ˆç«¯ã€‚</li><li><code>Ctrl</code>+<code>B</code>ï¼Œ<code>%</code>æ˜¯æ°´å¹³åˆ†å‰²å½“å‰ç»ˆç«¯ã€‚</li><li><code>Ctrl</code>+<code>B</code>ï¼Œ<code>x</code>æ˜¯å…³é—­å½“å‰å…‰æ ‡æ‰€åœ¨ç»ˆç«¯ã€‚</li><li><code>Ctrl</code>+<code>B</code>ï¼Œ<code>d</code>æ˜¯ç¦»å¼€å½“å‰ç»ˆç«¯ï¼Œæ—¥åå¯ä»¥åˆ©ç”¨åå­—å›åˆ°å·¥ä½œå°ã€‚</li><li><code>Ctrl</code>+<code>B</code>ï¼Œä»»æ„æ–¹å‘é”®åˆ‡æ¢æ¿€æ´»çš„ç»ˆç«¯ã€‚<br>ç¦»å¼€åå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤é‡æ–°è¿æ¥å›å½“å‰ç»ˆç«¯ã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">tmux attach-sesstion -t torch<br></code></pre></td></tr></table></figure></li></ol><h1 id="å››ã€é”™è¯¯è§£å†³"><a href="#å››ã€é”™è¯¯è§£å†³" class="headerlink" title="å››ã€é”™è¯¯è§£å†³"></a>å››ã€é”™è¯¯è§£å†³</h1><h2 id="1ã€c-fatal-error-Killed-signal-terminated-program-cc1plus"><a href="#1ã€c-fatal-error-Killed-signal-terminated-program-cc1plus" class="headerlink" title="1ã€c++: fatal error: Killed signal terminated program cc1plus"></a>1ã€c++: fatal error: Killed signal terminated program cc1plus</h2><p>è¿™æ˜¯å› ä¸ºç¼–è¯‘è¿‡ç¨‹ä¸­å‡ºç°å†…å­˜ä¸è¶³å¯¼è‡´çš„ã€‚</p><h3 id="aã€æ–¹æ¡ˆä¸€"><a href="#aã€æ–¹æ¡ˆä¸€" class="headerlink" title="aã€æ–¹æ¡ˆä¸€"></a>aã€æ–¹æ¡ˆä¸€</h3><p>ä¸´æ—¶æ‰©å……è™šæ‹Ÿå†…å­˜ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤è¿›è¡Œæ‰©å……ï¼ˆä»¥ä¸‹å‡æŒ‡ä»¤éœ€è¦sudoæƒé™ï¼Œè€Œä¸”å¦‚æœä¸æŒ‰ç…§<a href="#1%E9%85%8D%E7%BD%AEdocker">é…ç½®docker</a>ç« èŠ‚æ¥ï¼Œåˆ°è¿™é‡Œå°±æ— æ³•æ‰©å……è™šæ‹Ÿå†…å­˜ï¼‰ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p /var/cache/swap/<br><span class="hljs-comment"># è¿™é‡Œçš„å«ä¹‰æ˜¯swapç©ºé—´å¤§å°ç­‰äº bs*count=4GB éœ€è¦è‡ªè¡Œä¿®æ”¹</span><br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/var/cache/swap/swap0 bs=64M count=64<br><span class="hljs-built_in">chmod</span> 0600 /var/cache/swap/swap0<br>mkswap /var/cache/swap/swap0<br>swapon /var/cache/swap/swap0<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‰§è¡Œç¬¬6æ¡æŒ‡ä»¤å‘ç”Ÿå¦‚ä¸‹é”™è¯¯ï¼Œéœ€è¦æ£€æŸ¥å¯åŠ¨é•œåƒæ˜¯å¦ä»¥ç‰¹æƒæ¨¡å¼è¿è¡Œå®¹å™¨ã€‚å¦‚æœä¸æ˜¯ï¼Œè¯·ä½¿ç”¨<code>æ–¹æ¡ˆäºŒ</code>ï¼Œæˆ–è€…é‡æ–°å¼€å§‹é…ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">swapon failed: Operation not permitted<br></code></pre></td></tr></table></figure><p>æœ€åæ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤èƒ½çœ‹åˆ°è‡ªå·±æ·»åŠ çš„æ–° swap åˆ†åŒºå³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">swapon -s<br></code></pre></td></tr></table></figure><h3 id="bã€æ–¹æ¡ˆäºŒ"><a href="#bã€æ–¹æ¡ˆäºŒ" class="headerlink" title="bã€æ–¹æ¡ˆäºŒ"></a>bã€æ–¹æ¡ˆäºŒ</h3><p>è®¾ç½®åŒæ—¶ç¼–è¯‘çš„çº¿ç¨‹æ•°é‡ï¼Œæœ€å¥½é¢„ç•™æ¯ä¸ªç¼–è¯‘çº¿ç¨‹2GBçš„å†…å­˜ç©ºé—´ã€‚è‡ªè¡Œè°ƒæ•´<code>MAX_JOBS</code>åçš„æ•°å­—ã€‚å¦‚æœå¼€å¯ CUDA ç¼–è¯‘éœ€è¦æ¯ä¸ªçº¿ç¨‹é¢„ç•™ 4~6GB çš„å†…å­˜ç©ºé—´ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> MAX_JOBS=2<br>python setup.py bdist_wheel<br></code></pre></td></tr></table></figure><h2 id="2ã€ValueError-could-not-identify-license-file-for-third-party-opentelemetry-cpp-tools-vcpkg-ports-sigslot"><a href="#2ã€ValueError-could-not-identify-license-file-for-third-party-opentelemetry-cpp-tools-vcpkg-ports-sigslot" class="headerlink" title="2ã€ValueError: could not identify license file for third_party&#x2F;opentelemetry-cpp&#x2F;tools&#x2F;vcpkg&#x2F;ports&#x2F;sigslot"></a>2ã€ValueError: could not identify license file for third_party&#x2F;opentelemetry-cpp&#x2F;tools&#x2F;vcpkg&#x2F;ports&#x2F;sigslot</h2><p>å‡ºç°è¿™ä¸ªé”™è¯¯æ˜¯å› ä¸º third_party å‡ºç°äº†ä¸è¯¥å‡ºç°çš„ç¬¬ä¸‰æ–¹ä¾èµ–ã€‚æ£€æŸ¥æ˜¯å¦åœ¨ç¬¬ä¸‰æ­¥git checkoutå‘½ä»¤ä¹‹å‰è¿è¡Œäº†git submoduleã€‚ç”¨ä»¥ä¸‹å‘½ä»¤è§£å†³å†²çªé—®é¢˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -f v2.3.0<br><span class="hljs-built_in">rm</span> [å‡ºç°é”™è¯¯çš„æ–‡ä»¶å¤¹]<br></code></pre></td></tr></table></figure><h2 id="3ã€Import-Error-â€¦-libstdc-so-6-version-â€˜GLIBCXX-3-4-30â€™-not-found"><a href="#3ã€Import-Error-â€¦-libstdc-so-6-version-â€˜GLIBCXX-3-4-30â€™-not-found" class="headerlink" title="3ã€Import Error: â€¦&#x2F;libstdc++.so.6: version â€˜GLIBCXX_3.4.30â€™ not found"></a>3ã€Import Error: â€¦&#x2F;libstdc++.so.6: version â€˜GLIBCXX_3.4.30â€™ not found</h2><p>æ¥è‡ªcondaçš„é”™è¯¯ï¼Œä¸€èˆ¬æ˜¯å› ä¸ºcondaå®‰è£…ç›®å½•ä¸‹çš„<code>libstdc++.so.6</code>æ²¡æœ‰è¿™ä¸ªæ ‡è®°ã€‚å¯ä»¥å…ˆç”¨ä¸‹é¢çš„æŒ‡ä»¤æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬æ˜¯å¦æœ‰è¿™ä¸ªæ ‡è®°ï¼Œç„¶åå†è€ƒè™‘æ˜¯å¦å‡çº§å†…æ ¸ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">strings /usr/lib/x86_64-linux-gnu/libstdc++.so.6 | grep GLIBCXX<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘å¾ˆå¹¸è¿çš„å‘ç°<code>GLIBCXX_3.4.30</code>å­˜åœ¨ï¼Œä¸ç”¨æ›´æ–°å†…æ ¸äº†ã€‚ä¸‹ä¸€æ­¥å°±æ˜¯æ›´æ–°condaçš„<code>libstdc++.so.6</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> [path to your conda]/lib<br><span class="hljs-comment"># å¤‡ä»½åŸå§‹æ–‡ä»¶</span><br><span class="hljs-built_in">mv</span> libstdc++.so.6 libstdc++.so.6.old<br><span class="hljs-comment"># åˆ›å»ºæ–°çš„è½¯é“¾æ¥</span><br><span class="hljs-built_in">ln</span> -s /usr/lib/x86_64-linux-gnu/libstdc++.so.6 libstdc++.so.6<br></code></pre></td></tr></table></figure><h2 id="4ã€ImportError-cannot-import-name-â€˜versionâ€˜-from-â€˜torchvisionâ€™"><a href="#4ã€ImportError-cannot-import-name-â€˜versionâ€˜-from-â€˜torchvisionâ€™" class="headerlink" title="4ã€ImportError: cannot import name â€˜versionâ€˜ from â€˜torchvisionâ€™"></a>4ã€ImportError: cannot import name â€˜<strong>version</strong>â€˜ from â€˜torchvisionâ€™</h2><p>é—®é¢˜åŸå› ï¼šä¼¼ä¹æ˜¯è‡ªå·±ç¼–è¯‘çš„torchvisionå°±æ˜¯æœ‰è¿™ä¸ªbugï¼Œå®‰è£…ç›®å½•ä¸‹æ²¡æœ‰<code>version.py</code>è¿™ä¸ªæ–‡ä»¶ã€‚<br>è§£å†³æ–¹æ³•ï¼šè¿›å…¥<code>anaconda/envs/[your env]/lib/[python3.10]/site-pages/torchvision</code>ä¸‹åˆ›å»ºæ–‡ä»¶<code>version.py</code>æ–‡ä»¶ï¼Œç„¶åå†™å…¥ä¸€ä¸‹çš„ç¤ºä¾‹ã€‚âš å…·ä½“æ•°å€¼åº”è¯¥å’Œä½ ç¼–è¯‘çš„ç‰ˆæœ¬ä¸€è‡´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">__version__ = <span class="hljs-string">&#x27;0.18.0+cpu&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>æŠ˜è…¾</tag>
      
      <tag>ç¼–è¯‘</tag>
      
      <tag>pytorch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[æŠ˜è…¾]å®‰è£…pyrealsense</title>
    <link href="/2021/09/12/%E6%8A%98%E8%85%BE-%E5%AE%89%E8%A3%85pyrealsense/"/>
    <url>/2021/09/12/%E6%8A%98%E8%85%BE-%E5%AE%89%E8%A3%85pyrealsense/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ€è¿‘åœ¨å®éªŒå®¤åšæ— äººæœºçš„æ·±åº¦ç›¸æœºæµ‹è¯•é‡åˆ°çš„å°é—®é¢˜ã€‚åœ¨æ­¤è®°å½•ä¸€ä¸‹å½“æ—¶çš„è§£å†³æ–¹æ³•ã€‚</p><p>ç³»ç»Ÿç¯å¢ƒä¸º</p><table><thead><tr><th>ç¡¬ä»¶</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>å¼€å‘æ¿</td><td>Nvidia nano</td></tr><tr><td>ç›¸æœº</td><td>intelRealsense D435i</td></tr><tr><td>ç³»ç»Ÿç‰ˆæœ¬</td><td>ubuntu 18.04</td></tr><tr><td>python</td><td>3.7.10</td></tr></tbody></table><h1 id="ä¸€ã€å®‰è£…"><a href="#ä¸€ã€å®‰è£…" class="headerlink" title="ä¸€ã€å®‰è£…"></a>ä¸€ã€å®‰è£…</h1><p>æœ¬æ–‡ä»¥condaä¸‹çš„droneç¯å¢ƒåšæ¼”ç¤ºã€‚</p><ol><li>ä»intelRealsenseä¸­ä¸‹è½½æºæ–‡ä»¶<a href="https://github.com/IntelRealSense/librealsense">IntelRealsense</a>ã€‚</li><li>å®‰è£…cmake-guiè½¯ä»¶ï¼Œæ–¹ä¾¿è°ƒæ•´ç¼–è¯‘å‚æ•°ï¼Œèƒ½å¤Ÿå¯è§†åŒ–è°ƒæ•´æœ€å¥½ã€‚å½“ç„¶ä¹Ÿä¸æ˜¯éè£…ä¸å¯ï¼Œä¸è¿‡åœ¨è¿™é‡Œå°±ä¸æ¼”ç¤ºä¸å®‰è£…è¦å¦‚ä½•è°ƒæ•´ç¼–è¯‘å‚æ•°äº†ã€‚</li><li>åœ¨librealsenseæ–‡ä»¶å¤¹ä¸‹æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cmake-gui<br></code></pre></td></tr></table></figure></li><li>é‡ç‚¹å…³æ³¨ä¸¤ä¸ªé€‰é¡¹å…¶ä¸­çš„PYTHON-EXECUTABLEå’ŒCMAKE_INSTALL_PREFIXä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­å‰ä¸€ä¸ªä¼šå†³å®šç¼–è¯‘çš„æ˜¯å“ªä¸ªç‰ˆæœ¬çš„pythonåŒ…ï¼Œç¬¬äºŒä¸ªå†³å®šè¿™ä¸ªpythonåŒ…ä¼šå®‰è£…åˆ°å“ªé‡Œå»ã€‚<ol><li>è®¾ç½®PYTHON-EXECUTABLE&#x3D;&#x2F;(conda path)&#x2F;envs&#x2F;drone(ä½ å¯ä»¥æ¢æˆä½ è‡ªå·±çš„ç¯å¢ƒä½ç½®)&#x2F;bin&#x2F;python3.7ã€‚</li><li>è®¾ç½®CMAKE_INSTALL_PREFIX&#x3D;&#x2F;(conda path)&#x2F;envs&#x2F;drone(åŒä¸Š)&#x2F;ã€‚</li></ol></li><li>å®Œæˆä¸Šé¢çš„é…ç½®ä¹‹åï¼Œç‚¹å‡»generateç”Ÿæˆé…ç½®æ–‡ä»¶ï¼ˆæ²¡æœ‰guiç”¨å‘½ä»¤è¡Œä¹Ÿæ˜¯ä¸€è‡´çš„ï¼Œæ‰¾åˆ°å¯¹åº”å‚æ•°ä¿®æ”¹ï¼‰ï¼Œç„¶åã€‚<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">make -j8 &amp;&amp; make install<br></code></pre></td></tr></table></figure></li></ol><h1 id="äºŒã€æŠ˜è…¾"><a href="#äºŒã€æŠ˜è…¾" class="headerlink" title="äºŒã€æŠ˜è…¾"></a>äºŒã€æŠ˜è…¾</h1><h2 id="1ã€-ERROR-no-pipline"><a href="#1ã€-ERROR-no-pipline" class="headerlink" title="1ã€[ERROR]no pipline"></a>1ã€[ERROR]no pipline</h2><p>| é—®é¢˜è¡¨ç°ä¸ºï¼šimport pyrealsense2 as rs å‘½ä»¤å¯ä»¥é€šè¿‡ï¼Œä½†æ˜¯<code>pipeline=rs.pipeline</code>å°±ä¼šæŠ¥é”™ï¼Œå†…å®¹ä¸º <code>pyrealsense2</code> æ²¡æœ‰ <code>pipline</code> ã€‚</p><p>é—®é¢˜åŸå› ï¼šè¿™æ˜¯å®‰è£…çš„å°é—®é¢˜ï¼Œmakefileä¸­ä¼¼ä¹æ²¡æœ‰å†™å¥½<code>init.py</code>æ–‡ä»¶çš„å®‰è£…ã€‚<br>è§£å†³æ–¹æ³•ï¼šæŠŠ<code>librealsense/wrapper/python/pyrealsense</code>åº•ä¸‹çš„<code>init.py</code>æ–‡ä»¶æ‹·è´åˆ°<code>(conda path)/envs/drone/lib/python3.7/site-packages/pyrealsense2</code>ä¸‹å³å¯ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>æŠ˜è…¾</tag>
      
      <tag>pyrealsense</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[å­¦ä¹ ]å¤šçº¿ç¨‹</title>
    <link href="/2021/05/05/%E5%AD%A6%E4%B9%A0-%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    <url>/2021/05/05/%E5%AD%A6%E4%B9%A0-%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Nä½“é—®é¢˜"><a href="#Nä½“é—®é¢˜" class="headerlink" title="Nä½“é—®é¢˜"></a>Nä½“é—®é¢˜</h1><p>æ¨¡æ‹Ÿä¸€ä¸ªå¤ªç©ºä¸­æœ‰Nä¸ªæ˜Ÿä½“ï¼Œå„ä¸ªæ˜Ÿä½“æœ‰ä¸‰ä¸ªç»´åº¦çš„é€Ÿåº¦å’Œä½ç½®ï¼Œç›¸äº’ä¹‹é—´å—åˆ°ä¸‡æœ‰å¼•åŠ›å½±å“è¿åŠ¨çš„æ•ˆæœã€‚æ¨¡æ‹Ÿæœ€å°æ—¶é—´åˆ†ä½ç‚¹ä¸º0.005ç§’ï¼Œæœ¬é¢˜ç›®ä¸­ä¸‡æœ‰å¼•åŠ›å¸¸æ•°è®¾å®šä¸º1ï¼Œæ˜Ÿä½“çš„åˆå§‹æ•°æ®åœ¨â€œnbody.txtâ€æ–‡æœ¬æ–‡ä»¶ä¸­ã€‚è¦æ±‚ç”¨å•çº¿ç¨‹å’Œå¤šçº¿ç¨‹åˆ†åˆ«å®Œæˆä¸€ä»½ï¼Œå°†è¿­ä»£20æ¬¡åçš„æ•°æ®è¾“å‡ºåˆ°æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”æ¯”è¾ƒä¸²è¡Œç¨‹åºå’Œå¤šçº¿ç¨‹ä¹‹é—´çš„è®¡ç®—ç»“æœå·®å¼‚ã€‚</p><h1 id="ä¸€ã€å®ç°æ–¹æ¡ˆ"><a href="#ä¸€ã€å®ç°æ–¹æ¡ˆ" class="headerlink" title="ä¸€ã€å®ç°æ–¹æ¡ˆ"></a>ä¸€ã€å®ç°æ–¹æ¡ˆ</h1><p>æ¨¡æ‹Ÿæ–¹æ¡ˆæ¶‰åŠå¤§é‡è®¡ç®—ï¼Œå¯¹äºç®—æ³•çš„è€ƒå¯Ÿè¾ƒå°ï¼Œè€ƒç ”å¯¹æ•°æ®ç»“æ„å’Œè®¡ç®—æ–¹å¼è®¾è®¡ï¼Œä»¥åŠå¯¹ä¸å¤šçº¿ç¨‹openmpå’Œpthreadåº“çš„è¿ç”¨ã€‚</p><ul><li>å®éªŒç¯å¢ƒï¼šubuntu20.04ï¼ˆHype-Vï¼‰</li><li>ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼šg++ 9.3.0</li></ul><h2 id="1ã€è¾“å…¥æ•°æ®"><a href="#1ã€è¾“å…¥æ•°æ®" class="headerlink" title="1ã€è¾“å…¥æ•°æ®"></a>1ã€è¾“å…¥æ•°æ®</h2><p>ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬1024ä¸ªæ˜Ÿä½“çš„7é¡¹æ•°æ®ï¼Œä¸€è¡Œä¸ºä¸€ä¸ªæ˜Ÿä½“ï¼Œåˆ†åˆ«æ˜¯æ˜Ÿä½“è´¨é‡ï¼Œæ˜Ÿä½“åœ¨xã€yã€zä¸Šçš„ä½ç½®ï¼Œæ˜Ÿä½“åœ¨xã€yã€zä¸Šçš„é€Ÿåº¦ã€‚</p><p>å¯¹äºä¸€ä¸ªæ˜Ÿä½“éœ€è¦å­˜æ”¾çš„æ•°æ®å¦‚ä¸‹ï¼Œä¸»è¦æ˜¯xã€yã€zç©ºé—´ä½ç½®ï¼Œsxã€syã€szé€Ÿåº¦å’Œmassæ˜Ÿä½“è´¨é‡ï¼Œè¿˜æœ‰è®¡ç®—æ—¶ä¸€äº›ä¸´æ—¶å˜é‡ï¼Œå¦‚è®¡ç®—1å·æ˜Ÿä½“å’Œå…¶ä»–æ˜Ÿä½“ç›¸äº’ä½œç”¨åŠ›æ€»å’Œçš„å˜é‡ï¼Œå¼•å…¥è¿™ä¸ªå˜é‡è¿˜æœ‰ä¸€ä¸ªä½œç”¨ï¼Œå¯ä»¥å‡å°‘è¯¯å·®ï¼ˆä¸»è¦æ˜¯æŒ‡é™¤æ³•çš„è¯¯å·®ç´¯ç§¯ï¼‰ã€‚æ˜Ÿä½“ç»“æ„ä½“æ•°æ®å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">planet</span> <span class="hljs-comment">// æ˜Ÿä½“ç»“æ„ä½“</span><br>&#123;<br><span class="hljs-type">double</span> mass;<span class="hljs-comment">// bodyè´¨é‡</span><br><span class="hljs-type">double</span> sx, sy, sz;<span class="hljs-comment">// bodyä¸‰ç»´æ–¹å‘ä¸Šçš„é€Ÿåº¦</span><br><span class="hljs-type">double</span> x, y, z;<span class="hljs-comment">// bodyä¸‰ç»´æ–¹å‘ä¸Šçš„ä½ç½®</span><br><span class="hljs-type">double</span> fx, fy, fz;<span class="hljs-comment">// bodyä¸‰ç»´æ–¹å‘ä¸Šæ”¶åˆ°çš„åŠ›çš„æ€»å’Œ</span><br><span class="hljs-built_in">planet</span>()<span class="hljs-comment">// æŠŠæ‰€æœ‰æ•°æ®åˆå§‹åŒ–ä¸º0</span><br>&#123;<br>mass = sx = sy = sz = x = y = z = <span class="hljs-number">0</span>;<br>fx = fy = fz = <span class="hljs-number">0</span>;<br>&#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="2ã€è®¡ç®—å¼•åŠ›ï¼ˆå•çº¿ç¨‹ï¼‰"><a href="#2ã€è®¡ç®—å¼•åŠ›ï¼ˆå•çº¿ç¨‹ï¼‰" class="headerlink" title="2ã€è®¡ç®—å¼•åŠ›ï¼ˆå•çº¿ç¨‹ï¼‰"></a>2ã€è®¡ç®—å¼•åŠ›ï¼ˆå•çº¿ç¨‹ï¼‰</h2><p>è®¡ç®—ä¸€ä¸ªæ˜Ÿä½“æ”¶åˆ°å…¶ä»–æ˜Ÿä½“åŠ›çš„æ€»å’Œï¼Œæ— éä¸¤ä¸¤ä¹‹é—´è®¡ç®—åŠ›ç„¶åæ›´æ–°ã€‚<br>ä¾‹å¦‚1å·æ˜Ÿä½“å’Œ2å·æ˜Ÿä½“ã€1å·å’Œ3å·ã€1å·å’Œ4å·â€¦â€¦1å·å’Œ1024å·ï¼Œ2å·å’Œ3å·ã€2å·å’Œ4å·â€¦â€¦ç­‰ç­‰ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œå¹¶ä¸éœ€è¦æ±‚2å·å’Œ1å·ï¼Œå› ä¸ºåœ¨è®¡ç®—1å·å’Œ2å·æ—¶å·²ç»è®¡ç®—äº†åŠ›å¤§å°ï¼Œåªéœ€è¦å–åï¼‰ã€‚å› ä¸ºè¿™ä¸ªæ¨¡å—ä¹Ÿä¼šåœ¨åæ¥çš„å¤šçº¿ç¨‹ä¸­è¢«è°ƒç”¨ï¼Œå› æ­¤æŠ½è±¡æˆä¸ºä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ã€‚ä¸ºäº†å‡å°è¯¯å·®ï¼Œå°†æ¯æ¬¡è®¡ç®—çš„åŠ›å­˜æ”¾åˆ°ä¸´æ—¶å˜é‡ä¸­ï¼Œå¹¶ä¸”åœ¨æ›´æ–°å®Œæ‰€æœ‰çš„åˆåŠ›ä¹‹åï¼Œå†æ›´æ–°æ˜Ÿä½“çš„é€Ÿåº¦å’Œä½ç½®ã€‚<br>ä¸è¦ä¸€ä¸Šæ¥å°±å†™å¹¶è¡ŒåŒ–ï¼Œæ‹¿å•çº¿ç¨‹çš„ç¨‹åºéªŒè¯ç®—æ³•çš„æ­£ç¡®æ€§æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">speed_change</span><span class="hljs-params">(planet &amp;a, planet &amp;b)</span></span>&#123;...&#125;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">series_stimulus</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> count, planet *array)</span><span class="hljs-comment">// å•çº¿ç¨‹æ¨¡å—ï¼Œcountè¡¨ç¤ºè¿­ä»£å¤šå°‘æ¬¡ï¼Œarrayæ˜¯è®¡ç®—ä½¿ç”¨çš„å…ƒæ•°æ®ã€‚</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">while</span> (count--)<br>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; max_size; i++)<br>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = i + <span class="hljs-number">1</span>; j &lt; max_size; j++)<br>&#123;<br><span class="hljs-built_in">speed_change</span>(array[i], array[j]);<br>&#125;<br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; max_size; i++)<br>&#123;<br><span class="hljs-built_in">postion</span>(array[i]);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3ã€å¤šçº¿ç¨‹ä¼˜åŒ–"><a href="#3ã€å¤šçº¿ç¨‹ä¼˜åŒ–" class="headerlink" title="3ã€å¤šçº¿ç¨‹ä¼˜åŒ–"></a>3ã€å¤šçº¿ç¨‹ä¼˜åŒ–</h2><h3 id="aã€openmpå¤šçº¿ç¨‹"><a href="#aã€openmpå¤šçº¿ç¨‹" class="headerlink" title="aã€openmpå¤šçº¿ç¨‹"></a>aã€openmpå¤šçº¿ç¨‹</h3><p>æœ‰äº†ä¸Šé¢å•çº¿ç¨‹çš„è®¡ç®—æ–¹æ³•ï¼Œå¤šçº¿ç¨‹å°±æ˜¯æŠŠå•çº¿ç¨‹çš„forï¼Œwhileç­‰å¾ªç¯ä½“å¹¶è¡ŒåŒ–è€Œå·²ï¼Œopenmpï¼ï¼ï¼ç®€ç›´æ²¡æœ‰æ¯”è¿™ä¸ªæ›´åŠ å¿«æ·çš„æ–¹æ³•ã€‚é€ä¸ªè®²è§£pragma omp parallelå¸¦çš„å‚æ•°ã€‚</p><ul><li>for : è¡¨æ˜å¹¶è¡ŒåŒ–å¾ªç¯</li><li>num_threads(n) : å¹¶è¡Œçº¿ç¨‹æ•°é‡ï¼Œnå¯ä»¥æ˜¯ä»»æ„æ•´æ•°ï¼Œå…¶å®è¿˜æ˜¯çœ‹é…ç½®</li><li>private(a,b,â€¦,z) : è¡¨æ˜å“ªäº›å˜é‡æ˜¯ç§æœ‰å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å¹²æ‰°</li><li>shared(a,b,â€¦,z) : è¡¨æ˜å“ªäº›å˜é‡æ˜¯å…¬æœ‰å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œä¾‹å¦‚æœ¬é¢˜ä¸­æ˜Ÿä½“æ•°æ®å°±æ˜¯å…±äº«çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ›´æ–°</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">parallel_stimulus1</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> count, planet *array)</span><span class="hljs-comment">// openmpéªæƒ°î”‘ç»‹å¬ªç°­</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">int</span> i, j;<br><span class="hljs-keyword">while</span> (count--)<br>&#123;<br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> omp parallel for num_threads(4) private(i, j) shared(array)</span><br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; max_size; i++)<br>&#123;<br><span class="hljs-keyword">for</span> (j = i + <span class="hljs-number">1</span>; j &lt; max_size; j++)<br>&#123;<br><span class="hljs-built_in">speed_change</span>(array[i], array[j]);<br>&#125;<br>&#125;<br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; max_size; i++)<br>&#123;<br><span class="hljs-built_in">postion</span>(array[i]);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶ç¼–è¯‘å¸¦æœ‰openmpçš„cppæ–‡ä»¶éœ€è¦åœ¨ç¼–è¯‘æŒ‡ä»¤åŠ å…¥ -fopenmp çš„å‚æ•°ï¼Œæ¯”å¦‚è¯´ä½ çš„æ–‡ä»¶å«åšâ€œa.cppâ€é‚£ä¹ˆç¼–è¯‘å‚æ•°å°±æ˜¯ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">g++ a.cpp <span class="hljs-literal">-o</span> a.out <span class="hljs-literal">-fopenmp</span><br></code></pre></td></tr></table></figure><h3 id="bã€pthreadå¤šçº¿ç¨‹"><a href="#bã€pthreadå¤šçº¿ç¨‹" class="headerlink" title="bã€pthreadå¤šçº¿ç¨‹"></a>bã€pthreadå¤šçº¿ç¨‹</h3><p>å¦‚æœè¯´ä¸Šé¢çš„openmpæ˜¯è‡ªåŠ¨å¤šçº¿ç¨‹ï¼Œé‚£ä¹ˆpthreadå°±æ˜¯æ‰‹åŠ¨å¤šçº¿ç¨‹ã€‚ä½¿ç”¨pthreadåˆ›å»ºæ–°çº¿ç¨‹ä¹‹å‰å¿…é¡»è¦ä¸ºæ–°çº¿ç¨‹åˆ†é…ç©ºé—´ï¼Œthread_handleå°±æ˜¯è¿™æ ·ä¸€ä¸ªå®¹çº³æ–°çº¿ç¨‹çš„å®¹å™¨ï¼Œç„¶åä½¿ç”¨newä¸ºå®ƒåˆ†é…ç©ºé—´ï¼ˆè¿™é‡Œå› ä¸ºç¬”è€…ç¬”è®°æœ¬åªæœ‰4ä¸ªæ ¸å¿ƒï¼Œå› æ­¤åªåˆ›å»º4çº¿ç¨‹ï¼‰ã€‚æœ‰äº†å®¹å™¨ä¹‹åè¦è£…ä¸œè¥¿ï¼Œä¸ç„¶ä¸€ä¸ªç©ºçš„çº¿ç¨‹å®¹å™¨æœ‰ä»€ä¹ˆç”¨å‘¢ã€‚è°ƒç”¨pthread_createå‡½æ•°åˆ›å»ºæ–°çº¿ç¨‹ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å®¹å™¨ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸Œæœ›æŠŠè¿™ä¸ªæ–°çº¿ç¨‹æ”¾åœ¨å®¹å™¨å“ªä¸ªä½ç½®ï¼‰</li><li>ç¬¬äºŒä¸ªå‚æ•°åœ¨è¿™é‡Œæ²¡æœ‰ç”¨æŒ‡å®šä¸ºNULL</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å‡½æ•°æŒ‡é’ˆï¼ˆå³å¸Œæœ›åœ¨è¿™ä¸ªå®¹å™¨å†…è¿è¡Œä»€ä¹ˆï¼‰ï¼Œå¿…é¡»æ˜¯void*ç±»å‹</li><li>ç¬¬å››ä¸ªå‚æ•°æ˜¯ç»™å‡½æ•°ä½¿ç”¨çš„å‚æ•°ï¼ˆè¿™ä¸ªå®¹å™¨å†…çš„å‡½æ•°æ€»ä¸å¯èƒ½å®Œæˆæ— ç±³ä¹‹ç‚Šå§ï¼Œæ‰€ä»¥ç±³åœ¨å“ªé‡Œåœ¨è¿™ä¸ªä½ç½®å‘Šè¯‰å®ƒï¼‰</li></ul><p>pthreadä¸ä¼šå¸®æˆ‘ä»¬å®ç°çº¿ç¨‹åŒæ­¥ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨å®ç°çº¿ç¨‹åŒæ­¥ã€‚è¿™é‡Œä½¿ç”¨pthread_joinå‡½æ•°ï¼Œå°†ä¹‹å‰åˆ›å»ºçš„å¤šä¸ªçº¿ç¨‹åˆå¹¶ï¼Œç»Ÿä¸€æ›´æ–°æ˜Ÿä½“çš„é€Ÿåº¦å’Œä½ç½®ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">parallel_stimulus2</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> count, planet *array)</span><span class="hljs-comment">// pthreadä¸»çº¿ç¨‹å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">int</span> num_of_thread = <span class="hljs-number">4</span>;<br>thread_set *set = <span class="hljs-keyword">new</span> thread_set[num_of_thread];<br><span class="hljs-type">pthread_t</span> *thread_handle = <span class="hljs-keyword">new</span> <span class="hljs-type">pthread_t</span>[num_of_thread];<br><span class="hljs-keyword">while</span> (count--)<br>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> i = <span class="hljs-number">0</span>; i &lt; num_of_thread; i++)<br>&#123;<br>set[i].rank = i;<br>set[i].o = array;<br><span class="hljs-built_in">pthread_create</span>(&amp;thread_handle[i], <span class="hljs-literal">nullptr</span>, thread_pthread, (<span class="hljs-type">void</span> *)&amp;set[i]);<br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> i = num_of_thread<span class="hljs-number">-1</span>; i &gt;= <span class="hljs-number">0</span>; i--)<br>&#123;<br><span class="hljs-built_in">pthread_join</span>(thread_handle[i], <span class="hljs-literal">nullptr</span>);<br>&#125;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; max_size; i++)<br>&#123;<br><span class="hljs-built_in">postion</span>(array[i]);<br>&#125;<br>&#125;<br><span class="hljs-keyword">delete</span>[] thread_handle;<br><span class="hljs-keyword">delete</span>[] set;<br><span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯å®¹å™¨å†…å®¹ç‰©è¦æ€ä¹ˆåŠï¼Œå› ä¸ºè¦æ‰‹åŠ¨å¹¶è¡ŒåŒ–ï¼Œæ‰€ä»¥è¿™ä¸ªçº¿ç¨‹åšä»€ä¹ˆä¹Ÿéœ€è¦è‡ªå·±è®¡ç®—ã€‚æœ¬å¤„ä¸¾ä¸ªğŸŒ°æ˜¯4çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è®¡ç®—1024ä¸ªæ˜Ÿä½“çš„å››åˆ†ä¹‹ä¸€ã€‚ä¸ºäº†ä¼ é€’å‚æ•°æ–¹ä¾¿ï¼Œä½¿ç”¨ç»“æ„ä½“thread_setï¼Œå…¶ä¸€æ˜¯æ–¹ä¾¿ã€å…¶äºŒæ˜¯å› ä¸ºpthread_createç¬¬å››ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ˆè€Œä¸æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„æŒ‡é’ˆï¼‰ï¼Œä¸èƒ½ä¼ é€’å¤šä¸ªå‚æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">thread_set</span> <span class="hljs-comment">// pthreadå‚æ•°è¡¨</span><br>&#123;<br><span class="hljs-type">int</span> rank;<span class="hljs-comment">// æŒ‡å®šçš„çº¿ç¨‹å·</span><br>planet *o;<span class="hljs-comment">// è®¡ç®—çš„å…ƒæ•°æ®</span><br>&#125;;<br><span class="hljs-function"><span class="hljs-type">void</span> *<span class="hljs-title">thread_pthread</span><span class="hljs-params">(<span class="hljs-type">void</span> *argv)</span><span class="hljs-comment">// pthreadå­çº¿ç¨‹å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>thread_set set = *(thread_set *)argv;<br><span class="hljs-type">long</span> rank = set.rank;<br><span class="hljs-type">int</span> n = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">if</span> (rank == <span class="hljs-number">3</span>)<br>&#123;<br>n = max_size - <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>n = (rank + <span class="hljs-number">1</span>) * max_size / <span class="hljs-number">4</span>;<span class="hljs-comment">// å¦‚æœä¿®æ”¹çº¿ç¨‹æ•°ï¼Œè¿™é‡Œä¸€å¹¶ä¿®æ”¹ã€‚</span><br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = rank * max_size / <span class="hljs-number">4</span>; i &lt; n; i++)<br>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = i + <span class="hljs-number">1</span>; j &lt;= max_size; j++)<br>&#123;<br><span class="hljs-built_in">speed_change</span>(set.o[i], set.o[j]);<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨pthreadï¼Œéœ€è¦åœ¨ç¼–è¯‘å‚æ•°ä¸Šå¢åŠ â€œ-lpthreadâ€æ˜¯â€œlâ€ä¸æ˜¯â€œiâ€ã€‚ğŸŒ°åŒä¸Šã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">g++ a.cpp <span class="hljs-literal">-o</span> a.out <span class="hljs-literal">-lpthread</span><br></code></pre></td></tr></table></figure><h2 id="4ã€è¾“å…¥è¾“å‡º"><a href="#4ã€è¾“å…¥è¾“å‡º" class="headerlink" title="4ã€è¾“å…¥è¾“å‡º"></a>4ã€è¾“å…¥è¾“å‡º</h2><p>éœ€è¦ä»æ–‡ä»¶ä¸­è¯»å…¥è®¡ç®—æ•°æ®ï¼Œç„¶åå°†è¿­ä»£ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ã€‚æ­¤å¤„æ¯”è¾ƒæ¨èçš„æ˜¯ofstreamå¤´æ–‡ä»¶æä¾›çš„æ–‡ä»¶æµåŠŸèƒ½ã€‚èƒ½å¤Ÿåƒcoutã€cinä¸€æ ·ä½¿ç”¨ã€‚</p><h3 id="aã€æ–‡ä»¶è¯»å…¥"><a href="#aã€æ–‡ä»¶è¯»å…¥" class="headerlink" title="aã€æ–‡ä»¶è¯»å…¥"></a>aã€æ–‡ä»¶è¯»å…¥</h3><p>ä½¿ç”¨å‰å»ºç«‹ä¸€ä¸ªfstreamæ–‡ä»¶æµæŒ‡é’ˆï¼Œè°ƒç”¨openæ–¹æ³•æ‰“å¼€éœ€è¦è¯»å…¥çš„æ–‡ä»¶ã€‚ç„¶ååƒä½¿ç”¨cinä¸€æ ·ä½¿ç”¨fpå³å¯ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">read</span><span class="hljs-params">(planet *array)</span></span><br><span class="hljs-function"></span>&#123;<br>fstream fp;<br>fp.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;nbody.txt&quot;</span>, ios::in);<br><span class="hljs-keyword">if</span> (fp.<span class="hljs-built_in">bad</span>())<span class="hljs-comment">// æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span><br>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;error to open file&quot;</span>;<br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; max_size; i++)<br>&#123;<br>fp &gt;&gt; array[i].mass &gt;&gt; array[i].x &gt;&gt; array[i].y &gt;&gt; array[i].z &gt;&gt; array[i].sx &gt;&gt; array[i].sy &gt;&gt; array[i].sz;<br>&#125;<br>fp.<span class="hljs-built_in">close</span>();<span class="hljs-comment">// è¯»å†™ç»“æŸåå…³é—­æ–‡ä»¶</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="bã€æ–‡ä»¶è¾“å‡º"><a href="#bã€æ–‡ä»¶è¾“å‡º" class="headerlink" title="bã€æ–‡ä»¶è¾“å‡º"></a>bã€æ–‡ä»¶è¾“å‡º</h3><p>ä¸€æ ·ï¼Œfstreamä¹Ÿå¯ä»¥åƒcoutä¸€æ ·ä½¿ç”¨ï¼Œå‘æ–‡ä»¶å†™å†…å®¹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">write</span><span class="hljs-params">(planet *array, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *file)</span></span><br><span class="hljs-function"></span>&#123;<br>fstream fp;<br>fp.<span class="hljs-built_in">open</span>(file, ios::out);<br><span class="hljs-keyword">if</span> (fp.<span class="hljs-built_in">bad</span>())<br>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;output open error&quot;</span>;<br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; max_size; i++)<br>&#123;<br>fp &lt;&lt; <span class="hljs-built_in">setprecision</span>(<span class="hljs-number">15</span>) &lt;&lt; <span class="hljs-built_in">setiosflags</span>(ios::left) &lt;&lt; array[i].mass &lt;&lt; <span class="hljs-string">&quot; &quot;</span> &lt;&lt; array[i].x &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span><br>   &lt;&lt; array[i].y &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span> &lt;&lt; array[i].z &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span><br>   &lt;&lt; array[i].sx &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span> &lt;&lt; array[i].sy &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span> &lt;&lt; array[i].sz &lt;&lt; endl;<br>&#125;<br>fp.<span class="hljs-built_in">close</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5ã€mainå‡½æ•°"><a href="#5ã€mainå‡½æ•°" class="headerlink" title="5ã€mainå‡½æ•°"></a>5ã€mainå‡½æ•°</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-type">double</span> start, end;<br>planet array[max_size + <span class="hljs-number">16</span>];<br>planet copy_planet[max_size + <span class="hljs-number">16</span>];<br><span class="hljs-built_in">read</span>(array);<br><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> count = <span class="hljs-number">20</span>; <span class="hljs-comment">//è¿­ä»£20æ¬¡</span><br><span class="hljs-type">char</span> series[] = <span class="hljs-string">&quot;series version.txt&quot;</span>, parallel1[] = <span class="hljs-string">&quot;parallel version1.txt&quot;</span>, parallel2[] = <span class="hljs-string">&quot;parallel version2.txt&quot;</span>;<span class="hljs-comment">// è¾“å‡ºæ–‡ä»¶å</span><br><br><span class="hljs-built_in">memcpy</span>(copy_planet, array, max_size * <span class="hljs-built_in">sizeof</span>(planet)); <span class="hljs-comment">// ä¸²è¡Œç¨‹åº</span><br><span class="hljs-built_in">GET_TIME</span>(start);<br><span class="hljs-built_in">series_stimulus</span>(count, copy_planet);<br><span class="hljs-built_in">GET_TIME</span>(end)<br>cout &lt;&lt; (<span class="hljs-type">double</span>)(end - start) &lt;&lt; endl;<br><span class="hljs-comment">// è¦å†™å‡ºå¦‚æ–‡ä»¶è¯·å»æ‰æœ¬è¡Œæ³¨é‡Šï¼Œä¸‹é¢åŒç†</span><br><span class="hljs-comment">// write(copy_planet, series);</span><br><br><span class="hljs-built_in">memcpy</span>(copy_planet, array, max_size * <span class="hljs-built_in">sizeof</span>(planet)); <span class="hljs-comment">// openmpç¨‹åº</span><br><span class="hljs-built_in">GET_TIME</span>(start);<br><span class="hljs-built_in">parallel_stimulus1</span>(count, copy_planet);<br><span class="hljs-built_in">GET_TIME</span>(end)<br>cout &lt;&lt; (<span class="hljs-type">double</span>)(end - start) &lt;&lt; endl;<br><span class="hljs-comment">// write(copy_planet, parallel1);</span><br><br><span class="hljs-built_in">memcpy</span>(copy_planet, array, max_size * <span class="hljs-built_in">sizeof</span>(planet)); <span class="hljs-comment">// pthreadç¨‹åº</span><br><span class="hljs-built_in">GET_TIME</span>(start);<br><span class="hljs-built_in">parallel_stimulus2</span>(count, copy_planet);<br><span class="hljs-built_in">GET_TIME</span>(end)<br>cout &lt;&lt; (<span class="hljs-type">double</span>)(end - start) &lt;&lt; endl;<br><span class="hljs-comment">// write(copy_planet, parallel2);</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="äºŒã€æ€»ç»“"><a href="#äºŒã€æ€»ç»“" class="headerlink" title="äºŒã€æ€»ç»“"></a>äºŒã€æ€»ç»“</h1><p>å®Œæ•´ä»£ç åœ¨è¿™ä¸ªåœ°æ–¹<a href="https://github.com/peach-water/nbody_problem">è¿æ¥</a>ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ </tag>
      
      <tag>å¹¶è¡Œè®¡ç®—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[æç¬‘]ç¨‹åºå‘˜ç¬‘è¯é›†æ”¶å½•</title>
    <link href="/2021/04/12/%E6%90%9E%E7%AC%91-%E7%A8%8B%E5%BA%8F%E5%91%98%E7%AC%91%E8%AF%9D%E9%9B%86%E6%94%B6%E5%BD%95/"/>
    <url>/2021/04/12/%E6%90%9E%E7%AC%91-%E7%A8%8B%E5%BA%8F%E5%91%98%E7%AC%91%E8%AF%9D%E9%9B%86%E6%94%B6%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ•Š"><a href="#ğŸ•Š" class="headerlink" title="ğŸ•Š"></a>ğŸ•Š</h1><h2 id="èµ·é£"><a href="#èµ·é£" class="headerlink" title="èµ·é£"></a>èµ·é£</h2><p>å½“ä½ ä¹±å†™çš„ç¨‹åºå®ƒå´ç¢°å·§å®Œæˆäº†ä»»åŠ¡ã€‚æ¥è‡ªBilibiliã€‚æ°å¥½è¶ç€è¿™ä¸ªæœºä¼šï¼ŒæŠŠä¹‹å‰é›¶é›¶æ•£æ•£çš„ç¬‘è¯éƒ½æ•´ç†ä¸€ä¸‹ã€‚</p><iframe src="//player.bilibili.com/player.html?isOutside=true&aid=757297242&bvid=BV1w64y1Q7sk&cid=315369624&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe><h2 id="ä¸ºä»€ä¹ˆå®ƒå¯ä»¥èµ·é£"><a href="#ä¸ºä»€ä¹ˆå®ƒå¯ä»¥èµ·é£" class="headerlink" title="ä¸ºä»€ä¹ˆå®ƒå¯ä»¥èµ·é£"></a>ä¸ºä»€ä¹ˆå®ƒå¯ä»¥èµ·é£</h2><p>è™½ç„¶ä¸çŸ¥é“è¿™åªé¸Ÿä¸ºä»€ä¹ˆå¯ä»¥ç”¨å¤´é£èµ·æ¥ï¼Œä½†æ˜¯æ€»å½’æ˜¯å®ç°äº†åŠŸèƒ½ã€‚<br>ç­‰ç­‰ã€æ—¢ç„¶æ˜¯ç”¨å¤´é£çš„ï¼Œé‚£å»æ‰ç¿…è†€åº”è¯¥æ²¡äº‹ã€‚<br>å‡­ä»€ä¹ˆå»æ‰ç¿…è†€å°±ä¸èƒ½é£äº†ï¼Ÿä½ TMä¸æ˜¯ç”¨å¤´é£çš„ï¼<br>å‡­ä»€ä¹ˆæŠŠç¿…è†€åŸå°ä¸åŠ¨çš„æ”¾å›å»åˆä¸èƒ½é£äº†ï¼Ÿæˆ‘ä¸æ˜¯å•¥ä¹Ÿæ²¡å¹²å•Šï¼Ÿ<br>è‰¹ï¼ä¸ºä»€ä¹ˆè¿™åªé¸Ÿä¼šç”¨è„šé£è¡Œï¼Œè¿™æ˜¯ä»€ä¹ˆåŸç†ï¼Ÿæˆ‘æŠŠè„šå»æ‰è¯•è¯•ã€‚<br>ç»äº†ï¼Œè¿™é¸Ÿåˆèƒ½é£äº†ï¼ï¼è€Œä¸”æ­£å¸¸çš„ç”¨ç¿…è†€é£è¡Œï¼Œè™½ç„¶æ²¡æœ‰è„šä¸èƒ½ç€é™†ã€‚<br>ç­‰ç­‰ï¼Œæˆ‘ä¸Šæ¬¡å¥½åƒåšäº†ä¸€åªé¹°æ¥ç€ï¼ŒæŠŠé‚£ä¸ªè„šå¤åˆ¶è¿‡æ¥çœ‹çœ‹ï¼</p><p>å®Œç¾ï¼Œç°åœ¨è¿™åªé¸½å­åˆå®Œç¾çš„é£è¡ŒåŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥æ­£å¸¸çš„ç€é™†ï¼Œè™½ç„¶è„šæ˜¯ç”¨é¹°çš„è„šå‡‘åˆçš„ï¼Œä½†æ˜¯æ²¡é—®é¢˜ï¼èƒ½ç”¨ï¼æˆ‘å®£å¸ƒï¼è¿™ä¸ªé¡¹ç›®å®Œå·¥ã€‚â™¥</p><h2 id="èƒ½é£å°±ä¸è¦åŠ¨"><a href="#èƒ½é£å°±ä¸è¦åŠ¨" class="headerlink" title="èƒ½é£å°±ä¸è¦åŠ¨"></a>èƒ½é£å°±ä¸è¦åŠ¨</h2><p>æ˜¯é¸½å­å—ï¼Ÿ<br>æ˜¯ï¼<br>èƒ½é£å—ï¼Ÿ<br>å¯ä»¥ï¼<br>é‚£ä¸å°±å®Œäº†ğŸ˜€</p><h2 id="CSç­çš„åˆç†æƒ³è±¡"><a href="#CSç­çš„åˆç†æƒ³è±¡" class="headerlink" title="CSç­çš„åˆç†æƒ³è±¡"></a>CSç­çš„åˆç†æƒ³è±¡</h2><p>å¦‚æœä½ çš„é¸½å­è¿™æ ·å­é£æˆåŠŸäº†ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ¥ä¸‹æ¥çš„åŠä¸ªç­éƒ½ä¼šè¿™ä¹ˆé£ï¼Œç„¶åç”Ÿå‡ºä¸€äº›å››æ¡è…¿ï¼Œä¸‰åªç¿…è†€çš„å¥‡æ€ªå„è‡ªğŸ˜€ï¼Œå¦å¤–åŠä¸ªç­çº§å¯èƒ½é€ ä¸å‡ºé¸½å­ã€‚</p><h2 id="ä¸ºä»€ä¹ˆæ¡Œå­è¦æŸ¥å­—å…¸"><a href="#ä¸ºä»€ä¹ˆæ¡Œå­è¦æŸ¥å­—å…¸" class="headerlink" title="ä¸ºä»€ä¹ˆæ¡Œå­è¦æŸ¥å­—å…¸"></a>ä¸ºä»€ä¹ˆæ¡Œå­è¦æŸ¥å­—å…¸</h2><p>ä½ ä½¿ç”¨å­—å…¸å«æ¡Œè§’ï¼Œä½ èµ°åä¸‹æ¥ä¸€ä¸ªäººå‘ç°è¿™ä¸ªæ¡Œå­éœ€è¦ä½¿ç”¨å­—å…¸ï¼Œä½†æ˜¯æ¡Œå­å¹¶æ²¡æœ‰æ–‡å­—äº¤äº’åŠŸèƒ½ï¼Œè€Œä¸”æ¡Œå­æ˜¯ä¸éœ€è¦æ–‡å­—æŸ¥è¯¢çš„ã€‚äºæ˜¯ä»–æŠŠå­—å…¸ä¸€æŠ½ï¼Œæ¡Œå­ç¿»äº†ï¼Œèœæ’’äº†ä¸€åœ°ã€‚ä½†æ˜¯ä»–æ°¸è¿œæä¸æ‡‚ä¸ºä»€ä¹ˆæ¡Œå­è¦æŸ¥å­—å…¸ã€‚ğŸ˜€<br>ç„¶åä»–ä¿®ç†äº†ä¸€æ•´å¤©çš„BUGï¼Œç ”ç©¶æ¡Œå­ä¸Šçš„é¥­èœæ‘†æ”¾ä½ç½®å¯¹äºæ¡Œå­ç¿»å€’çš„å½±å“ï¼Œæœ€åå‘ç°ï¼Œåªéœ€è¦æŠŠä¸€ç›˜èœå«åœ¨æ¡Œè§’å°±å¯ä»¥äº†ï¼Œç„¶åæ½‡æ´’ç¦»å»ï¼Œå‘Šè¯‰åˆ«äººä»Šå¤©ä»–ä¿®äº†ä¸€ä¸ªå¤§BUGã€‚åæ¥åˆæ¥äº†ä¸€ä¸ªäººæ£€æŸ¥è¿™å¼ æ¡Œå­ï¼Œä»–è®¤ä¸ºè¿™å¼ æ¡Œå­ä¸éœ€è¦åƒèœï¼Œäºæ˜¯æŠŠç›˜å­æŠ½äº†å‡ºæ¥â€¦â€¦æŠŠå­—å…¸å¡äº†å›å»ã€‚</p><h1 id="ğŸºå§"><a href="#ğŸºå§" class="headerlink" title="ğŸºå§"></a>ğŸºå§</h1><p>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯å•¤é…’ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯å’–å•¡ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†0.7æ¯å•¤é…’ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†-1æ¯å•¤é…’ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†2^32æ¯å•¤é…’ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯æ´—è„šæ°´ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯èœ¥èœ´ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€ä»½asdfQwer@24å¤šä¸ªï¼&amp;ï¼ˆ@ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œä»€ä¹ˆä¹Ÿæ²¡è¦ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œåˆèµ°å‡ºå»åˆä»çª—æˆ·è¿›æ¥åˆä»åé—¨å‡ºå»åˆä»ä¸‹æ°´é“è¿›æ¥ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œåˆèµ°å‡ºå»åˆèµ°è¿›æ¥åˆå‡ºå»åˆè¿›æ¥åˆå‡ºå»ï¼Œæœ€ååœ¨å¤–é¢æŠŠè€æ¿æ‰“äº†ä¸€é¡¿ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯çƒ«çƒ«çƒ«çš„é”Ÿæ–¤æ‹·ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†NaNæ¯Nullã€‚<br>ä¸€ï¼´æµ‹è¯•å·¥ç¨‹å¸ˆå†²è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†500Tå•¤é…’å’–å•¡æ´—è„šæ°´é‡çŒ«ç‹¼ç‰™æ£’å¥¶èŒ¶ã€‚<br>ä¸€ï¼´æµ‹è¯•å·¥ç¨‹å¸ˆæŠŠé…’å§æ‹†äº†ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆæ¢è£…æˆè€æ¿ï¼Œè¦äº†500æ¯å•¤é…’å¹¶ä¸”ä¸ä»˜é’±ã€‚<br>ä¸€ä¸‡ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆåœ¨é…’å§é—¨å‰å‘¼å•¸è€Œè¿‡ã€‚<br>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯å•¤é…’â€˜ï¼›DROP TABLEé…’å§ã€‚<br>æµ‹è¯•å·¥ç¨‹å¸ˆä»¬æ»¡æ„çš„ç¦»å¼€äº†é…’å§ã€‚<br>ä¸€åé¡¾å®¢ç‚¹äº†ä¸€ä»½ç‚’é¥­ï¼Œé…’å§ç‚¸äº†ã€‚</p><h1 id="çŸ­åˆé›†"><a href="#çŸ­åˆé›†" class="headerlink" title="çŸ­åˆé›†"></a>çŸ­åˆé›†</h1><h2 id="ä¹±ç æ‰“æ²¹è¯—"><a href="#ä¹±ç æ‰“æ²¹è¯—" class="headerlink" title="ä¹±ç æ‰“æ²¹è¯—"></a>ä¹±ç æ‰“æ²¹è¯—</h2><p>æ‰‹æŒä¸¤æŠŠé”Ÿæ–¤æ‹·ï¼Œå£ä¸­ç–¾å‘¼çƒ«çƒ«çƒ«ã€‚<br>è„šè¸åƒæœµå±¯å±¯å±¯ï¼Œç¬‘çœ‹ä¸‡ç‰©è¯ºè¯ºè¯ºã€‚</p><h2 id="å®¢æˆ·å¤šæ ·æ€§"><a href="#å®¢æˆ·å¤šæ ·æ€§" class="headerlink" title="å®¢æˆ·å¤šæ ·æ€§"></a>å®¢æˆ·å¤šæ ·æ€§</h2><p>æˆ‘ä»¥ä¸ºçš„ç©å®¶ï¼š<br>è€è€å®å®æ‰“æ€ªã€‚è€è€å®å®åˆ·æ€ªã€‚è€è€å®å®æ¢é™©<br>å®é™…ä¸Šçš„ç©å®¶ï¼š<br>è¿™ä¸ªæ€ªç‰©ä¸­é—´æœ‰æ¡ç¼ã€‚æ¬¸ï¼æˆ‘è¹­åˆ°å®ç®±äº†ã€‚<br>æˆ‘æŠŠè¿™ä¸ªæ€ªç‰©å¸¦åˆ°æ‘åº„ä¼šæ€ä¹ˆæ ·ã€‚<br>æˆ‘æ‹¿åˆ°å®ç®±çš„æ—¶å€™ç«‹åˆ»å…³äº†æ¸¸æˆç„¶åæ¢ä¸€ä¸ªä¸Šçº¿æ˜¯ä¸æ˜¯å°±å¯ä»¥ç™½å«–ä¸€ä»½ã€‚<br>â€¦â€¦</p><h2 id="Jeff-Dean"><a href="#Jeff-Dean" class="headerlink" title="Jeff Dean"></a>Jeff Dean</h2><ul><li>ä»£ç ä½œä¸ºæ–‡æ¡£ä½¿ç”¨ï¼Œæäº¤çš„åªæœ‰äºŒè¿›åˆ¶æ–‡ä»¶</li><li>é”®ç›˜åªæœ‰0å’Œ1</li><li>æäº¤å‰ä¼šéªŒè¯æ€§çš„ç¼–è¯‘ä¸€æ¬¡</li><li>ç¼–è¯‘æœŸé—´ä¼šè­¦å‘Šç¼–è¯‘å™¨ï¼Œè€Œä¸æ˜¯ç¼–è¯‘å™¨ç»™å‡ºè­¦å‘Š</li><li>é¡ºä¾¿æ£€æŸ¥ç¼–è¯‘å™¨æœ‰æ²¡æœ‰Bug</li><li>æ¯å¤©æ‰“å¼€é‚®ç®±ï¼Œæ£€æŸ¥ä»Šå¤©è¯·æ±‚gcc -O4ä¼˜åŒ–çš„ä»£ç </li><li>ç²¾åŠ›æœ‰é™ï¼Œæ‰€ä»¥ç®—æ³•é€šå¸¸ä¼˜åŒ–åˆ°O(1&#x2F;n)</li><li>ä»…æœ‰çš„å¤±æ‰‹æ˜¯æ—…è¡Œå•†é—®é¢˜ï¼Œä¼˜åŒ–åˆ°O(n^2)</li><li>è¢«è¿«ä½¿ç”¨å¼‚æ­¥APIï¼Œå› ä¸ºä¼˜åŒ–è¿‡çš„å‡½æ•°ä¼šåœ¨è¢«è°ƒç”¨å‰è¿”å›</li><li>å¶å°”æ‰‹åŠ¨æ¥ç®¡GoogleæŒ‚æ‰çš„æœåŠ¡å™¨ï¼ŒæœŸé—´ç”¨æˆ·æ»¡æ„åº¦ç¿»å€</li></ul><h2 id="ç¨‹åºå‘˜çš„è¯»ä¹¦å†ç¨‹"><a href="#ç¨‹åºå‘˜çš„è¯»ä¹¦å†ç¨‹" class="headerlink" title="ç¨‹åºå‘˜çš„è¯»ä¹¦å†ç¨‹"></a>ç¨‹åºå‘˜çš„è¯»ä¹¦å†ç¨‹</h2><p>xè¯­è¨€å…¥é—¨-&gt;xè¯­è¨€åº”ç”¨å®è·µ-&gt;xè¯­è¨€é«˜çº§ç¼–ç¨‹-&gt;xè¯­è¨€çš„ç§‘å­¦ä¸è‰ºæœ¯-&gt;ç¼–ç¨‹ä¹‹ç¾-&gt;ç¼–ç¨‹ä¹‹é“-&gt;ç¼–ç¨‹ä¹‹ç¦…-&gt;é¢ˆæ¤ç—…åº·å¤æŒ‡å—ã€‚</p><h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><p>è¿˜æ²¡ä¸Šå¤§å­¦çš„æ—¶å€™ï¼Œé«˜ä¸‰æš‘å‡ï¼Œè·‘åˆ°å®¶é‚£è¾¹çš„å›¾ä¹¦é¦†æƒ³ä¹°ä¼ è¯´ä¸­çš„C++çš„ä¹¦ï¼Œç„¶åçœ‹åˆ°ä¸€æœ¬C#ï¼Œæˆ‘ä¸€çœ‹ï¼Œå˜¿ï¼Œè¿™ä¸ª++å†™çš„è¿˜æŒºæœ‰è‰ºæœ¯çš„ï¼Œé‡å èµ·æ¥äº†ï¼Œäºæ˜¯æŠŠC#ä¹°äº†å›æ¥â€¦â€¦</p><h2 id="ã€Šæ¡ƒèŠ±åºµã€‹"><a href="#ã€Šæ¡ƒèŠ±åºµã€‹" class="headerlink" title="ã€Šæ¡ƒèŠ±åºµã€‹"></a>ã€Šæ¡ƒèŠ±åºµã€‹</h2><p>å†™å­—æ¥¼é‡Œå†™å­—é—´ï¼Œå†™å­—é—´ç§ç¨‹åºå‘˜ï¼›ç¨‹åºäººå‘˜å†™ç¨‹åºï¼Œåˆå°†ç¨‹åºæ¢é…’é’±ï¼›é…’é†’åªåœ¨å±å‰åï¼Œé…’é†‰è¿˜æ¥å±ä¸‹çœ ï¼›é…’é†‰é…’é†’æ—¥å¤æ—¥ï¼Œå±å‰å±ä¸‹å¹´å¤å¹´ï¼›ä½†æ„¿è€æ­»ç”µè„‘é—´ï¼Œä¸æ„¿é èº¬è€æ¿å‰ï¼›å¥”é©°å®é©¬è´µè€…è¶£ï¼Œå…¬äº¤è‡ªè¡Œç¨‹åºå‘˜ï¼›åˆ«äººç¬‘æˆ‘å¤ªç–¯ç™«ï¼Œæˆ‘ç¬‘è‡ªå·±å‘½å¤ªè´±ï¼›ä½†è§æ»¡è¡—æ¼‚äº®å¦¹ï¼Œå“ªä¸ªå½’çš„ç¨‹åºå‘˜ã€‚</p><h2 id="å¯¹è”"><a href="#å¯¹è”" class="headerlink" title="å¯¹è”"></a>å¯¹è”</h2><p>ä¸Šè”ï¼šMYSQLæ˜æœˆä¸‰åƒé‡Œ<br>ä¸‹è”ï¼šXHTMLä¿¡å·ä»–å¦ˆçƒ‚</p><h2 id="ä¼Ÿå¤§"><a href="#ä¼Ÿå¤§" class="headerlink" title="ä¼Ÿå¤§"></a>ä¼Ÿå¤§</h2><p>ä¼ è¯´æœ‰ä¸€ä½è€å¤–ç«‹å¿—è¦å½“ä¸€ä½ä¼Ÿå¤§çš„ä½œå®¶ï¼Œä»€ä¹ˆæ—¶ä¼Ÿå¤§çš„ä½œå®¶ï¼Ÿä»–è¯´ï¼šâ€œæˆ‘å†™çš„ä¸œè¥¿å…¨ä¸–ç•Œéƒ½çœ‹å¾—åˆ°ï¼çœ‹å®Œä»–ä»¬å¿…å®šä¼šæ­‡æ–¯åº•é‡Œï¼ä¼šç«å†’ä¸‰ä¸ˆï¼ä¼šç—›è‹¦ä¸‡åˆ†ï¼ç»“æœï¼Œä»–ï¼ŒæˆåŠŸäº†ï¼Œä»–åœ¨å¾®è½¯å…¬å¸è´Ÿè´£å†™æ“ä½œç³»ç»Ÿè“å±æ—¶çš„æŠ¥é”™æç¤ºä¿¡æ¯ã€‚</p><h2 id="æ½œè§„åˆ™"><a href="#æ½œè§„åˆ™" class="headerlink" title="æ½œè§„åˆ™"></a>æ½œè§„åˆ™</h2><ul><li>äº†è§£&#x3D;å¬è¿‡åå­—</li><li>ç†Ÿæ‚‰&#x3D;çŸ¥é“æ˜¯å•¥</li><li>ç†Ÿç»ƒ&#x3D;ç”¨è¿‡</li><li>ç²¾é€š&#x3D;åšè¿‡ä¸œè¥¿</li></ul><h1 id="ç¨‹åºå‘˜å¯¹BUGååº”"><a href="#ç¨‹åºå‘˜å¯¹BUGååº”" class="headerlink" title="ç¨‹åºå‘˜å¯¹BUGååº”"></a>ç¨‹åºå‘˜å¯¹BUGååº”</h1><h2 id="ç›´æ¥æ€¼"><a href="#ç›´æ¥æ€¼" class="headerlink" title="ç›´æ¥æ€¼"></a>ç›´æ¥æ€¼</h2><ol><li>ç»å¯¹ä¸å¯èƒ½ï¼›</li><li>åœ¨æˆ‘è¿™é‡Œæ˜¯å¥½çš„ï¼Œä¸è¡Œä½ è¿‡æ¥çœ‹ï¼›</li><li>çœŸæ˜¯å¥‡æ€ªï¼Œåˆšæ‰è¿˜æ˜¯å¥½å¥½çš„ï¼›</li><li>ä½ æ¸…ç†ä¸‹ç¼“å­˜è¯•è¯•ï¼›</li><li>é‡å¯ç”µè„‘è¯•è¯•ï¼›</li><li>ä½ ç”¨çš„ä»€ä¹ˆç‰ˆæœ¬çš„åº“ï¼Ÿ</li><li>å°¼ç›æ€ä¹ˆè¿˜åœ¨ä½¿ç”¨æŸæŸå®‰å…¨æµè§ˆå™¨ã€‚</li></ol><h2 id="æŠ¥BUGçš„ç¤¼ä»ª"><a href="#æŠ¥BUGçš„ç¤¼ä»ª" class="headerlink" title="æŠ¥BUGçš„ç¤¼ä»ª"></a>æŠ¥BUGçš„ç¤¼ä»ª</h2><ul><li>ä¸è¦å¯¹ä¸€ä¸ªç¨‹åºå‘˜ç›´æ¥è¯´ï¼šä½ çš„BUGæœ‰ä»£ç ã€‚ä¸ç„¶ç¬¬ä¸€ååº”æ˜¯ï¼š1ã€ä¸€å®šæ˜¯ä½ çš„ç¯å¢ƒæœ‰é—®é¢˜ï¼›2ã€sbä½ ä¼šç”¨å—ï¼Ÿ</li><li>å¦‚æœå§”å©‰çš„è¯´ï¼šä½ çš„ç¨‹åºå’Œæˆ‘é¢„æœŸçš„æœ‰ç‚¹ä¸ä¸€è‡´ï¼Œä½ çœ‹çœ‹æ˜¯ä¸æ˜¯æˆ‘çš„ä½¿ç”¨æ–¹æ³•æœ‰é—®é¢˜ï¼ˆèµ°ç¨‹åºå‘˜çš„è·¯è®©ç¨‹åºå‘˜æ— è·¯å¯èµ°ï¼‰ã€‚ä»–å°±ä¼šæœ¬èƒ½çš„æƒ³ï¼šæ˜¯ä¸æ˜¯å‡ºBUGäº†ã€‚</li></ul><h2 id="ç¨‹åºå‘˜çš„æ ¸å¿ƒç«äº‰åŠ›æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#ç¨‹åºå‘˜çš„æ ¸å¿ƒç«äº‰åŠ›æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="ç¨‹åºå‘˜çš„æ ¸å¿ƒç«äº‰åŠ›æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>ç¨‹åºå‘˜çš„æ ¸å¿ƒç«äº‰åŠ›æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h2><p>â€œç©ç®—æ³•çš„ç å†œï¼Œæ‰“æ‹¼é è“æ¡ï¼Œåƒæ˜¯æ³•å¸ˆã€‚æ•°å­¦å°±ç­‰äºè“æ¡æœ€å¤§å€¼ï¼Œæ•°å­¦å·®ï¼Œé­”æ³•å€¼ä¸é«˜ï¼Œå¾ˆå¿«å°±åˆ°ç“¶é¢ˆäº†ã€‚å¤–è¯­å½±å“å›è“é€Ÿåº¦ã€‚ç»éªŒå’Œæ™ºåŠ›åŠ æ€¥é€Ÿå’Œç©¿é€ã€‚ä¸ç©ç®—æ³•çš„ç å†œï¼Œåƒæ˜¯æˆ˜å£«ï¼Œæ‰“æ‹¼é è¡€æ¡ã€ä½“åˆ¶åŠ ç”Ÿå‘½ï¼Œç²¾ç¥åŠ ç”Ÿå‘½æ¢å¤ï¼Œç»éªŒå’Œæ•æ·åŠ æ€¥é€Ÿå’Œç ´ç”²ã€‚â€</p><h2 id="é‚£äº›è€é¸Ÿç¨‹åºå‘˜ç›´åˆ°è€Œæ–°æ‰‹ç¨‹åºå‘˜ä¸çŸ¥é“çš„å°æŠ€å·§ï¼Ÿ"><a href="#é‚£äº›è€é¸Ÿç¨‹åºå‘˜ç›´åˆ°è€Œæ–°æ‰‹ç¨‹åºå‘˜ä¸çŸ¥é“çš„å°æŠ€å·§ï¼Ÿ" class="headerlink" title="é‚£äº›è€é¸Ÿç¨‹åºå‘˜ç›´åˆ°è€Œæ–°æ‰‹ç¨‹åºå‘˜ä¸çŸ¥é“çš„å°æŠ€å·§ï¼Ÿ"></a>é‚£äº›è€é¸Ÿç¨‹åºå‘˜ç›´åˆ°è€Œæ–°æ‰‹ç¨‹åºå‘˜ä¸çŸ¥é“çš„å°æŠ€å·§ï¼Ÿ</h2><p>ç¨‹åºä¸ç­‰äºæ•°æ®ç»“æ„åŠ ç®—æ³•ï¼Œè€Œç­‰äºæœç´¢å¼•æ“åŠ è‹±è¯­ã€‚</p><h1 id="å­”ä¹™å·±"><a href="#å­”ä¹™å·±" class="headerlink" title="å­”ä¹™å·±"></a>å­”ä¹™å·±</h1><p>äº’è”ç½‘çš„æ ¼å±€ï¼Œæ˜¯å’Œåˆ«å¤„ä¸åŒçš„ï¼šéƒ½æ˜¯æ ¼å­è¡«ï¼Œç¨€ç–çš„å¤´å‘ï¼ŒåŒè‚©åŒ…ï¼Œç”·ã€‚</p><p>å†™ä»£ç çš„äººï¼Œå‚åˆå‚æ™šæ•£äº†å·¥ï¼Œæ¯æ¯ä¸‰ä¿©äººï¼ŒèƒŒç€æ‰‹ï¼Œæ²¿ç€è½¯ä»¶å›­æºœå•¦ä¸€åœˆã€‚</p><p>å€˜è‹¥è‚¯èŠ±ç‚¹é’±ï¼Œä¾¿è¿˜ä¼šèµ°åˆ°æ˜Ÿå·´å…‹ï¼Œä¹°ä¸€æ¯å’–å•¡ï¼Œé‚£æ ·ä¾¿å†èƒ½å¤šæ¨¡å‡ åˆ†é’Ÿçš„ğŸŸã€‚</p><p>æˆ‘ä»åä¹å²èµ·ï¼Œä¾¿åœ¨è½¯ä»¶å›­æ‰“å·¥ï¼Œè€æ¿è¯´ï¼Œçœ‹ç€è¿˜ç®—æ¸…ç§€ï¼Œå°±è®©æˆ‘å»æ”¶é“¶ã€‚</p><p>æˆ‘ä»æ­¤ä¾¿æˆä¸ºäº†æ”¶é“¶å‘˜ã€‚</p><p>è€æ¿æ˜¯ä¸€å‰¯å‡¶é¢å­”ï¼Œé¡¾å®¢ä»¬è¯´è¯ä¹Ÿå¾ˆå°å£°ï¼Œæ•™äººæ´»æ³¼ä¸å¾—ã€‚</p><p>åªæœ‰å­”ä¹™å·±åˆ°åº—ï¼Œæ‰å¯ä»¥ç¬‘å‡ å£°ï¼Œæ‰€ä»¥æ‰è®°å¾—ã€‚</p><p>å­”ä¹™å·±æ˜¯ç©¿ç€æ ¼å­è¡«ï¼ŒèƒŒç€åŒè‚©åŒ…ï¼Œå¤´å‘å·²ç»å‡ ä¹æ²¡æœ‰çš„äººã€‚</p><p>ä»–èº«æé«˜å¤§ï¼Œé’ç™½è„¸è‰²ï¼Œçš±çº¹é—´æ—¶å¸¸å¤¹äº›ä¼¤ç—•ã€‚</p><p>ä¸€éƒ¨ä¹±è“¬è“¬çš„ç¨€ç–çš„å¤´å‘ï¼Œå‡ºå•Šçš„è™½æ˜¯æ ¼å­è¡«ï¼Œä¹Ÿæ˜¯åˆè„åˆç ´ï¼Œä¼¼ä¹åå¤šå¹´æ²¡æœ‰è¡¥ï¼Œä¹Ÿæ²¡æœ‰æ´—ã€‚</p><p>ä»–å¯¹äººè¯´è¯ï¼Œæ€»æ˜¯æ»¡å£é—­ç¯ã€æ‰“æ³•ã€å€’é€¼ã€è½åœ°ã€‚</p><p>æ•™äººåŠæ‡‚ä¸æ‡‚çš„ã€‚</p><p>å› ä¸ºä»–å§“å­”ï¼Œåˆ«äººä¾¿ä»æçº¢çº¸ä¸Šçš„â€œä¸Šå¤§äººå­”ä¹™å·±â€è¿™åŠæ‡‚ä¸æ‡‚çš„è¯é‡Œï¼Œæ›¿ä»–å–ä¸‹ä¸€ä¸ªå¤–å·ï¼Œå«åšå­”ä¹™å·±ã€‚</p><p>å­”ä¹™å·±ä¸€åˆ°åº—ï¼Œæ‰€æœ‰é¡¾å®¢ä¾¿éƒ½çœ‹ç€ä»–ç¬‘ï¼Œæœ‰çš„å«é“ï¼šâ€œå­”ä¹™å·±ï¼Œä½ åˆå†™äº†æ–°çš„BUGï¼â€</p><p>ä»–ä¸å›ç­”ï¼Œå¯¹æˆ‘è¯´ï¼šâ€œä¸€æ¯æ‘©å¡æ˜Ÿå†°ä¹ï¼Œä¸­æ¯ã€‚â€</p><p>ä¾¿æ‘¸å‡º35å—é›¶é’±ã€‚</p><p>ä»–ä»¬åˆæ•…æ„é«˜å£°åš·é“ï¼Œâ€œä½ ä¸€å®šåˆæå‡ºèµ„æŸäº†ï¼â€</p><p>å­”ä¹™å·±çå¤§çœ¼ç›è¯´ï¼Œâ€œä½ æ€ä¹ˆè¿™æ ·å‡­ç©ºæ±¡äººæ¸…ç™½â€¦â€¦â€</p><p>â€œä»€ä¹ˆæ¸…ç™½ï¼Œæˆ‘å‰å¤©äº²çœ¼çœ‹è§ä½ èƒŒäº†æ•…éšœï¼Œè¢«è€æ¿éª‚ã€‚â€</p><p>å­”ä¹™å·±ä¾¿æ¶¨çº¢äº†è„¸ï¼Œé¢å¤´ä¸Šçš„é’ç­‹æ¡æ¡ç»½å‡ºï¼Œäº‰è¾©é“ï¼Œâ€œåŒæ—¶å‘å¸ƒ10ä¸ªæœåŠ¡â€¦â€¦10ä¸ªæœåŠ¡ï¼å‘å¸ƒå¤±è´¥æ²¡æœ‰åŠæ—¶å›æ»šâ€¦â€¦ï¼Œè¿™èƒ½ç®—æ•…éšœï¼Ÿâ€</p><p>æ¥ç€ä¾¿æ˜¯éš¾æ‡‚çš„è¯ï¼Œä»€ä¹ˆâ€œæ–¹æ³•è®ºâ€ï¼Œä»€ä¹ˆâ€œç»„åˆæ‹³â€ä¹‹ç±»ï¼Œå¼•å¾—ä¼—äººéƒ½å“„ç¬‘èµ·æ¥ã€‚</p><p>åº—å†…åº—å¤–å……æ»¡äº†å¿«æ´»çš„ç©ºæ°”ã€‚</p><p>å¬äººå®¶èƒŒåœ°é‡Œè°ˆè®ºï¼Œå­”ä¹™å·±åŸæ¥å½“è¿‡é¢†å¯¼ï¼Œä½†æ˜¯æœ€ç»ˆè¿˜æ˜¯å€’é—­äº†ã€‚</p><p>äºæ˜¯äººåˆ°äº†ä¸­å¹´ï¼Œæ„ˆè¿‡æ„ˆç©·ï¼Œå¼„åˆ°å°†è¦è®¨é¥­äº†ã€‚</p><p>å¹¸è€Œä»£ç å†™çš„è¿˜ä¸é”™ï¼Œä¾¿è¿›äº†ä¸€å®¶åˆ›ä¸šå…¬å¸ï¼Œæ··å£é¥­åƒã€‚</p><p>å¯æƒœä»–åˆæœ‰ä¸€æ ·åè„¾æ°”ï¼Œä¾¿æ˜¯æƒ…å•†ä¸é«˜ã€‚</p><p>ç»å¸¸åšä¸åˆ°å‡ å¤©ï¼Œä¾¿å¾—ç½ªè€æ¿ã€‚</p><p>å¦‚æ˜¯å‡ æ¬¡ï¼Œå·¥ä½œä¾¿éš¾æ‰¾äº†ã€‚</p><p>å­”ä¹™å·±æ²¡æœ‰æ³•ï¼Œä¾¿å…ä¸äº†å¶ç„¶åšäº›å¤–åŒ…çš„äº‹ã€‚</p><p>ä½†ä»–åœ¨è¿™é‡Œï¼Œå“è¡Œå´æ¯”åˆ«äººéƒ½å¥½ï¼Œå°±æ˜¯ä»ä¸æ‹–æ¬ ã€‚</p><p>è™½ç„¶é—´æˆ–æ²¡æœ‰ç°é’±ï¼Œæš‚æ—¶è®°åœ¨è´¦ä¸Šï¼Œä½†ä¸å‡ºä¸€ä¸ªæœˆï¼Œå®šç„¶è¿˜æ¸…ï¼Œä»è´¦ä¸Šæ‹­å»å­”ä¹™å·±çš„åå­—ã€‚</p><p>å­”ä¹™å·±å–è¿‡åŠæ¯å’–å•¡ï¼Œæ¶¨çº¢çš„è„¸è‰²æ¸æ¸å¤åŸï¼Œæ—äººä¾¿åˆé—®é“ï¼Œå­”ä¹™å·±ï¼Œä½ å½“çœŸå½“è¿‡é¢†å¯¼å—ï¼Ÿ</p><p>å­”ä¹™å·±çœ‹ç€é—®ä»–çš„äººï¼Œæ˜¾å‡ºä¸å±‘ç½®è¾©çš„ç¥æ°”ã€‚</p><p>ä»–ä»¬ä¾¿æ¥ç€é—®é“ï¼Œâ€œä½ æ€çš„è¿ä¸ªäºŒçº¿å…¬å¸ä¹Ÿè¿›ä¸å»å‘¢ï¼Ÿâ€</p><p>å­”ä¹™å·±ç«‹åˆ»æ˜¾å‡ºé¢“å”ä¸å®‰çš„æ¨¡æ ·ï¼Œè„¸ä¸Šç¬¼ç½©äº†ä¸€å±‚ç°è‰²ï¼Œå˜´é‡Œè¯´äº›è¯ã€‚</p><p>è¿™å›å¯æ˜¯å…¨æ˜¯â€œä»·å€¼è½¬åŒ–â€ï¼Œâ€œç»“æœå¯¼å‘â€ä¹‹ç±»ï¼Œå®Œå…¨å¬ä¸æ‡‚äº†ã€‚</p><p>åœ¨è¿™æ—¶å€™ï¼Œä¼—äººä¹Ÿå°±å“„ç¬‘èµ·æ¥ï¼Œåº—å†…åº—å¤–å……æ»¡äº†å¿«æ´»çš„ç©ºæ°”ã€‚</p><p>åœ¨è¿™äº›æ—¶å€™ï¼Œæˆ‘å¯ä»¥é™„å’Œç€ç¬‘ï¼Œè€æ¿æ˜¯å†³ä¸è´£å¤‡çš„ã€‚</p><p>è€Œä¸”è€æ¿è§äº†å­”ä¹™å·±ï¼Œä¹Ÿæ¯æ¯è¿™æ ·é—®ä»–ï¼Œå¼•äººå‘ç¬‘ã€‚</p><p>å­”ä¹™å·±è‡ªå·±çŸ¥é“ä¸èƒ½å’Œä»–ä»¬è°ˆå¤©ï¼Œä¾¿åªå¥½å‘å­©å­è¯´è¯ã€‚</p><p>æœ‰ä¸€å›å¯¹æˆ‘è¯´é“ï¼Œâ€œä½ çœ‹è¿‡ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ä¹ˆï¼Ÿâ€</p><p>æˆ‘ç•¥ç•¥ç‚¹ä¸€ç‚¹å¤´ã€‚</p><p>ä»–è¯´ï¼Œâ€œè¯»è¿‡ï¼Œâ€¦â€¦æˆ‘ä¾¿è€ƒä½ ä¸€è€ƒã€‚æ€ä¹ˆèƒ½èµ‹èƒ½æ–°äº§å“ï¼Ÿâ€</p><p>æˆ‘æƒ³ï¼Œè®¨é¥­ä¸€æ ·çš„äººï¼Œä¹Ÿé…è€ƒæˆ‘å—ï¼Ÿ</p><p>ä¾¿å›è¿‡è„¸å»ï¼Œä¸å†ç†ä¼šã€‚</p><p>å­”ä¹™å·±ç­‰äº†è®¸ä¹…ï¼Œå¾ˆæ³åˆ‡çš„è¯´åˆ°ï¼Œâ€œä¸ä¼šç½¢ï¼Ÿâ€¦â€¦æˆ‘æ•™ç»™ä½ ï¼Œè®°ç€ï¼è¿™æ ·åšï¼Œå°†æ¥åšé¢†å¯¼çš„æ—¶å€™ï¼Œè¦ç”¨ã€‚â€</p><p>æˆ‘æš—æƒ³æˆ‘è¿˜åœ¨æ˜Ÿå·´å…‹æ‰“å·¥ï¼Œåªæ˜¯ä¸ªæ”¶é“¶å‘˜è€Œå·²ï¼Œè€Œä¸”æˆ‘ä»¬è¿™é‡Œä¹Ÿä¸éœ€è¦ç¨‹åºå‘˜ï¼Œæ›´ä¸éœ€è¦é¢†å¯¼ã€‚</p><p>åˆå¥½ç¬‘ï¼Œåˆä¸è€çƒ¦ï¼Œæ‡’æ‡’çš„å›ç­”ï¼Œâ€œè°è¦ä½ æ•™ï¼Œä¸å°±æ˜¯æ‰“é€šä¿¡æ¯å±éšœï¼Œèšç„¦ç”¨æˆ·æ„ŸçŸ¥èµ›é“ï¼Œå¤ç”¨æ‰“æ³•è¾¾æˆæŒä¹…æ”¶ç›Šï¼ŒæŠ½ç¦»é€ä¼ å½’å› åˆ†æï¼Œæœ€åä½œä¸ºæŠ“æ‰‹ä¸ºäº§å“èµ‹èƒ½å—ï¼Ÿâ€</p><p>å­”ä¹™å·±æ˜¾å‡ºæä¸ºé«˜å…´çš„æ ·å­ï¼Œå°†ä¸¤ä¸ªæŒ‡å¤´çš„é•¿æŒ‡ç”²æ•²ç€æŸœå°ï¼Œç‚¹å¤´è¯´ï¼Œâ€œå¯¹å‘€å¯¹å‘€ï¼â€¦â€¦èµ‹èƒ½è¿˜æœ‰4ç§æ–¹å¼ï¼Œä½ çŸ¥é“ä¹ˆï¼Ÿâ€</p><p>æˆ‘æ„ˆä¸è€çƒ¦äº†ï¼ŒåŠªç€å˜´èµ°è¿œã€‚</p><p>å­”ä¹™å·±åˆšæ‰“å¼€ç”µè„‘ï¼Œå…ˆçœ‹çœ‹CSDNï¼Œè§æˆ‘æ¯«ä¸çƒ­å¿ƒï¼Œä¾¿åˆå¹ä¸€å£æ°”ï¼Œæ˜¾å‡ºææƒ‹æƒœçš„æ ·å­ã€‚</p><p>æœ‰å‡ å›ï¼Œæ—è¾¹çš„å­©å­å¬å¾—ç¬‘å£°ï¼Œä¹Ÿèµ¶çƒ­é—¹ï¼Œå›´ä½å­”ä¹™å·±ã€‚</p><p>ä»–ä¾¿æ•™ä»–ä»¬æ–¹æ³•è®ºã€‚</p><p>å­©å­å¬ä¸æ‡‚ï¼Œä½†æ˜¯ä»ç„¶ä¸æ•£ï¼Œçœ¼ç›çœ‹ç€ä»–çš„å’–å•¡æ¯ã€‚</p><p>å­”ä¹™å·±ç€äº†æ…Œï¼Œä¼¸å¼€äº”æŒ‡å°†å’–å•¡ç½©ä½ï¼Œå¼¯ä¸‹è…°å»è¯´é“ï¼Œâ€œä¸å¤šäº†ï¼Œæˆ‘å·²ç»ä¸å¤šäº†ã€‚â€</p><p>ç›´èµ·èº«åˆçœ‹ä¸€çœ‹ï¼Œè‡ªå·±æ‘‡å¤´è¯´ï¼Œâ€œä¸å¤šä¸å¤šï¼Œå¤šä¹å“‰ï¼ä¸å¤šä¹Ÿã€‚â€</p><p>äºæ˜¯è¿™ä¸€ç¾¤å­©å­éƒ½åœ¨ç¬‘å£°é‡Œèµ°æ•£äº†ã€‚</p><p>å­”ä¹™å·±æ˜¯è¿™æ ·çš„ä½¿äººå¿«æ´»ï¼Œå¯æ˜¯æ²¡æœ‰ä»–ï¼Œåˆ«äººä¹Ÿå°±è¿™ä¹ˆè¿‡ã€‚</p><p>æœ‰ä¸€å¤©ï¼Œå¤§çº¦æ˜¯ä¸­ç§‹å‰çš„ä¸¤ä¸‰å¤©ï¼Œè€æ¿æ­£åœ¨æ…¢æ…¢çš„ç®—è´¦ï¼Œå¿½ç„¶è¯´ï¼Œâ€œå­”ä¹™å·±é•¿ä¹…æ²¡æœ‰æ¥äº†ã€‚è¿˜æ¬ åä¹å—é’±å‘¢ï¼â€</p><p>æˆ‘ä¹Ÿæ‰è§‰å¾—ä»–çš„ç¡®é•¿ä¹…æ²¡æœ‰æ¥äº†ã€‚</p><p>ä¸€ä¸ªå–é…’çš„äººè¯´åˆ°ï¼Œâ€œä»–æ€ä¹ˆæ¥ï¼Ÿâ€¦â€¦ä»–å¤±ä¸šå¾ˆä¹…äº†ã€‚â€</p><p>æŒæŸœè¯´ï¼Œâ€œå“¦ï¼â€</p><p>â€œä»–æ€»ä»æ—§åŠ ç­ã€‚è¿™ä¸€å›ï¼Œæ˜¯è‡ªå·±å‘æ˜ï¼Œç«Ÿæ€¼åˆ°CEOå¤´ä¸Šäº†ã€‚ä»–ä¸€ä¸ªP5ï¼Œå¾—ç½ªçš„èµ·ä¹ˆï¼Ÿâ€</p><p>â€œåæ¥æ€ä¹ˆæ ·ï¼Ÿâ€</p><p>â€œæ€ä¹ˆæ ·ï¼Ÿå…ˆå†™æ£€è®¨ï¼Œåæ¥æ˜¯é€šæŠ¥æ‰¹è¯„ï¼Œæœ€åè¢«è¾é€€ï¼Œè¿èµ”å¿éƒ½æ²¡æœ‰ã€‚â€</p><p>â€œåæ¥å‘¢ï¼Ÿâ€</p><p>â€œæ€æ ·ï¼Ÿâ€¦â€¦è°æ™“å¾—ï¼Ÿè®¸æ˜¯å›è€å®¶äº†ã€‚â€</p><p>è€æ¿ä¹Ÿä¸å†é—®ï¼Œä»ç„¶æ…¢æ…¢çš„ç®—ä»–çš„è´¦ã€‚</p><p>ä¸­ç§‹ä¹‹åï¼Œç§‹é£æ˜¯ä¸€å¤©å‡‰æ¯”ä¸€å¤©ï¼Œçœ‹çœ‹å°†è¿‘åˆå†¬ï¼Œè™½ç„¶åº—é‡Œæ•´å¤©å¼€ç€ç©ºè°ƒï¼Œä¹Ÿé¡»ç©¿ä¸Šæ£‰è¢„äº†ã€‚</p><p>ä¸€å¤©çš„ä¸‹åŠå¤©ï¼Œæ²¡æœ‰ä¸€ä¸ªé¡¾å®¢ï¼Œæˆ‘æ­£åˆçœ¼åç€ã€‚</p><p>å¿½ç„¶é—´å¬å¾—ä¸€ä¸ªå£°éŸ³ï¼Œâ€œä¸€æ¯æ‘©å¡ã€‚â€</p><p>è¿™å£°éŸ³è™½ç„¶ä½ï¼Œå´å¾ˆè€³ç†Ÿã€‚</p><p>çœ‹æ—¶åˆæ²¡æœ‰äººï¼Œç«™èµ·æ¥å‘å¤–ä¸€æœ›ï¼Œé‚£å­”ä¹™å·±ä¾¿åœ¨æŸœå°ä¸‹å¯¹äº†é—¨æ§›åç€ã€‚</p><p>ä»–è„¸ä¸Šé»‘è€Œä¸”ç˜¦ï¼Œå·²ç»ä¸æˆæ ·å­ã€‚</p><p>ç©¿ä¸€ä»¶ç ´æ£‰è¢„ï¼Œç›˜ç€ä¸¤è…¿ï¼Œä¸‹é¢é“ºäº†ä¸€ä¸ªè’²å›¢ï¼Œç”¨éº»ç»³åœ¨è‚©ä¸ŠæŒ‚ä½ã€‚</p><p>è§äº†æˆ‘ï¼Œåˆè¯´é“ï¼Œâ€œä¸€æ¯æ‘©å¡ã€‚â€</p><p>è€æ¿ä¹Ÿä¼¸å‡ºå¤´å»ï¼Œä¸€é¢è¯´ï¼Œâ€œå­”ä¹™å·±ä¹ˆï¼Ÿä½ è¿˜æ¬ ç€åä¹å—é’±å‘¢ï¼â€</p><p>å­”ä¹™å·±å¾ˆé¢“å”çš„ä»°é¢ç­”é“ï¼Œâ€œè¿™â€¦â€¦ä¸‹å›è¿˜æ¸…ç½¢ã€‚è¿™ä¸€å›æ˜¯ç°é‡‘ï¼Œå’–å•¡ä¸è¦åŠ å†°ã€‚â€</p><p>æŒæŸœä»ç„¶å’Œå¹³å¸¸ä¸€æ ·ï¼Œç¬‘ç€å¯¹ä»–è¯´ï¼Œâ€œå­”ä¹™å·±ï¼Œä½ åˆéª‚é¢†å¯¼è¯¾ï¼â€</p><p>ä½†ä»–è¿™å›å´ä¸ååˆ†åˆ†è¾¨ï¼Œå•è¯´äº†ä¸€å¥â€œä¸è¦å–ç¬‘ï¼â€</p><p>â€œå–ç¬‘ï¼Ÿè¦æ˜¯ä¸éª‚äººï¼Œæ€ä¹ˆè¢«å¼€é™¤äº†ï¼Ÿâ€</p><p>å­”ä¹™å·±ä½å£°è¯´é“ï¼Œâ€œè¾èŒã€è¾èŒã€è¾â€¦â€¦â€</p><p>ä»–çš„çœ¼è‰²ï¼Œå¾ˆåƒæ³æ±‚è€æ¿ï¼Œä¸è¦å†æã€‚</p><p>æ­¤æ—¶å·²ç»èšé›†äº†å‡ ä¸ªäººï¼Œä¾¿å’Œè€æ¿éƒ½ç¬‘äº†ã€‚</p><p>æˆ‘æ‹¿ç€å’–å•¡ï¼Œç«¯å‡ºå»ï¼Œæ”¾åœ¨é—¨æ§›ä¸Šã€‚</p><p>ä»–ä»ç ´è¡£å£è¢‹é‡Œæ‘¸å‡ºä¸€äº›é›¶é’±ï¼Œæ”¾åœ¨æˆ‘æ‰‹é‡Œï¼Œè§ä»–æ»¡æ‰‹æ˜¯ç°ï¼ŒåŸæ¥ä»–æ˜¯ä¾¿ç”¨è¿™æ‰‹èµ°æ¥çš„ã€‚</p><p>ä¸ä¸€ä¼šï¼Œåˆé•¿ä¹…æ²¡æœ‰è§åˆ°å­”ä¹™å·±ã€‚</p><p>åˆ°äº†å¹´å…³ï¼Œè€æ¿è¯´ï¼Œâ€œå­”ä¹™å·±è¿˜æ¬ ç€åä¹å—é’±å‘¢ï¼â€</p><p>åˆ°äº†ç¬¬äºŒå¹´çš„ç«¯åˆï¼Œåˆè¯´ï¼Œâ€œå­”ä¹™å·±è¿˜æ¬ åä¹å—é’±å‘¢ï¼â€</p><p>åˆ°ä¸­ç§‹å¯æ˜¯æ²¡æœ‰è¯´ï¼Œå†åˆ°å¹´å…³ä¹Ÿæ²¡æœ‰çœ‹è§ä»–ã€‚</p><p>æˆ‘åˆ°ç°åœ¨ç»ˆäºè§â€”â€”å¤§çº¦å­”ä¹™å·±çš„ç¡®å›è€å®¶äº†ã€‚</p><h1 id="mian-or-main"><a href="#mian-or-main" class="headerlink" title="mian or main"></a>mian or main</h1><p>ä¸ºä»€ä¹ˆæˆ‘å†™ä»£ç æ—¶æ€»æ˜¯ä¼šæ‰‹æ»‘æŠŠmainæ‰“æˆmianï¼Ÿ<br>å› ä¸ºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdio&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span><br><br><span class="hljs-type">void</span> å·¦æ‰‹()&#123;<br><span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;a&#x27;</span>);<br>&#125;<br><br><span class="hljs-type">void</span> å³æ‰‹()&#123;<br><span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;m&#x27;</span>);<br><span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;i&#x27;</span>);<br><span class="hljs-built_in">putchar</span>(<span class="hljs-string">&#x27;n&#x27;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>std::thread å·¦æ‰‹çº¿ç¨‹(å·¦æ‰‹);<br>std::thread å³æ‰‹çº¿ç¨‹(å³æ‰‹);<br>   å³æ‰‹çº¿ç¨‹.<span class="hljs-built_in">join</span>();<br>   å·¦æ‰‹çº¿ç¨‹.<span class="hljs-built_in">join</span>();<br>   <br>   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>æç¬‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[å­¦ä¹ ]å¤šçº¿ç¨‹é”</title>
    <link href="/2021/04/11/%E5%AD%A6%E4%B9%A0-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%94%81/"/>
    <url>/2021/04/11/%E5%AD%A6%E4%B9%A0-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¿¡å·é‡ä½¿ç”¨"><a href="#ä¿¡å·é‡ä½¿ç”¨" class="headerlink" title="ä¿¡å·é‡ä½¿ç”¨"></a>ä¿¡å·é‡ä½¿ç”¨</h1><p>åœ¨å¤šçº¿ç¨‹æ¡ä»¶ä¸‹ï¼Œå®Œæˆå¯¹ğŸ¥§çš„è®¡ç®—ã€‚å®éªŒæä¾›æœ‰å•çº¿ç¨‹ç‰ˆæœ¬ï¼Œè¦æ±‚è¿›è¡Œä¿®æ”¹ï¼Œå¹¶åœ¨ä»£ç ç©ºç™½å¤„å®ç°å¤šçº¿ç¨‹è®¡ç®—ã€‚å­¦ä¹ ä½¿ç”¨ä¿¡å·é‡ï¼Œé˜²æ­¢åœ¨å¤šçº¿ç¨‹è®¡ç®—æœ€ç»ˆç»“æœæ—¶å‡ºé”™ã€‚</p><h2 id="ä¸€ã€åŸç†"><a href="#ä¸€ã€åŸç†" class="headerlink" title="ä¸€ã€åŸç†"></a>ä¸€ã€åŸç†</h2><p>åˆ©ç”¨çº§æ•°çš„æ€æƒ³ï¼Œå°†è®¡ç®—è¿‡ç¨‹åˆ†ä¸ºå¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è®¡ç®—ğŸ¥§çš„ä¸€éƒ¨åˆ†ï¼Œæœ€åå°†ç»“æœç›¸åŠ ã€‚<br>$$<br>\pi&#x3D;4\times (1-\frac{1}{3}+\frac{1}{5}-\frac{1}{7}+\frac{1}{9}-â€¦)<br>$$<br>æ±‚ğŸ¥§çš„é—®é¢˜æ˜¯ä¸€ä¸ªç´¯åŠ é—®é¢˜ï¼Œä¸åŒçº¿ç¨‹è®¡ç®—è‡ªå·±çš„é¡¹æ•°å’Œï¼Œç„¶åè¾“å‡ºæ±‡æ€»åˆ°ä¸€ä¸ªè§£ä¸Šï¼Œè¿™é‡Œé™å®šä¸ºä¸€å—å…±äº«å†…å­˜ã€‚<br>å› ä¸ºä¸åŒçš„çº¿ç¨‹è¿è¡Œé€Ÿåº¦æœ‰å¿«æœ‰æ…¢ï¼Œå¦‚æœç¢°ä¸Šä¸¤ä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªå…±äº«å†…å­˜è¿›è¡ŒåŠ æ³•æ“ä½œï¼Œå°±ä¼šå‡ºç°è®¡ç®—é”™è¯¯ï¼Œä¸ºæ­¤éœ€è¦å¼•å…¥ä¿¡å·é‡sem_tã€‚</p><p><code>sem_t</code>çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore&gt;</span># å¼•å…¥è¿™ä¸ªåº“</span><br><br><span class="hljs-type">sem_t</span> sem# æ–°å»ºä¸€ä¸ªä¿¡å·é‡<br><span class="hljs-built_in">sem_init</span>(&amp;sem ,<span class="hljs-number">0</span> ,<span class="hljs-number">1</span>)# åœ¨mainä¸­è°ƒç”¨å°†ä¿¡å·é‡åˆå§‹åŒ–ä¸º<span class="hljs-number">1</span><br><span class="hljs-built_in">sem_wait</span>(&amp;sem)# åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰ï¼Œç­‰å¾…é”é‡Šæ”¾<br><span class="hljs-built_in">sem_post</span>(&amp;sem)# ä¸´ç•ŒåŒºä»£ç è¿è¡Œå®Œæ¯•åé‡Šæ”¾æ‰ä¿¡å·é‡<br><span class="hljs-built_in">sem_destory</span>(&amp;sem)# åœ¨ä¸»çº¿ç¨‹è¿è¡Œç»“æŸåï¼Œè°ƒç”¨é‡Šæ”¾æ‰ä¿¡å·é‡<br></code></pre></td></tr></table></figure><h2 id="äºŒã€æºä»£ç "><a href="#äºŒã€æºä»£ç " class="headerlink" title="äºŒã€æºä»£ç "></a>äºŒã€æºä»£ç </h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;math.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;semaphore.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/time.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> GET_TIME(now)                         \</span><br><span class="hljs-meta">   &#123;                                          \</span><br><span class="hljs-meta">      struct timeval t;                       \</span><br><span class="hljs-meta">      gettimeofday(&amp;t, NULL);                 \</span><br><span class="hljs-meta">      now = t.tv_sec + t.tv_usec / 1000000.0; \</span><br><span class="hljs-meta">   &#125;</span><br><br><span class="hljs-type">const</span> <span class="hljs-type">int</span> MAX_THREADS = <span class="hljs-number">1024</span>;<br><br><span class="hljs-type">long</span> thread_count;<br><span class="hljs-type">long</span> <span class="hljs-type">long</span> n;<br><span class="hljs-type">double</span> sum;<br><br><span class="hljs-type">sem_t</span> sem;<br><br><span class="hljs-function"><span class="hljs-type">void</span> *<span class="hljs-title">Thread_sum</span><span class="hljs-params">(<span class="hljs-type">void</span> *rank)</span></span>;<br><br><span class="hljs-comment">/* Only executed by main thread */</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Get_args</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span></span>;<br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Usage</span><span class="hljs-params">(<span class="hljs-type">char</span> *prog_name)</span></span>;<br><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">Serial_pi</span><span class="hljs-params">(<span class="hljs-type">long</span> <span class="hljs-type">long</span> n)</span></span>;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>   <span class="hljs-type">long</span> thread; <span class="hljs-comment">/* Use long in case of a 64-bit system */</span><br>   <span class="hljs-type">pthread_t</span> *thread_handles;<br>   <span class="hljs-type">double</span> start, finish, elapsed;<br><br>   <span class="hljs-comment">/* please choose terms &#x27;n&#x27;, and the threads &#x27;thread_count&#x27; here. */</span><br>   n = <span class="hljs-number">10000000000</span>;<span class="hljs-comment">// æ§åˆ¶è®¡ç®—é¡¹æ•°</span><br>   thread_count = <span class="hljs-number">4</span>;<span class="hljs-comment">// çº¿ç¨‹æ•°</span><br><br>   <span class="hljs-comment">/* You can also get number of threads from command line */</span><br>   <span class="hljs-comment">//Get_args(argc, argv);</span><br><br>   thread_handles = (<span class="hljs-type">pthread_t</span> *)<span class="hljs-built_in">malloc</span>(thread_count * <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">pthread_t</span>));<br>   <span class="hljs-built_in">sem_init</span>(&amp;sem, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);<br>   sum = <span class="hljs-number">0.0</span>;<br><br>   <span class="hljs-built_in">GET_TIME</span>(start);<br>   <span class="hljs-keyword">for</span> (thread = <span class="hljs-number">0</span>; thread &lt; thread_count; thread++)<br>      <span class="hljs-built_in">pthread_create</span>(&amp;thread_handles[thread], <span class="hljs-literal">NULL</span>,<br>                     Thread_sum, (<span class="hljs-type">void</span> *)thread);<br><br>   <span class="hljs-keyword">for</span> (thread = <span class="hljs-number">0</span>; thread &lt; thread_count; thread++)<br>      <span class="hljs-built_in">pthread_join</span>(thread_handles[thread], <span class="hljs-literal">NULL</span>);<br>   <span class="hljs-built_in">GET_TIME</span>(finish);<br>   elapsed = finish - start;<br><br>   sum = <span class="hljs-number">4.0</span> * sum;<br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;With n = %lld terms,\n&quot;</span>, n);<br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;   Our estimate of pi = %.15f\n&quot;</span>, sum);<br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The elapsed time is %e seconds\n&quot;</span>, elapsed);<br>   <span class="hljs-built_in">GET_TIME</span>(start);<br>   sum = <span class="hljs-built_in">Serial_pi</span>(n);<br>   <span class="hljs-built_in">GET_TIME</span>(finish);<br>   elapsed = finish - start;<br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;   Single thread est  = %.15f\n&quot;</span>, sum);<br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;The elapsed time is %e seconds\n&quot;</span>, elapsed);<br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;                   pi = %.15f\n&quot;</span>, <span class="hljs-number">4.0</span> * <span class="hljs-built_in">atan</span>(<span class="hljs-number">1.0</span>));<br><br>   <span class="hljs-built_in">sem_destroy</span>(&amp;sem);<br>   <span class="hljs-built_in">free</span>(thread_handles);<br>   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125; <span class="hljs-comment">/* main */</span><br><br><span class="hljs-comment">/*------------------------------------------------------------------*/</span><br><span class="hljs-function"><span class="hljs-type">void</span> *<span class="hljs-title">Thread_sum</span><span class="hljs-params">(<span class="hljs-type">void</span> *rank)</span></span><br><span class="hljs-function"></span>&#123;<br>   <span class="hljs-type">long</span> my_rank = (<span class="hljs-type">long</span> <span class="hljs-type">long</span>)rank;<br>   <span class="hljs-type">double</span> my_sum = <span class="hljs-number">0.0</span>;<br><br>   <span class="hljs-comment">/*******************************************************************/</span><br>   <span class="hljs-type">double</span> factor = <span class="hljs-number">1</span>;<br>   <span class="hljs-type">long</span> <span class="hljs-type">long</span> max_size = <span class="hljs-number">0</span>;<br>   <span class="hljs-keyword">if</span> (my_rank == <span class="hljs-number">3</span>)<span class="hljs-comment">// å¹³å‡åˆ†é…è®¡ç®—é‡ï¼Œæœ€åä¸€ä¸ªçº¿ç¨‹è®¡ç®—å‰©ä½™éƒ¨åˆ†ã€‚</span><br>   &#123;<br>      max_size = n;<br>   &#125;<br>   <span class="hljs-keyword">else</span><br>   &#123;<br>      max_size = my_rank * n / <span class="hljs-number">4</span> + n / <span class="hljs-number">4</span>;<br>   &#125;<br>   <span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> <span class="hljs-type">long</span> i = my_rank * n / <span class="hljs-number">4</span>; i &lt; max_size; i++, factor = -factor)<br>   &#123;<br>      my_sum += factor / (<span class="hljs-number">2</span> * (i + my_rank) + <span class="hljs-number">1</span>);<br>   &#125;<br>   <span class="hljs-comment">//printf(&quot;%.15lf\n&quot;, my_sum);</span><br><br>   <span class="hljs-built_in">sem_wait</span>(&amp;sem);<span class="hljs-comment">// ç­‰å¾…é”</span><br>   sum += my_sum;<span class="hljs-comment">// ä¸´ç•ŒçŠ¶æ€</span><br>   <span class="hljs-built_in">sem_post</span>(&amp;sem);<span class="hljs-comment">// é‡Šæ”¾é”</span><br><br>   <span class="hljs-comment">/******************************************************************/</span><br>   <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125; <span class="hljs-comment">/* Thread_sum */</span><br><br><span class="hljs-comment">/*------------------------------------------------------------------</span><br><span class="hljs-comment"> * Function:   Serial_pi</span><br><span class="hljs-comment"> * Purpose:    Estimate pi using 1 thread</span><br><span class="hljs-comment"> * In arg:     n</span><br><span class="hljs-comment"> * Return val: Estimate of pi using n terms of Maclaurin series</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">Serial_pi</span><span class="hljs-params">(<span class="hljs-type">long</span> <span class="hljs-type">long</span> n)</span></span><br><span class="hljs-function"></span>&#123;<br>   <span class="hljs-type">double</span> sum = <span class="hljs-number">0.0</span>;<br>   <span class="hljs-type">long</span> <span class="hljs-type">long</span> i;<br>   <span class="hljs-type">double</span> factor = <span class="hljs-number">1.0</span>;<br><br>   <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++, factor = -factor)<br>   &#123;<br>      sum += factor / (<span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>);<br>   &#125;<br>   <span class="hljs-keyword">return</span> <span class="hljs-number">4.0</span> * sum;<br><br>&#125; <span class="hljs-comment">/* Serial_pi */</span><br><br><span class="hljs-comment">/*------------------------------------------------------------------</span><br><span class="hljs-comment"> * Function:    Get_args</span><br><span class="hljs-comment"> * Purpose:     Get the command line args</span><br><span class="hljs-comment"> * In args:     argc, argv</span><br><span class="hljs-comment"> * Globals out: thread_count, n</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Get_args</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>   <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">3</span>)<br>      <span class="hljs-built_in">Usage</span>(argv[<span class="hljs-number">0</span>]);<br>   thread_count = <span class="hljs-built_in">strtol</span>(argv[<span class="hljs-number">1</span>], <span class="hljs-literal">NULL</span>, <span class="hljs-number">10</span>);<br>   <span class="hljs-keyword">if</span> (thread_count &lt;= <span class="hljs-number">0</span> || thread_count &gt; MAX_THREADS)<br>      <span class="hljs-built_in">Usage</span>(argv[<span class="hljs-number">0</span>]);<br>   n = <span class="hljs-built_in">strtoll</span>(argv[<span class="hljs-number">2</span>], <span class="hljs-literal">NULL</span>, <span class="hljs-number">10</span>);<br>   <span class="hljs-keyword">if</span> (n &lt;= <span class="hljs-number">0</span>)<br>      <span class="hljs-built_in">Usage</span>(argv[<span class="hljs-number">0</span>]);<br>&#125; <span class="hljs-comment">/* Get_args */</span><br><br><span class="hljs-comment">/*------------------------------------------------------------------</span><br><span class="hljs-comment"> * Function:  Usage</span><br><span class="hljs-comment"> * Purpose:   Print a message explaining how to run the program</span><br><span class="hljs-comment"> * In arg:    prog_name</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Usage</span><span class="hljs-params">(<span class="hljs-type">char</span> *prog_name)</span></span><br><span class="hljs-function"></span>&#123;<br>   <span class="hljs-built_in">fprintf</span>(stderr, <span class="hljs-string">&quot;usage: %s &lt;number of threads&gt; &lt;n&gt;\n&quot;</span>, prog_name);<br>   <span class="hljs-built_in">fprintf</span>(stderr, <span class="hljs-string">&quot;   n is the number of terms and should be &gt;= 1\n&quot;</span>);<br>   <span class="hljs-built_in">fprintf</span>(stderr, <span class="hljs-string">&quot;   n should be evenly divisible by the number of threads\n&quot;</span>);<br>   <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125; <span class="hljs-comment">/* Usage */</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ </tag>
      
      <tag>å¹¶è¡Œè®¡ç®—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[å­¦ä¹ ]Socketå¥—æ¥å­—å­¦ä¹ </title>
    <link href="/2021/03/22/%E5%AD%A6%E4%B9%A0-socket/"/>
    <url>/2021/03/22/%E5%AD%A6%E4%B9%A0-socket/</url>
    
    <content type="html"><![CDATA[<h1 id="socketå¥—æ¥å­—å­¦ä¹ "><a href="#socketå¥—æ¥å­—å­¦ä¹ " class="headerlink" title="socketå¥—æ¥å­—å­¦ä¹ "></a>socketå¥—æ¥å­—å­¦ä¹ </h1><h2 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h2><p>è®¡ç®—æœºç½‘ç»œè¯¾ç¨‹å­¦ä¹ ä½¿ç”¨æ“ä½œç³»ç»Ÿåº“socketåº“å®ç°ä¸€ä¸ªèƒ½å¤Ÿåœ¨å±€åŸŸç½‘å†…æ”¶å‘æ¶ˆæ¯çš„å‘½ä»¤è¡Œç¨‹åºã€‚å‚è€ƒèµ„æ–™æ¥ä¸»è¦è‡ªäºç½‘ä¸Šçš„åº“ç”¨æ³•æ•™ç¨‹ï¼Œç•™ä¸‹æ­¤æ–‡è®°å½•ä¸‹å­¦ä¹ çš„è¿‡ç¨‹ã€‚</p><h2 id="äºŒã€ä»‹ç»"><a href="#äºŒã€ä»‹ç»" class="headerlink" title="äºŒã€ä»‹ç»"></a>äºŒã€ä»‹ç»</h2><p>socketå¥—æ¥å­—æ˜¯è®¡ç®—æœºç½‘ç»œä¸­åº”ç”¨å±‚ä¸TCP&#x2F;IPåè®®æ—é€šä¿¡çš„ä¸­é—´è½¯ä»¶æŠ½è±¡å±‚ï¼Œå®ƒæ˜¯ä¸€ç»„æ¥å£ã€‚åœ¨è®¾è®¡æ¨¡å¼ä¸­ï¼ŒSocketå…¶å®æ˜¯ä¸€ä¸ªAPIå°†å¤æ‚çš„TCP&#x2F;IPåè®®éšè—åœ¨socketæ¥å£åé¢ï¼Œå¯¹äºä½¿ç”¨çš„ç”¨æˆ·æ¥è¯´ï¼Œä¸€ç»„ç®€å•çš„æ¥å£å°±æ˜¯å…¨éƒ¨ï¼Œè®©Socketå»ç»„ç»‡æ•°æ®ï¼Œè€Œç”¨æˆ·è‡ªå·±åªéœ€è¦å…³å¿ƒå¥½ä¼ è¾“çš„æ•°æ®ï¼Œå¯¹äºæ€ä¹ˆä¼ è¾“å¹¶ä¸éœ€è¦è¿‡å¤šäº†è§£ã€‚</p><p>ç½‘ç»œåè®®æœ‰åˆ†TCPå’ŒUDPä¸¤ç§åè®®ï¼Œä»–ä»¬çš„ä½œç”¨éƒ½æ˜¯æ”¶å‘æ•°æ®åŒ…ã€‚å”¯ä¸€çš„ä¸åŒæ˜¯TCPé¢å‘è¿æ¥ï¼Œåœ¨æ”¶å‘æ•°æ®åŒ…ä¹‹å‰è¿˜æœ‰ä¸€ä¸ªè¿æ¥è¿‡ç¨‹ï¼Œåªæœ‰å»ºç«‹è¿æ¥ä¹‹åæ‰èƒ½å‘é€æ•°æ®åŒ…ã€‚è€ŒUDPå¹¶ä¸éœ€è¦è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼Œå®ƒå¯ä»¥åšåˆ°åªç»™ä¸€ä¸ªåœ°å€ï¼Œé©¬ä¸Šå°±èƒ½å¤Ÿå‘é€ï¼Œæœ‰æ€¥é€Ÿå‘è´§é‚£å‘³äº†ã€‚<br>ä»–ä»¬ä¹‹é—´å„æœ‰ä¼˜åŠ£ã€‚</p><table><thead><tr><th>åè®®ç±»å‹</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>ä¸»è¦ç”¨é€”</th></tr></thead><tbody><tr><td>UDP</td><td>å¯ä»¥å¾ˆå¿«å‘é€æ•°æ®</td><td>å®¹æ˜“ä¸¢åŒ…ï¼Œæ˜“å—åˆ°ç½‘ç»œæ³¢åŠ¨å½±å“</td><td>è§†é¢‘é€šè¯ç­‰å¯¹ä¸¢åŒ…ä¸æ•æ„Ÿï¼Œä½†æ˜¯å¯¹å»¶è¿Ÿæ•æ„Ÿçš„é¢†åŸŸ</td></tr><tr><td>TCP</td><td>ç¨³å®šï¼Œä¸ä¼šä¸¢åŒ…</td><td>å‘é€æ•°æ®æ…¢ï¼Œä½†æ˜¯ä¸ä¼šå—åˆ°ç½‘ç»œæ³¢åŠ¨å½±å“</td><td>æ–‡ä»¶ä¼ è¾“ï¼ŒèŠå¤©ç­‰å¯¹ä¸¢åŒ…æ•æ„Ÿçš„é¢†åŸŸ</td></tr></tbody></table><h2 id="ä¸‰ã€ä½¿ç”¨"><a href="#ä¸‰ã€ä½¿ç”¨" class="headerlink" title="ä¸‰ã€ä½¿ç”¨"></a>ä¸‰ã€ä½¿ç”¨</h2><h3 id="1ã€TCPå®¢æˆ·ç«¯"><a href="#1ã€TCPå®¢æˆ·ç«¯" class="headerlink" title="1ã€TCPå®¢æˆ·ç«¯"></a>1ã€TCPå®¢æˆ·ç«¯</h3><h2 id="ä»¥ä¸‹æ•™ç¨‹åŸºäºWindows10ç¯å¢ƒã€‚é¦–å…ˆåŠ å…¥socketå¤´æ–‡ä»¶åº“ã€‚åœ¨ä½¿ç”¨ä¹‹å‰è¿˜éœ€è¦åˆå§‹åŒ–ï¼ŒæŒ‰ç…§ä»¥ä¸‹çš„æ–¹å¼åˆå§‹åŒ–é“¾æ¥åº“ï¼Œåœ¨å…·ä½“æ”¶å‘æ•°æ®å‰è°ƒç”¨ã€‚åœ¨ä¸€åˆ‡å‡†å¤‡å¦¥å½“ä¹‹åï¼Œå»ºç«‹ç¬¬ä¸€ä¸ªå¥—æ¥å­—ã€‚ç„¶åå‘æœåŠ¡å™¨å‘é€è¿æ¥å»ºç«‹è¯·æ±‚ã€‚æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå¯ä»¥ä½¿ç”¨sendå‡½æ•°å‘æœåŠ¡å™¨å‘é€æ•°æ®äº†ã€‚ä½¿ç”¨recvå‡½æ•°æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ã€‚ä½¿ç”¨å®Œè¿æ¥èµ„æºååº”å½“åŠæ—¶è°ƒç”¨å¥—æ¥å­—å…³é—­å‡½æ•°ï¼Œé‡Šæ”¾è¢«å ç”¨çš„èµ„æºã€‚"><a href="#ä»¥ä¸‹æ•™ç¨‹åŸºäºWindows10ç¯å¢ƒã€‚é¦–å…ˆåŠ å…¥socketå¤´æ–‡ä»¶åº“ã€‚åœ¨ä½¿ç”¨ä¹‹å‰è¿˜éœ€è¦åˆå§‹åŒ–ï¼ŒæŒ‰ç…§ä»¥ä¸‹çš„æ–¹å¼åˆå§‹åŒ–é“¾æ¥åº“ï¼Œåœ¨å…·ä½“æ”¶å‘æ•°æ®å‰è°ƒç”¨ã€‚åœ¨ä¸€åˆ‡å‡†å¤‡å¦¥å½“ä¹‹åï¼Œå»ºç«‹ç¬¬ä¸€ä¸ªå¥—æ¥å­—ã€‚ç„¶åå‘æœåŠ¡å™¨å‘é€è¿æ¥å»ºç«‹è¯·æ±‚ã€‚æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå¯ä»¥ä½¿ç”¨sendå‡½æ•°å‘æœåŠ¡å™¨å‘é€æ•°æ®äº†ã€‚ä½¿ç”¨recvå‡½æ•°æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ã€‚ä½¿ç”¨å®Œè¿æ¥èµ„æºååº”å½“åŠæ—¶è°ƒç”¨å¥—æ¥å­—å…³é—­å‡½æ•°ï¼Œé‡Šæ”¾è¢«å ç”¨çš„èµ„æºã€‚" class="headerlink" title="ä»¥ä¸‹æ•™ç¨‹åŸºäºWindows10ç¯å¢ƒã€‚é¦–å…ˆåŠ å…¥socketå¤´æ–‡ä»¶åº“ã€‚åœ¨ä½¿ç”¨ä¹‹å‰è¿˜éœ€è¦åˆå§‹åŒ–ï¼ŒæŒ‰ç…§ä»¥ä¸‹çš„æ–¹å¼åˆå§‹åŒ–é“¾æ¥åº“ï¼Œåœ¨å…·ä½“æ”¶å‘æ•°æ®å‰è°ƒç”¨ã€‚åœ¨ä¸€åˆ‡å‡†å¤‡å¦¥å½“ä¹‹åï¼Œå»ºç«‹ç¬¬ä¸€ä¸ªå¥—æ¥å­—ã€‚ç„¶åå‘æœåŠ¡å™¨å‘é€è¿æ¥å»ºç«‹è¯·æ±‚ã€‚æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå¯ä»¥ä½¿ç”¨sendå‡½æ•°å‘æœåŠ¡å™¨å‘é€æ•°æ®äº†ã€‚ä½¿ç”¨recvå‡½æ•°æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ã€‚ä½¿ç”¨å®Œè¿æ¥èµ„æºååº”å½“åŠæ—¶è°ƒç”¨å¥—æ¥å­—å…³é—­å‡½æ•°ï¼Œé‡Šæ”¾è¢«å ç”¨çš„èµ„æºã€‚"></a>ä»¥ä¸‹æ•™ç¨‹åŸºäºWindows10ç¯å¢ƒã€‚<br>é¦–å…ˆåŠ å…¥socketå¤´æ–‡ä»¶åº“ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;Winsock2.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sindows.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(lib, <span class="hljs-string">&quot;WS2_32.lib&quot;</span>)</span><br></code></pre></td></tr></table></figure><br>åœ¨ä½¿ç”¨ä¹‹å‰è¿˜éœ€è¦åˆå§‹åŒ–ï¼ŒæŒ‰ç…§ä»¥ä¸‹çš„æ–¹å¼åˆå§‹åŒ–é“¾æ¥åº“ï¼Œåœ¨å…·ä½“æ”¶å‘æ•°æ®å‰è°ƒç”¨ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>WSADATA wsd;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">WSAStartup</span>(<span class="hljs-built_in">MAKEWORD</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), &amp;wsd))<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;WSAStartup failed!\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br>åœ¨ä¸€åˆ‡å‡†å¤‡å¦¥å½“ä¹‹åï¼Œå»ºç«‹ç¬¬ä¸€ä¸ªå¥—æ¥å­—ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++">SOCKET sock;<br>SOCKET sock = <span class="hljs-built_in">socket</span>(PF_INET, SOCK_STREAM, IPPROTO_TCP); \\ PF_INETæŒ‡å®šè¿æ¥åè®®æ—ã€SOCK_STREAMè¡¨æ˜æ˜¯ä¸€ä¸ªTCPåè®®<br>addr.sin_family = AF_INET;\\<br>addr.sin_addr.S_un.S_addr = <span class="hljs-built_in">inet_addr</span>(<span class="hljs-string">&quot;127.0.0.1&quot;</span>);\\æŒ‡å®šæœåŠ¡å™¨IP4åœ°å€<br>addr.sin_port = <span class="hljs-built_in">htons</span>(<span class="hljs-number">1234</span>);\\æœåŠ¡å™¨å¼€æ”¾çš„ç›‘å¬ç«¯å£<br></code></pre></td></tr></table></figure><br>ç„¶åå‘æœåŠ¡å™¨å‘é€è¿æ¥å»ºç«‹è¯·æ±‚ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">connect</span>(sock, (SOCKADDR *)&amp;sockAddr, <span class="hljs-built_in">sizeof</span>(SOCKADDR)<span class="hljs-number">+10</span>);<br></code></pre></td></tr></table></figure><br>æˆåŠŸå»ºç«‹è¿æ¥åï¼Œå¯ä»¥ä½¿ç”¨<code>send</code>å‡½æ•°å‘æœåŠ¡å™¨å‘é€æ•°æ®äº†ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">send</span>(sock, <span class="hljs-string">&quot;aaa&quot;</span>, <span class="hljs-number">512</span>, <span class="hljs-number">0</span>);\\sockè¡¨æ˜åœ°å€ï¼Œâ€œaaaâ€æ˜¯å‘é€çš„æ•°æ®ï¼Œ<span class="hljs-number">512</span>æ˜¯å‘é€å­—ç¬¦æ•°é‡ï¼ˆå½“ç„¶å¯ä»¥ä½¿ç”¨<span class="hljs-keyword">sizeof</span>åŠ¨æ€ï¼Œä½†æ˜¯è¿™é‡Œå°±å·æ‡’æ‹‰ï¼‰ï¼Œ<span class="hljs-number">0</span>æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œä¸€èˆ¬ä¸åŠ¨<br></code></pre></td></tr></table></figure><br>ä½¿ç”¨<code>recv</code>å‡½æ•°æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">recv</span>(sock, szBuffer, <span class="hljs-number">512</span>, <span class="hljs-number">0</span>);\\szBufferæ˜¯æ¥å—å­—ç¼“å†²åŒºï¼ˆå°±æ˜¯æ”¶åˆ°çš„å­—ç¬¦å†™åˆ°å“ªé‡Œï¼‰ï¼Œ<br></code></pre></td></tr></table></figure><br>ä½¿ç”¨å®Œè¿æ¥èµ„æºååº”å½“åŠæ—¶è°ƒç”¨å¥—æ¥å­—å…³é—­å‡½æ•°ï¼Œé‡Šæ”¾è¢«å ç”¨çš„èµ„æºã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-built_in">closesocket</span>(sock);<br></code></pre></td></tr></table></figure></h2><p>ä¸‹é¢æŠŠä»£ç ç»„åˆæˆä¸€ä¸ªå…·å¤‡åŸºç¡€ä¿¡æ¯æ”¶å‘åŠŸèƒ½çš„ç¨‹åºã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(lib, <span class="hljs-string">&quot;ws2_32.lib&quot;</span>)</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;WinSock2.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">scmp</span><span class="hljs-params">(<span class="hljs-type">char</span> *a, <span class="hljs-type">char</span> *b)</span></span>&#123;<span class="hljs-comment">//</span><br>    <span class="hljs-keyword">if</span>(a[<span class="hljs-number">0</span>] == b[<span class="hljs-number">0</span>] &amp;&amp; a[<span class="hljs-number">1</span>] == b[<span class="hljs-number">1</span>] &amp;&amp; a[<span class="hljs-number">2</span>] == b[<span class="hljs-number">2</span>] &amp;&amp; a[<span class="hljs-number">3</span>] == b[<span class="hljs-number">3</span>])&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//åˆå§‹åŒ–DLL</span><br>    WSADATA wsaData;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">WSAStartup</span>(<span class="hljs-built_in">MAKEWORD</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), &amp;wsd))<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;WSAStartup failed!\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-comment">//åˆ›å»ºå¥—æ¥å­—</span><br>    SOCKET sock = <span class="hljs-built_in">socket</span>(PF_INET, SOCK_STREAM, IPPROTO_TCP);<br>    <span class="hljs-comment">//å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚</span><br>    sockaddr_in sockAddr;<br><br>    <span class="hljs-built_in">memset</span>(&amp;sockAddr, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(sockAddr)); <span class="hljs-comment">//æ¯ä¸ªå­—èŠ‚éƒ½ç”¨0å¡«å……</span><br>    sockAddr.sin_family = PF_INET;<br>    sockAddr.sin_addr.s_addr = <span class="hljs-built_in">inet_addr</span>(<span class="hljs-string">&quot;127.0.0.1&quot;</span>);<br>    sockAddr.sin_port = <span class="hljs-built_in">htons</span>(<span class="hljs-number">1234</span>);<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">connect</span>(sock, (SOCKADDR *)&amp;sockAddr, <span class="hljs-built_in">sizeof</span>(SOCKADDR)<span class="hljs-number">+10</span>))<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;client connect error&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-built_in">closesocket</span>(sock);<br>        <span class="hljs-built_in">WSACleanup</span>();<br>        <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-built_in">send</span>(sock, <span class="hljs-string">&quot;aaa&quot;</span>, <span class="hljs-number">512</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-comment">//æ¥æ”¶æœåŠ¡å™¨ä¼ å›çš„æ•°æ®</span><br>    <br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>    &#123;<br>        <span class="hljs-type">char</span> szBuffer[MAXBYTE] = &#123;<span class="hljs-number">0</span>&#125;;<br>        <br>        <span class="hljs-built_in">recv</span>(sock, szBuffer, MAXBYTE, <span class="hljs-number">0</span>);<br>        <span class="hljs-comment">//è¾“å‡ºæ¥æ”¶åˆ°çš„æ•°æ®</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;Message from server: \n&quot;</span> &lt;&lt; szBuffer &lt;&lt; endl &lt;&lt;<span class="hljs-string">&quot;------------------------------&quot;</span>&lt;&lt; endl;<br>        <span class="hljs-comment">// _sleep(50);</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;input your massage: &quot;</span> &lt;&lt; endl;<br>        <span class="hljs-built_in">fgets</span>(szBuffer, <span class="hljs-number">512</span>, stdin);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">scmp</span>(szBuffer,<span class="hljs-string">&quot;exit&quot;</span>) )&#123;<span class="hljs-comment">//è¾“å…¥exitå…³é—­è¿æ¥</span><br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        cout &lt;&lt; <span class="hljs-string">&quot;-------------------------------&quot;</span> &lt;&lt; endl;<br>        cout &lt;&lt; endl;<br>        <span class="hljs-built_in">send</span>(sock, szBuffer, <span class="hljs-number">512</span>, <span class="hljs-number">0</span>);<br>    &#125;<br><br><br>    <span class="hljs-comment">//å…³é—­å¥—æ¥å­—</span><br>    <span class="hljs-built_in">closesocket</span>(sock);<br>    <span class="hljs-comment">//ç»ˆæ­¢ä½¿ç”¨ DLL</span><br>    <span class="hljs-built_in">WSACleanup</span>();<br>    <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€TCPæœåŠ¡å™¨"><a href="#2ã€TCPæœåŠ¡å™¨" class="headerlink" title="2ã€TCPæœåŠ¡å™¨"></a>2ã€TCPæœåŠ¡å™¨</h3><p>ä¸Šé¢ä»£ç å·²ç»å»ºç«‹äº†ä¸€ä¸ªå…·å¤‡ä¿¡æ¯æ”¶å‘èƒ½åŠ›çš„å®¢æˆ·ç«¯ï¼Œæ¥ä¸‹å»å†™ä¸€ä¸ªèƒ½å¤Ÿæ¥å—ä¿¡æ¯ä¹Ÿå¯ä»¥å‘é€ä¿¡æ¯è¿›è¡Œäº¤äº’çš„æœåŠ¡ç«¯ç¨‹åºã€‚è¿™ä¸ªæœåŠ¡ç«¯ç¨‹åºçš„åŠŸèƒ½å¾ˆç®€å•ï¼Œå¯åŠ¨åæ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„socketè¿æ¥ï¼Œå…¶ä½™éƒ¨åˆ†ç…§æŠ„æ¥è‡ªå®¢æˆ·ç«¯çš„éƒ¨åˆ†ã€‚</p><h2 id="æœåŠ¡ç«¯å¼€å¤´äºå®¢æˆ·ç«¯ç›¸åŒï¼Œä¸åŒçš„æ˜¯å¥—æ¥å­—çš„å»ºç«‹æ–¹å¼ã€‚æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ã€‚"><a href="#æœåŠ¡ç«¯å¼€å¤´äºå®¢æˆ·ç«¯ç›¸åŒï¼Œä¸åŒçš„æ˜¯å¥—æ¥å­—çš„å»ºç«‹æ–¹å¼ã€‚æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ã€‚" class="headerlink" title="æœåŠ¡ç«¯å¼€å¤´äºå®¢æˆ·ç«¯ç›¸åŒï¼Œä¸åŒçš„æ˜¯å¥—æ¥å­—çš„å»ºç«‹æ–¹å¼ã€‚æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ã€‚"></a>æœåŠ¡ç«¯å¼€å¤´äºå®¢æˆ·ç«¯ç›¸åŒï¼Œä¸åŒçš„æ˜¯å¥—æ¥å­—çš„å»ºç«‹æ–¹å¼ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c++">sockaddr_in sockAddr;                <br>sockAddr.sin_family = PF_INET;                       <br>sockAddr.sin_addr.s_addr = <span class="hljs-built_in">htonl</span>(INADDR_ANY);   \\è¡¨ç¤ºç»‘å®šæœ¬æœºIP4åœ°å€ <br>sockAddr.sin_port = <span class="hljs-built_in">htons</span>(<span class="hljs-number">1234</span>); <br><span class="hljs-built_in">bind</span>(Sock, (SOCKADDR *)&amp;Addr, <span class="hljs-built_in">sizeof</span>(SOCKADDR));\\æŠŠè¿™ä¸ªå¥—æ¥å­—ç»‘å®šåˆ°æœåŠ¡å™¨å¯¹åº”ç«¯å£<br></code></pre></td></tr></table></figure><br>æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥ã€‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c++">SOCKET clntSock = <span class="hljs-built_in">accept</span>(Sock, (SOCKADDR *)&amp;Addr, &amp;nSize);<br></code></pre></td></tr></table></figure></h2><p>å®Œæ•´çš„æœåŠ¡ç«¯ä»£ç å¦‚ä¸‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs c++"> <span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> comment(lib, <span class="hljs-string">&quot;ws2_32.lib&quot;</span>)</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;WinSock2.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;windows.h&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-comment">// #include &lt;sys/socket.h&gt;</span><br><span class="hljs-comment">// #include &lt;netinet/in.h&gt;</span><br><span class="hljs-comment">// #include &lt;arpa/inet.h&gt;</span><br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    WSADATA wsaData;<br>    <span class="hljs-built_in">WSAStartup</span>(<span class="hljs-built_in">MAKEWORD</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), &amp;wsaData);<br>    SOCKET Sock = <span class="hljs-built_in">socket</span>(PF_INET, SOCK_STREAM, IPPROTO_TCP);<br>    sockaddr_in sockAddr;<br>    <span class="hljs-built_in">memset</span>(&amp;sockAddr, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(sockAddr));           <br>    sockAddr.sin_family = PF_INET;               <br>    sockAddr.sin_addr.s_addr = <span class="hljs-built_in">htonl</span>(INADDR_ANY);      <br>    sockAddr.sin_port = <span class="hljs-built_in">htons</span>(<span class="hljs-number">1234</span>); <br>    <br>    <span class="hljs-built_in">bind</span>(Sock, (SOCKADDR *)&amp;sockAddr, <span class="hljs-built_in">sizeof</span>(SOCKADDR)); <br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">listen</span>(Sock, SOMAXCONN) &lt; <span class="hljs-number">0</span>)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;listen set error&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    SOCKADDR clntAddr;<br>    <span class="hljs-type">int</span> nSize = <span class="hljs-built_in">sizeof</span>(SOCKADDR);<br>    SOCKET clntSock = <span class="hljs-built_in">accept</span>(Sock, (SOCKADDR *)&amp;clntAddr, &amp;nSize);\\clntSockæ˜¯æ”¶åˆ°çš„æ¥è‡ªå®¢æˆ·ç«¯åœ°å€ï¼Œååˆ†é‡è¦æ˜¯ä¹‹åå‘é€æ•°æ®ä¾æ®<br>    <span class="hljs-keyword">if</span> (clntSock == SOCKET_ERROR)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;error&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-built_in">closesocket</span>(clntSock);<br>        <span class="hljs-built_in">closesocket</span>(Sock);<br>        <span class="hljs-built_in">WSACleanup</span>();<br>        <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;OK to connect&quot;</span> &lt;&lt; endl;<br>    &#125;<br><br>    <span class="hljs-type">char</span> recv_buf[<span class="hljs-number">100</span>];<br>    <span class="hljs-type">int</span> recv_len = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        recv_len = <span class="hljs-built_in">recv</span>(clntSock, recv_buf, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (recv_len &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;receive error !!&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;message received&quot;</span> &lt;&lt; recv_buf &lt;&lt; endl;<br>        &#125;<br>        cout &lt;&lt; <span class="hljs-string">&quot;send out your message&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-type">char</span> send_buf[<span class="hljs-number">100</span>];<br>        cin &gt;&gt; send_buf;<br>        <span class="hljs-type">int</span> send_len = <span class="hljs-built_in">strlen</span>(send_buf);<br>        send_len = <span class="hljs-built_in">send</span>(clntSock, send_buf, <span class="hljs-number">100</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (send_len &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;send out successfully &quot;</span> &lt;&lt; endl;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;î‚¢î¶<br>    <span class="hljs-built_in">closesocket</span>(clntSock);<br>    <span class="hljs-built_in">closesocket</span>(servSock);<br>    <span class="hljs-built_in">WSACleanup</span>();<br>    <span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h2><p>æ€»ä½“æ¥è¯´å®éªŒè¿˜æ˜¯éå¸¸è½»æ¾çš„ï¼Œå¯ä»¥å°†æœåŠ¡ç«¯æ”¾åˆ°æœ‰å…¬ç½‘IPçš„æœåŠ¡å™¨ä¸Šï¼ˆå®Œå…¨æ²¡æœ‰å®‰å…¨æªæ–½å°±æ˜¯äº†ï¼‰ã€‚å®ç°äº†ä¸€ä¸ªéå¸¸ç®€æ˜“çš„èŠå¤©å®¤ï¼Œå°½ç®¡ç›®å‰ä»£ç ååˆ†ä¸å®Œå–„ï¼Œæ¯”å¦‚è¯´åªèƒ½åœ¨å‘é€æ¶ˆæ¯ä¹‹åæ‰èƒ½æ˜¾ç¤ºæ¥è‡ªæœåŠ¡ç«¯çš„æ¶ˆæ¯ã€‚</p><p>æœ¬æ–‡æ˜¯windowsä¸‹å¥—æ¥å­—ä½¿ç”¨çš„å­¦ä¹ ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ </tag>
      
      <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[æŠ˜è…¾]scoop</title>
    <link href="/2021/03/03/%E6%8A%98%E8%85%BE-scoop/"/>
    <url>/2021/03/03/%E6%8A%98%E8%85%BE-scoop/</url>
    
    <content type="html"><![CDATA[<h1 id="windowsä¸‹å¥½ç”¨çš„åŒ…ç®¡ç†å™¨scoop"><a href="#windowsä¸‹å¥½ç”¨çš„åŒ…ç®¡ç†å™¨scoop" class="headerlink" title="windowsä¸‹å¥½ç”¨çš„åŒ…ç®¡ç†å™¨scoop"></a>windowsä¸‹å¥½ç”¨çš„åŒ…ç®¡ç†å™¨scoop</h1><h2 id="ä¸€ã€scoopç®€ä»‹"><a href="#ä¸€ã€scoopç®€ä»‹" class="headerlink" title="ä¸€ã€scoopç®€ä»‹"></a>ä¸€ã€scoopç®€ä»‹</h2><p>Scoopæ˜¯Windowsçš„å‘½ä»¤è¡Œå®‰è£…ç¨‹åºï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„åŒ…ç®¡ç†å·¥å…·ã€‚å¯ä»¥åœ¨githubä¸Šæ‰¾åˆ°å…¶é¡¹ç›®çš„ç›¸å…³ä¿¡æ¯ï¼Œé¡¹ç›®<a href="https://github.com/lukesampson/scoop">ç½‘å€</a>ã€‚</p><p>å®‰è£…çš„èµ·å› ï¼šåœ¨å­¦ä¹ ä¸­å¦‚æœè¦å®‰è£…åƒgccã€gitç­‰ä¸€äº›éœ€è¦æ‰‹åŠ¨é…ç½®ç›¸å…³å‚æ•°çš„å·¥å…·ï¼Œéœ€è¦å…ˆå»å®˜ç½‘ä¸‹è½½å®‰è£…ç¨‹åºï¼Œç‚¹å‡»å®‰è£…ï¼Œä¹‹åè¿˜éœ€è¦é…ç½®ç¯å¢ƒå˜é‡ï¼Œä¸ä»…è¿‡ç¨‹éº»çƒ¦ã€‚è€Œä¸”å·¥å…·å¤šäº†ä¹‹åæ•´ç†èµ·æ¥ä¹Ÿç›¸å½“ä¸å®¹æ˜“ï¼Œé…ç½®ä¹Ÿå¾ˆæ‚ï¼Œæ•´ä¸ªç”µè„‘å°±åƒè¢«æ±¡æŸ“äº†ä¸€æ ·ã€‚ä¸ä»…å¦‚æ­¤ï¼Œåœ¨windowsä¸‹é…ç½®ä¸€ä¸ªèƒ½ä½¿ç”¨çš„GCCç¼–è¯‘å™¨å’ŒGDBè°ƒè¯•å™¨ï¼Œèƒ½å¤Ÿä¸å‡ºå„ç§å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜å°±å·²ç»æ˜¯è°¢å¤©è°¢åœ°äº†ã€‚è¿™æ—¶å€™å°±å¥½ç¾¡æ…•éš”å£çš„linuxå¼ºå¤§çš„aptåŒ…ç®¡ç†å™¨ï¼Œæˆ–è€…macçš„homebrewã€‚è¿™æ—¶å€™scoopæ¨ªç©ºå‡ºä¸–ã€‚å®‰è£…scoopåï¼Œåªéœ€è¦åœ¨å‘½ä»¤è¡Œè¾“å…¥ç®€å•çš„ä¸€ä¸²å‘½ä»¤å³å¯å®‰è£…ä½ æƒ³è¦çš„è½¯ä»¶ã€‚æ¯”å¦‚æˆ‘æƒ³å®‰è£…gccï¼Œåªéœ€è¦è¾“å…¥</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scoop install gcc<br>scoop install gdb<br></code></pre></td></tr></table></figure><p>å°±èƒ½å¤Ÿå¸®æˆ‘å®Œæˆä»å®‰è£…åˆ°ç¯å¢ƒå˜é‡å…¨éƒ¨è¿‡ç¨‹ã€‚ä»æ­¤å‘Šåˆ«ç™¾åº¦ä¸ºä»€ä¹ˆgccå‘½ä»¤å‡ºé”™ã€‚</p><h2 id="äºŒã€å®‰è£…scoop"><a href="#äºŒã€å®‰è£…scoop" class="headerlink" title="äºŒã€å®‰è£…scoop"></a>äºŒã€å®‰è£…scoop</h2><h3 id="1ã€è¦æ±‚"><a href="#1ã€è¦æ±‚" class="headerlink" title="1ã€è¦æ±‚"></a>1ã€è¦æ±‚</h3><ul><li>Windows 7 SP1 + &#x2F; Windows Server 2008+</li><li>Powershell 5 æˆ–è€…æ›´é«˜ç‰ˆæœ¬å’Œ.NET Framework 4.5æˆ–è€…æ›´é«˜ç‰ˆæœ¬</li><li>å¿…é¡»å¯ç”¨PowerShellï¼Œä¾‹å¦‚Set-ExecutionPolicy RemoteSigned -Scope CurrentUser</li><li>ä½ èƒ½å¤Ÿæ­£å¸¸ï¼ˆæœ€å¥½æ˜¯å¿«é€Ÿï¼‰è®¿é—®å…¨çƒæœ€å¤§åŒæ€§<a href="https://github.com/">äº¤å‹ç½‘ç«™</a></li></ul><h3 id="2ã€å®‰è£…"><a href="#2ã€å®‰è£…" class="headerlink" title="2ã€å®‰è£…"></a>2ã€å®‰è£…</h3><p>é¦–å…ˆæ‰“å¼€ä½¿ç”¨<strong>ç®¡ç†å‘˜èº«ä»½</strong>æ‰“å¼€PowerShellï¼Œåœ¨é‡Œé¢è¾“å…¥è¿™æ¡å‘½ä»¤å¯ç”¨è„šæœ¬ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">set-executionpolicy</span> remotesigned <span class="hljs-literal">-scope</span> currentuser<br></code></pre></td></tr></table></figure><p>| âš æ³¨æ„ï¼šå¦‚æœCç›˜å®¹é‡å‘Šæ€¥ï¼Œå…ˆçœ‹ç¬¬ä¸‰å°èŠ‚å¦‚ä½•è¿ç§»å®‰è£…ä½ç½®ã€‚<br>ç„¶åä½¿ç”¨è¿™æ¡å‘½ä»¤ä¸€é”®å®‰è£…ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">iex</span> (<span class="hljs-built_in">new-object</span> net.webclient).downloadstring(<span class="hljs-string">&#x27;https://get.scoop.sh&#x27;</span>)<br>æˆ–è€…<br><span class="hljs-built_in">iwr</span> <span class="hljs-literal">-useb</span> get.scoop.sh | <span class="hljs-built_in">iex</span><br></code></pre></td></tr></table></figure><p>ç­‰å‘½ä»¤æ‰§è¡Œç»“æŸåï¼Œè¾“å…¥ä»¥ä¸‹æŒ‡ä»¤æµ‹è¯•èƒ½å¦æ­£å¸¸ä½¿ç”¨<code>scoop</code>å‘½ä»¤ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scoop <span class="hljs-literal">-h</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå‡ºç°äº†</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">PS</span> D:\hexo&gt; scoop <span class="hljs-literal">-h</span><br>Usage: scoop &lt;command&gt; [&lt;<span class="hljs-type">args</span>&gt;]<br><br>Available commands are listed below.<br><br><span class="hljs-built_in">Type</span> <span class="hljs-string">&#x27;scoop help &lt;command&gt;&#x27;</span> to get more help <span class="hljs-keyword">for</span> a specific command.<br><br>Command    Summary<br><span class="hljs-literal">-------</span>    <span class="hljs-literal">-------</span><br>alias      Manage scoop aliases<br>bucket     Manage Scoop buckets<br>cache      Show or <span class="hljs-built_in">clear</span> the download cache<br><span class="hljs-built_in">cat</span>        Show content of specified manifest.<br>checkup    Check <span class="hljs-keyword">for</span> potential problems<br>cleanup    Cleanup apps by removing old versions<br>config     Get or <span class="hljs-built_in">set</span> configuration values<br>create     Create a custom app manifest<br>depends    List dependencies <span class="hljs-keyword">for</span> an app, <span class="hljs-keyword">in</span> the order they will be installed<br>download   Download apps <span class="hljs-keyword">in</span> the cache folder and verify hashes<br>export     Exports installed apps, buckets (and optionally configs) <span class="hljs-keyword">in</span> JSON format<br>help       Show help <span class="hljs-keyword">for</span> a command<br>hold       Hold an app to disable updates<br>home       Opens the app homepage<br>import     Imports apps, buckets and configs from a Scoopfile <span class="hljs-keyword">in</span> JSON format<br>info       Display information about an app<br>install    Install apps<br>list       List installed apps<br>prefix     Returns the path to the specified app<br>reset      Reset an app to resolve conflicts<br>search     Search available apps<br>shim       Manipulate Scoop shims<br>status     Show status and check <span class="hljs-keyword">for</span> new app versions<br>unhold     Unhold an app to enable updates<br>uninstall  Uninstall an app<br>update     Update apps, or Scoop itself<br>virustotal Look <span class="hljs-keyword">for</span> app`s hash or url on virustotal.com<br>which      Locate a shim/executable (similar to <span class="hljs-string">&#x27;which&#x27;</span> on Linux)<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆæ­å–œå®‰è£…å®Œæˆã€‚å®‰è£…åˆ°æ­¤ç»“æŸã€‚é¡ºå¸¦ä¸€æï¼Œè¿™ä¸ªè½¯ä»¶æ˜¯é»˜è®¤å®‰è£…åˆ°â€œC:\User\ç”¨æˆ·å\scoop\â€åº•ä¸‹çš„ã€‚è€Œä¸”åœ¨æ­¤ä¸‹è½½å®‰è£…çš„æ‰€æœ‰è½¯ä»¶éƒ½ä¼šåœ¨è¿™ä¸ªç›®å½•çš„â€œ\app\â€åº•ä¸‹ã€‚å¦‚æœCç›˜ç©ºé—´å¤šï¼Œé‚£ä¹ˆå®‰è£…ç»“æŸã€‚å¦‚æœCç›˜ç©ºé—´ä¸å¤Ÿï¼Œæˆ‘ä»¬å°±è¿˜éœ€è¦ä¿®æ”¹<code>scoop</code>é»˜è®¤å®‰è£…ä½ç½®ã€‚</p><h3 id="3ã€æ›´æ”¹é»˜è®¤å®‰è£…ä½ç½®"><a href="#3ã€æ›´æ”¹é»˜è®¤å®‰è£…ä½ç½®" class="headerlink" title="3ã€æ›´æ”¹é»˜è®¤å®‰è£…ä½ç½®"></a>3ã€æ›´æ”¹é»˜è®¤å®‰è£…ä½ç½®</h3><p>å°†scoopå®‰è£…åˆ°è‡ªå®šä¹‰ç›®å½•ã€‚éœ€è¦åœ¨æ‰§è¡Œ<code>scoop</code>çš„å®‰è£…è„šæœ¬ä¹‹å‰æ‰§è¡Œã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$env:SCOOP</span>=<span class="hljs-string">&#x27;D:\Applications\Scoop&#x27;</span>   \\ä½ çš„ç›®å½•<br>[<span class="hljs-type">Environment</span>]::SetEnvironmentVariable(<span class="hljs-string">&#x27;SCOOP&#x27;</span>, <span class="hljs-variable">$env:SCOOP</span>, <span class="hljs-string">&#x27;User&#x27;</span>)<br></code></pre></td></tr></table></figure><p><code>scoop</code>å®‰è£…è½¯ä»¶çš„ä½ç½®æ›´æ”¹ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$env:SCOOP_GLOBAL</span>=<span class="hljs-string">&#x27;F:\GlobalScoopApps&#x27;</span> \\ æŒ‡å®šç›®å½•<br>[<span class="hljs-type">Environment</span>]::SetEnvironmentVariable(<span class="hljs-string">&#x27;SCOOP_GLOBAL&#x27;</span>, <span class="hljs-variable">$env:SCOOP_GLOBAL</span>, <span class="hljs-string">&#x27;Machine&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€ä½¿ç”¨æ–¹æ³•"><a href="#ä¸‰ã€ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä¸‰ã€ä½¿ç”¨æ–¹æ³•"></a>ä¸‰ã€ä½¿ç”¨æ–¹æ³•</h2><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>search</td><td>æœç´¢è½¯ä»¶</td></tr><tr><td>install</td><td>å®‰è£…è½¯ä»¶</td></tr><tr><td>update</td><td>æ›´æ–°è½¯ä»¶å’Œæ›´æ–°è½¯ä»¶æº</td></tr><tr><td>status</td><td>æŸ¥çœ‹è½¯ä»¶çŠ¶æ€ï¼Œæ˜¯å¦æœ‰æ›´æ–°</td></tr><tr><td>uninstall</td><td>å¸è½½è½¯ä»¶</td></tr><tr><td>info</td><td>æŸ¥çœ‹è½¯ä»¶ä¿¡æ¯</td></tr><tr><td>home</td><td>æŸ¥çœ‹è½¯ä»¶ä¸»é¡µ</td></tr><tr><td>list</td><td>æŸ¥çœ‹å·²å®‰è£…çš„è½¯ä»¶</td></tr><tr><td>cache</td><td>æŸ¥çœ‹å®‰è£…ã€æ›´æ–°æ—¶çš„ç¼“å­˜</td></tr><tr><td>virustotal</td><td>åœ¨virustotal.orgä¸ŠæŸ¥çœ‹è½¯ä»¶çš„å“ˆå¸Œå€¼</td></tr></tbody></table><h2 id="å››ã€é¢å¤–å®‰æ’"><a href="#å››ã€é¢å¤–å®‰æ’" class="headerlink" title="å››ã€é¢å¤–å®‰æ’"></a>å››ã€é¢å¤–å®‰æ’</h2><h3 id="1ã€ä½¿ç”¨å›½å†…æº"><a href="#1ã€ä½¿ç”¨å›½å†…æº" class="headerlink" title="1ã€ä½¿ç”¨å›½å†…æº"></a>1ã€ä½¿ç”¨å›½å†…æº</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">iwr</span> <span class="hljs-literal">-useb</span> https://gitee.com/glsnames/scoop<span class="hljs-literal">-installer</span>/raw/master/bin/install.ps1 | <span class="hljs-built_in">iex</span><br>scoop config SCOOP_REPO <span class="hljs-string">&#x27;https://gitee.com/glsnames/scoop-installer&#x27;</span><br>scoop update<br></code></pre></td></tr></table></figure><h3 id="2ã€æ·»åŠ å…¶ä»–è½¯ä»¶åº“"><a href="#2ã€æ·»åŠ å…¶ä»–è½¯ä»¶åº“" class="headerlink" title="2ã€æ·»åŠ å…¶ä»–è½¯ä»¶åº“"></a>2ã€æ·»åŠ å…¶ä»–è½¯ä»¶åº“</h3><p><code>scoop</code>è‡ªå¸¦è½¯ä»¶åº“ä¸åŒ…å«å¤§éƒ¨åˆ†è½¯ä»¶ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ å…¶ä»–è½¯ä»¶åº“ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">scoop bucket add extras<br><span class="hljs-comment"># å¦‚ä¸Šæ·»åŠ çš„æ˜¯å®˜æ–¹ç»´æŠ¤çš„ extras è½¯ä»¶åº“</span><br>scoop update<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä»¥ä¸‹çš„è½¯ä»¶åº“</p><ul><li>main</li><li>versions</li><li>java</li><li>dorado</li></ul><h2 id="äº”ã€ä¸ºä»€ä¹ˆè¦å¼ºæ¨åŒ…ç®¡ç†å™¨"><a href="#äº”ã€ä¸ºä»€ä¹ˆè¦å¼ºæ¨åŒ…ç®¡ç†å™¨" class="headerlink" title="äº”ã€ä¸ºä»€ä¹ˆè¦å¼ºæ¨åŒ…ç®¡ç†å™¨"></a>äº”ã€ä¸ºä»€ä¹ˆè¦å¼ºæ¨åŒ…ç®¡ç†å™¨</h2><p>ä½œä¸ºä¸€ä¸ªåŒ…ç®¡ç†å™¨ï¼Œæœ€åŸºç¡€ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯å®‰è£…è½¯ä»¶ã€‚æ­£åœ¨ä½¿ç”¨ Windows çš„ä½ ä¸€å®šåœ¨æƒ³ï¼šã€Œä¸ºä»€ä¹ˆæˆ‘è¦ç”¨å®ƒï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä¸ç›´æ¥ç™¾åº¦ä¸€ä¸‹ï¼Ÿã€<br>å½“ç„¶å¯ä»¥ã€‚</p><ol><li>ç™¾åº¦ä¸€ä¸‹è¿™ä¸ªè½¯ä»¶</li><li>ç„¶ååœ¨ä¸€å †å¥‡å¥‡æ€ªæ€ªçš„ä¸‹è½½é“¾æ¥ä¸­å¾˜å¾Š</li><li>çœ‹åˆ°ä¸€ä¸ªçœ‹ä¸Šå»æœ€æ— æ¯’ï¼Œæœ€æ²¡æœ‰æ†ç»‘çš„å®‰è£…åŒ…</li><li>å°å¿ƒç¿¼ç¿¼çš„é¿å¼€æµæ°“ç‰¹æ€§</li><li>é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å®‰è£…ä½ç½®ï¼Œé˜²æ­¢åˆ°å¤„æ‹‰å±</li></ol><p>å¥½éº»çƒ¦çš„å®‰è£…ï¼ï¼ï¼</p><p>Scoop ç­‰ä¸€ç³»åˆ—åŒ…ç®¡ç†å™¨çš„è¯ç”Ÿï¼Œç¬¬ä¸€å¤§ä¾¿åˆ©å°±æ˜¯çœå»äº†ä¸Šè¿°ç¹ççš„ã€Œæœç´¢ - ä¸‹è½½ - å®‰è£…ã€çš„æ­¥éª¤ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡ã€Œä¸€è¡Œä»£ç ã€æ€¥é€Ÿå®‰è£…ã€‚ğŸ’ª</p><p>åŒæ—¶ï¼Œç”¨Scoopæ¥å®‰è£…å’Œç®¡ç†æˆ‘ä»¬çš„è½¯ä»¶ï¼š</p><ul><li>é›†æœç´¢ã€ä¸‹è½½ã€å®‰è£…ã€æ›´æ–°äºä¸€ä½“ï¼›æå¤§çš„é™ä½äº†å®‰è£…ç»´æŠ¤ä¸€ä¸ªè½¯ä»¶çš„æˆæœ¬ï¼Œæˆ‘ä»¬ç”šè‡³ä¸éœ€è¦åœ¨è½¯ä»¶å¤æ‚çš„èœå•ä¸­æ‰¾åˆ°æ›´æ–°æŒ‰é’®ï¼Œä¹Ÿä¸ä¼šæœ‰çƒ¦äººçš„å¼¹çª—æé†’ä½ æ›´æ–°ã€‚</li><li>å°†è½¯ä»¶å¹²å¹²å‡€å‡€çš„å®‰è£…åˆ°ç”µè„‘çš„{ç”¨æˆ·æ–‡ä»¶å¤¹}ä¸‹ï¼šæ±¡æŸ“è·¯å¾„ã€‚</li><li>å¸è½½è½¯ä»¶ä¹Ÿèƒ½å¤Ÿæ¸…ç©ºè½¯ä»¶ä»»ä½•æ•°æ®ã€‚</li><li>æœ‰ä¸€äº›å¿…è¦ä½†æ˜¯å®‰è£…ä¸å®¹æ˜“çš„è½¯ä»¶ä¾‹å¦‚<code>gdb</code>ä¹Ÿèƒ½å¤Ÿä¸€é”®è§£å†³ã€‚</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>æŠ˜è…¾</tag>
      
      <tag>å·¥å…·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[å­¦ä¹ ]å¹¿å·åœ°é“çº¿è·¯è§„åˆ’å¤§ä½œä¸š</title>
    <link href="/2020/12/07/%E5%AD%A6%E4%B9%A0-dijkstra/"/>
    <url>/2020/12/07/%E5%AD%A6%E4%B9%A0-dijkstra/</url>
    
    <content type="html"><![CDATA[<h1 id="Dijkstraç®—æ³•åº”ç”¨"><a href="#Dijkstraç®—æ³•åº”ç”¨" class="headerlink" title="Dijkstraç®—æ³•åº”ç”¨"></a>Dijkstraç®—æ³•åº”ç”¨</h1><h2 id="ä¸€ã€å‰è¨€"><a href="#ä¸€ã€å‰è¨€" class="headerlink" title="ä¸€ã€å‰è¨€"></a>ä¸€ã€å‰è¨€</h2><p>èµ·å› æ˜¯æ•°æ®ç»“æ„ä½œä¸šçš„æœŸæœ«ä½œä¸šï¼Œè¦æ±‚è®¾è®¡ä¸€ä¸ªå¹¿å·åœ°é“çº¿è·¯è§„åˆ’ç¨‹åºã€‚è¾“å…¥å‡ºå‘ç«™ç‚¹å’Œç›®çš„ç«™ç‚¹ï¼Œè¾“å‡ºæœ€çŸ­ä¹˜åè·¯å¾„å’Œæ¢ä¹˜çº¿è·¯æ–¹æ³•ã€‚</p><p>è¿™é¡¹ä½œä¸šæ˜¯å¯¹æœ¬å­¦æœŸæ‰€å­¦çš„æ•°æ®ç»“æ„ä¸€ä¸ªç»¼åˆè€ƒéªŒï¼Œæ¯”èµ·Dijkstraç®—æ³•ï¼Œå¦‚ä½•å­˜å‚¨åœ°é“çº¿è·¯å›¾ï¼Œå¦‚ä½•å°†ç«™ç‚¹åç§°è¾“å‡ºï¼Œå¦‚ä½•å­˜å‚¨å›¾ã€å»ºç«‹å›¾ï¼Œå¦‚ä½•å°†ä¸­æ–‡å­—ç¬¦å¯¹åº”åˆ°ä¸€ä¸ªå¯ä»¥è®¡ç®—ä½¿ç”¨çš„æ•°å­—ï¼Œä»¥åŠçº¿è·¯çš„æ›´æ–°æ˜¯æœ¬ç¨‹åºçš„é‡ç‚¹ã€‚</p><h2 id="äºŒã€æ ¸å¿ƒå‡½æ•°"><a href="#äºŒã€æ ¸å¿ƒå‡½æ•°" class="headerlink" title="äºŒã€æ ¸å¿ƒå‡½æ•°"></a>äºŒã€æ ¸å¿ƒå‡½æ•°</h2><h3 id="1ã€ç«™ç‚¹å-æ•°å­—çš„è½¬æ¢"><a href="#1ã€ç«™ç‚¹å-æ•°å­—çš„è½¬æ¢" class="headerlink" title="1ã€ç«™ç‚¹å-&gt;æ•°å­—çš„è½¬æ¢"></a>1ã€ç«™ç‚¹å-&gt;æ•°å­—çš„è½¬æ¢</h3><p>å¹¿å·åœ°é“ä¸Šçš„ç«™ç‚¹éƒ½æ˜¯ä¸­æ–‡å­—ç¬¦ï¼Œå¾ˆæ˜æ˜¾ï¼Œä¸­æ–‡å­—ç¬¦æ— è®ºæ˜¯åˆ¶ä½œæˆé‚»æ¥è¡¨è¿˜æ˜¯é‚»æ¥çŸ©é˜µéƒ½æ˜¯ä¸åˆé€‚çš„ï¼Œå› æ­¤éœ€è¦ä¸€ç§æ–¹æ³•ï¼Œå°†å¹¿å·åœ°é“ä¸Šä¸Šç™¾ä¸ªç«™ç‚¹ä¸€ä¸€è½¬æ¢æˆè®¡ç®—æœºå¯ä»¥ç”¨æ¥è®¡ç®—çš„æ•°å­—ã€‚äººå·¥æ‰‹åŠ¨æ›´æ¢æ˜¯ç»å¯¹çš„ä¸åˆé€‚ï¼Œå…ˆä¸è¯´ä¸Šç™¾ä¸ªç«™ç‚¹çš„æ ‡è®°ååˆ†ç´¯äººï¼Œæ›´åŠ é‡è¦çš„æ˜¯è¿™æ ·çš„ç¨‹åºå®Œå…¨æ²¡æœ‰ä»»ä½•çš„å¯æ‹“å±•æ€§ï¼Œå®ƒå°±ä¸èƒ½é€‚åº”æ–°åŠ çš„åœ°é“ç«™ç‚¹ã€‚<br>æ‰€ä»¥ï¼Œç»™ç«™ç‚¹æ‰“æ ‡è®°çš„æ´»è¿˜æ˜¯è¦äº¤ç»™è®¡ç®—æœºå¹²ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ–¹æ³•æ˜¯ï¼Œå°†åœ°é“ç«™æ‰€æœ‰çš„ç«™ç‚¹å’Œç«™ç‚¹ä¹‹é—´çš„çº¿è·¯æƒå€¼å­˜å‚¨åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚å­˜å‚¨æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼Œç¬¬ä¸€ä¸ªå­—ç¬¦è¡¨ç¤ºæ˜¯å“ªä¸€æ¡çº¿è·¯ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºå§‹å‘ç«™ï¼Œç¬¬ä¸‰ä¸ªå­—ç¬¦ä¸²è¡¨ç¤ºç»ˆç‚¹ç«™ï¼Œç¬¬å››ä¸ªæ•°å­—è¡¨ç¤ºè¾¹çš„æƒå€¼ã€‚</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs txt">4 å¤§å­¦åŸåŒ— å¤§å­¦åŸå— 1<br>4 å¤§å­¦åŸå— â€¦â€¦ 1<br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯ä»ä¸Šé¢çš„æ•°æ®æ–‡ä»¶ä¸­å»ºå›¾ï¼Œæ³¨æ„åˆ°è¿™ä¸ªå›¾çš„é‚»æ¥çŸ©é˜µä¼šæ˜¯ä¸€ä¸ªç¨€ç–çŸ©é˜µï¼Œé‡‡ç”¨é‚»æ¥è¡¨çš„æ–¹æ³•å­˜å‚¨å›¾ã€‚éƒ¨åˆ†ç«™ç‚¹å¯èƒ½æ˜¯æ¢ä¹˜ç«™ï¼Œä¸ºå‡å°‘æ¢ä¹˜ç«™å¸¦æ¥çš„å¯èƒ½é—®é¢˜ï¼Œæ­¤å¤„é€‰æ‹©ç»™åŒåç«™ç‚¹åç§°åæ·»åŠ å­—ç¬¦åŠ ä»¥åŒºåˆ«ï¼Œä¾‹å¦‚â€œä¸‡èƒœå›´â€åœ¨4å·çº¿å‡ºç°ä¸€æ¬¡ï¼Œé‚£ä¹ˆåœ¨8å·çº¿å‡ºç°çš„å­˜å‚¨ä¸ºâ€œä¸‡èƒœå›´0â€ä»¥æ­¤ç±»æ¨ã€‚ä½†æ˜¯åœ¨è¿™æ ·çš„å¤„ç†æ–¹æ³•ä¼šå¯¼è‡´å„æ¡çº¿è·¯ä¹‹é—´ä¸è¿é€šï¼Œå’ŒçœŸå®çš„åœ°é“çº¿è·¯ä¸ç¬¦åˆï¼Œæ‰€ä»¥åœ¨æ¢ä¹˜ç«™ä¹‹é—´æ·»åŠ ä¸€æ¡è¾¹æƒä¸º0çš„è¾¹è¿é€šã€‚</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">-1 ä¸‡èƒœå›´ ä¸‡èƒœå›´0 0<br></code></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦åšä¸‰ä»¶äº‹æƒ…ï¼Œä¸€ä¸ªæ˜¯ç»™æ¯ä¸€ä¸ªç«™ç‚¹èµ‹äºˆä¸€ä¸ªç‹¬ç‰¹çš„idï¼Œç”¨äºç¨‹åºè®¡ç®—ï¼›äºŒæ˜¯å»ºç«‹ä¸€ä¸ªidåˆ°æ–‡æœ¬çš„æ˜ å°„ï¼Œæ–¹ä¾¿æ–‡æœ¬è¾“å‡ºçº¿è·¯ï¼›ä¸‰æ˜¯å»ºç«‹ä¸€ä¸ªæ–‡æœ¬åˆ°idçš„æ˜ å°„ï¼Œæ–¹ä¾¿å°†æ”¶åˆ°çš„å‡ºå‘ç«™å’Œç»ˆç‚¹ç«™è½¬æ¢ä¸ºå†…ç½®idã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c++"> <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">subway_system::readData</span><span class="hljs-params">(vector&lt;edge&gt; &amp;edges)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-comment">// string a;</span><br><span class="hljs-comment">// cin &gt;&gt; a;</span><br><span class="hljs-function">ifstream <span class="hljs-title">fin</span><span class="hljs-params">(<span class="hljs-string">&quot;srcdata&quot;</span>)</span></span>;<br><span class="hljs-type">int</span> distance, ID[<span class="hljs-number">2</span>];<br>string line, station[<span class="hljs-number">2</span>];<br><br><span class="hljs-keyword">while</span> (fin &gt;&gt; line &gt;&gt; station[<span class="hljs-number">0</span>] &gt;&gt; station[<span class="hljs-number">1</span>] &gt;&gt; distance)<br>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++)<br>&#123;<br><span class="hljs-keyword">auto</span> findStation = Stations.<span class="hljs-built_in">find</span>(station[i]);<br><span class="hljs-comment">//æŸ¥æ‰¾ä¸åˆ°è¿™ä¸ªç«™ç‚¹</span><br><span class="hljs-keyword">if</span> (findStation == Stations.<span class="hljs-built_in">end</span>())<br>&#123;<br>ID[i] = Stations.<span class="hljs-built_in">size</span>();<br>Stations[station[i]] = <span class="hljs-built_in">pair</span>&lt;string, <span class="hljs-type">int</span>&gt;(line, ID[i]);<br>station_name.<span class="hljs-built_in">push_back</span>(station[i]);<br>&#125;<br><span class="hljs-comment">//è¯¥ç«™ç‚¹åœ¨æœ¬çº¿è·¯ä¸Šå·²ç»å‡ºç°</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((*findStation).second.first == line)<br>ID[i] = Stations[station[i]].second;<br><span class="hljs-comment">//è¿™æ˜¯ä¸€ä¸ªæ¢ä¹˜ç«™ç‚¹</span><br><span class="hljs-keyword">else</span><br>&#123;<br>string it_name = station[i];<br><span class="hljs-type">char</span> c = <span class="hljs-string">&#x27;1&#x27;</span>;<br>station[i] += c;<br><span class="hljs-keyword">auto</span> it = Stations.<span class="hljs-built_in">find</span>(station[i]);<br><span class="hljs-keyword">while</span> (it != Stations.<span class="hljs-built_in">end</span>() &amp;&amp; (*it).second.first != line)<br>&#123;<br>station[i].<span class="hljs-built_in">back</span>() = ++c;<br>it = Stations.<span class="hljs-built_in">find</span>(station[i]);<br>&#125;<br><span class="hljs-keyword">if</span> (it == Stations.<span class="hljs-built_in">end</span>())<br>&#123;<br>ID[i] = Stations.<span class="hljs-built_in">size</span>();<br>Stations[station[i]] = <span class="hljs-built_in">pair</span>&lt;string, <span class="hljs-type">int</span>&gt;(line, ID[i]);<br>station_name.<span class="hljs-built_in">push_back</span>(station[i]);<br>&#125;<br><span class="hljs-keyword">else</span><br>ID[i] = Stations[station[i]].second;<br>edges.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">edge</span>(ID[i], Stations[it_name].second, <span class="hljs-number">0</span>));<span class="hljs-comment">//å¢åŠ è¾¹æƒä¸º0çš„è¾¹</span><br>&#125;<br>&#125;<br><br>edges.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">edge</span>(ID[<span class="hljs-number">0</span>], ID[<span class="hljs-number">1</span>], distance));<br>&#125;<br>n = edges.<span class="hljs-built_in">size</span>() + <span class="hljs-number">1</span>;<br>fin.<span class="hljs-built_in">close</span>();<br><span class="hljs-comment">//cout &lt;&lt; Stations.size() &lt;&lt; endl;</span><br><span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€èŠ‚ç‚¹å­˜å‚¨"><a href="#2ã€èŠ‚ç‚¹å­˜å‚¨" class="headerlink" title="2ã€èŠ‚ç‚¹å­˜å‚¨"></a>2ã€èŠ‚ç‚¹å­˜å‚¨</h3><p>åœ°é“ç«™ç‚¹ä¸Šæ˜¯ä¼šæœ‰éå¸¸å¤šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´å®ƒåœ¨æœ¬ç¨‹åºä¸­çš„idï¼Œæ–¹ä¾¿Dijkstraç®—æ³•å¿…é¡»çš„disæ•°æ®ï¼Œboolç±»å‹çš„knownï¼Œå› æ­¤ç»“æ„åŒ–ä¸ºä¸€ä¸ªæ•°æ®ä½“</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">vertex</span><br>&#123;<br><span class="hljs-type">size_t</span> dis;<span class="hljs-comment">//æœ€çŸ­è·¯å¾„ç®—æ³•ä½¿ç”¨</span><br><span class="hljs-type">int</span> id;<span class="hljs-comment">//åœ¨ç¨‹åºä¸­çš„id</span><br><span class="hljs-type">int</span> path;<span class="hljs-comment">//çˆ¶èŠ‚ç‚¹ï¼Œè¾“å‡ºä»æ¢ä¹˜çº¿è·¯ä½¿ç”¨</span><br><span class="hljs-type">bool</span> known;<span class="hljs-comment">//æ ‡è®°æ˜¯å¦å·²ç»è¢«æœç´¢åˆ°</span><br><span class="hljs-type">bool</span> popped;<span class="hljs-comment">//è¾“å‡ºçº¿è·¯ä½¿ç”¨</span><br><span class="hljs-built_in">vertex</span>() : <span class="hljs-built_in">dis</span>(inf), <span class="hljs-built_in">known</span>(<span class="hljs-literal">false</span>), <span class="hljs-built_in">popped</span>(<span class="hljs-literal">false</span>) &#123;&#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="3ã€Dijkstraç®—æ³•"><a href="#3ã€Dijkstraç®—æ³•" class="headerlink" title="3ã€Dijkstraç®—æ³•"></a>3ã€Dijkstraç®—æ³•</h3><p>æ ‡å‡†çš„Dijkstraç®—æ³•ã€‚å‡½æ•°éœ€è¦è¾“å‡ºæœ€çŸ­è·¯å¾„ï¼Œæ‰€ä»¥è¿”å›ä¸€ä¸ªè®°å½•æœ€çŸ­è·¯å¾„èµ°æ³•çš„vectoræ•°ç»„ï¼Œè®°å½•ä»ç›®çš„åœ°å‰å¾€å§‹å‘ç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚åœ¨è¾“å‡ºçº¿è·¯ä¹‹å‰éœ€è¦è€ƒè™‘ä¸€ä¸ªé¡ºåºçš„é—®é¢˜ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">subway_system::getShortestPath</span><span class="hljs-params">(<span class="hljs-type">int</span> origin, <span class="hljs-type">int</span> destination)</span></span><br><span class="hljs-function"></span>&#123;<br>vector&lt;<span class="hljs-type">int</span>&gt; res;<br>set&lt;<span class="hljs-type">int</span>&gt; known;<br><span class="hljs-comment">//initialize</span><br>vector&lt;vertex&gt; nodes;<br>nodes.<span class="hljs-built_in">resize</span>(n);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; nodes.<span class="hljs-built_in">size</span>(); i++)<br>&#123;<br>nodes[i].id = i;<br>nodes[i].path = i;<br>nodes[i].popped = <span class="hljs-literal">false</span>;<br>&#125;<br>nodes[origin].dis = <span class="hljs-number">0</span>;<br>nodes[origin].known = <span class="hljs-literal">true</span>;<br>nodes[origin].path = origin;<br>known.<span class="hljs-built_in">insert</span>(origin);<br><span class="hljs-comment">//calculating</span><br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>&#123;<br><span class="hljs-type">int</span> index = <span class="hljs-number">0</span>, min_dis = inf;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> &amp;entry : known)<br><span class="hljs-keyword">if</span> (!(nodes[entry].popped) &amp;&amp; nodes[entry].dis &lt; min_dis)<br>&#123;<br>min_dis = nodes[entry].dis;<br>index = entry;<br>&#125;<br><span class="hljs-keyword">if</span> (index == destination)<br><span class="hljs-keyword">break</span>;<br><br><span class="hljs-comment">//cout &lt;&lt; station_name[index] &lt;&lt; &quot; &quot;;</span><br><br>nodes[index].popped = <span class="hljs-literal">true</span>;<br>vertex u = nodes[index];<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> &amp;entry : E[u.id])<br>&#123;<br><span class="hljs-keyword">if</span> (!nodes[entry.first].known)<br>&#123;<br><span class="hljs-keyword">if</span> (nodes[entry.first].dis &gt; nodes[u.id].dis + entry.second)<br>&#123;<br>nodes[entry.first].known = <span class="hljs-literal">true</span>;<br>known.<span class="hljs-built_in">insert</span>(entry.first);<br>nodes[entry.first].dis = nodes[u.id].dis + entry.second;<br>nodes[entry.first].path = u.id;<br>&#125;<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">if</span> (nodes[destination].known == <span class="hljs-literal">false</span>)<br>&#123;<br><span class="hljs-keyword">return</span> res;<br>&#125;<br><span class="hljs-comment">//get path</span><br>stack&lt;<span class="hljs-type">int</span>&gt; temp;<br><span class="hljs-type">int</span> cur = destination;<br>temp.<span class="hljs-built_in">push</span>(cur);<br><span class="hljs-keyword">while</span> (nodes[cur].path != origin)<br>&#123;<br>cur = nodes[cur].path;<br>temp.<span class="hljs-built_in">push</span>(cur);<br>&#125;<br>temp.<span class="hljs-built_in">push</span>(origin);<br><span class="hljs-keyword">while</span> (!temp.<span class="hljs-built_in">empty</span>())<br>&#123;<br>res.<span class="hljs-built_in">push_back</span>(temp.<span class="hljs-built_in">top</span>());<br>temp.<span class="hljs-built_in">pop</span>();<br>&#125;<br><span class="hljs-keyword">return</span> res;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4ã€è¾“å‡ºç»“æœ"><a href="#4ã€è¾“å‡ºç»“æœ" class="headerlink" title="4ã€è¾“å‡ºç»“æœ"></a>4ã€è¾“å‡ºç»“æœ</h3><p>åœ¨ä¸Šä¸€ä¸ªå‡½æ•°è·å¾—äº†æœ€çŸ­è·¯å¾„çš„idã€‚ä½†æ˜¯idå¹¶ä¸å¯¹åº”ç«™ç‚¹åï¼Œå› æ­¤è¿˜éœ€è¦ä¸€ä¸ªè¾“å‡ºå‡½æ•°ï¼Œå°†ä¸€ä¸²æ•°ç»„è½¬æ¢ä¸ºäººå¯ä»¥çœ‹å¾—æ‡‚çš„ç«™ç‚¹åç§°ï¼Œå¹¶ä¸”è¿˜éœ€è¦è¾“å‡ºæ¢ä¹˜ä¿¡æ¯ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function">string <span class="hljs-title">subway_system::checkLine</span><span class="hljs-params">(string oringin, string destination)</span></span><br><span class="hljs-function"></span>&#123;<br>vector&lt;<span class="hljs-type">int</span>&gt; result;<br>vector&lt;string&gt; output;<br>vector&lt;pair&lt;string,string&gt;&gt; transform;<br><span class="hljs-type">int</span> ori = <span class="hljs-keyword">this</span>-&gt;Stations[oringin].second;<br><span class="hljs-type">int</span> dest = <span class="hljs-keyword">this</span>-&gt;Stations[destination].second;<br>result = <span class="hljs-built_in">getShortestPath</span>(ori, dest);<br><span class="hljs-keyword">if</span> (result.<span class="hljs-built_in">size</span>() == <span class="hljs-number">0</span>)<br>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;ä¸å­˜åœ¨è¿™æ ·ä¸€æ¡é“è·¯&quot;</span> &lt;&lt; endl;<br>string a;<br><span class="hljs-keyword">return</span> a;<br>&#125;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; result.<span class="hljs-built_in">size</span>(); i++)<br>&#123;<br>output.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">del_num</span>(station_name[result[i]]));<br><br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">2</span>; i &lt; result.<span class="hljs-built_in">size</span>();i++)&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">del_num</span>(station_name[result[i]]) == <span class="hljs-built_in">del_num</span>(station_name[result[i - <span class="hljs-number">1</span>]]) &amp;&amp; i &gt; <span class="hljs-number">1</span>)<br>&#123;<br><span class="hljs-function">pair&lt;string, string&gt; <span class="hljs-title">temp</span><span class="hljs-params">(Stations[station_name[result[i]]].first, Stations[station_name[result[i - <span class="hljs-number">1</span>]]].first)</span></span>;<br>transform.<span class="hljs-built_in">push_back</span>(temp);<br>&#125;<br>&#125;<br>cout &lt;&lt; output[<span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-string">&quot;-&gt;&quot;</span>;<br><span class="hljs-type">int</span> j = <span class="hljs-number">0</span>;<br>string all_in_one;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; output.<span class="hljs-built_in">size</span>(); i++)<br>&#123;<br><span class="hljs-keyword">if</span> (i == output.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>)<br>&#123;<br>all_in_one.<span class="hljs-built_in">append</span>( output[i]);<br>all_in_one.<span class="hljs-built_in">append</span>(<span class="hljs-string">&quot;\n&quot;</span>);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (output[i] != output[i - <span class="hljs-number">1</span>])<br>&#123;<br>all_in_one.<span class="hljs-built_in">append</span>(output[i]);<br>all_in_one.<span class="hljs-built_in">append</span>(<span class="hljs-string">&quot;-&gt;&quot;</span>);<br><br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>all_in_one.<span class="hljs-built_in">append</span>(<span class="hljs-string">&quot;ä»&quot;</span>);<br>all_in_one.<span class="hljs-built_in">append</span>(transform[j].second);<br>all_in_one.<span class="hljs-built_in">append</span>(<span class="hljs-string">&quot;å·çº¿è½¬åˆ°&quot;</span>);<br>all_in_one.<span class="hljs-built_in">append</span>(transform[j++].first);<br>all_in_one.<span class="hljs-built_in">append</span>(<span class="hljs-string">&quot;å·çº¿\n&quot;</span>);<br><br>&#125;<br>&#125;<br>cout &lt;&lt; all_in_one;<br><br>std::<span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br><span class="hljs-keyword">return</span> all_in_one;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5ã€å»ºå›¾çš„æ•°æ®ç»“æ„"><a href="#5ã€å»ºå›¾çš„æ•°æ®ç»“æ„" class="headerlink" title="5ã€å»ºå›¾çš„æ•°æ®ç»“æ„"></a>5ã€å»ºå›¾çš„æ•°æ®ç»“æ„</h3><p>ä¸Šé¢æ‰€è°“çš„å»ºå›¾ï¼Œå…¶å®åªæ˜¯å®Œæˆäº†è¾¹çš„è¯»å…¥ï¼Œå¹¶æ²¡æœ‰å»ºç«‹ä¸€ä¸ªé‚»æ¥è¡¨ï¼Œè¿™æ®µå‡½æ•°çš„ç›®çš„å°±æ˜¯ä»è¾¹å»ºç«‹ä¸€ä¸ªå¯ä»¥è¢«æœ€çŸ­è·¯å¾„ç®—æ³•ä½¿ç”¨çš„é‚»æ¥è¡¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">edge</span><span class="hljs-comment">//è¾¹çš„æ•°æ®ç»“æ„</span><br>&#123;<br><span class="hljs-type">int</span> u, v, w;<br><span class="hljs-built_in">edge</span>(<span class="hljs-type">int</span> U, <span class="hljs-type">int</span> V, <span class="hljs-type">int</span> W = inf) :<span class="hljs-built_in">u</span>(U), <span class="hljs-built_in">v</span>(V), <span class="hljs-built_in">w</span>(W) &#123;  &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">subway_system::makeGraph</span><span class="hljs-params">(vector&lt;edge&gt; &amp;edges)</span></span><br><span class="hljs-function"></span>&#123;<br>list&lt;pair&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt;&gt; tmp;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = Stations.<span class="hljs-built_in">size</span>(); i--;)<span class="hljs-comment">//å‡ æ¡çº¿è·¯</span><br>E.<span class="hljs-built_in">push_back</span>(tmp);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> &amp;item : edges)<br>&#123;<br>E[item.u].<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">pair</span>&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt;(item.v, item.w));<br>E[item.v].<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">pair</span>&lt;<span class="hljs-type">int</span>, <span class="hljs-type">int</span>&gt;(item.u, item.w));<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å››ã€æ³¨æ„äº‹é¡¹"><a href="#å››ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="å››ã€æ³¨æ„äº‹é¡¹"></a>å››ã€æ³¨æ„äº‹é¡¹</h2><p>ä¹Ÿå°±æ˜¯å°½é‡ä¸è¦åœ¨windowçš„ç»ˆç«¯ä¸Šè¿è¡Œï¼Œæˆ–è€…åœ¨ç¼–è¯‘ä¹‹å‰å°†<a href="https://github.com/peach-water/guangzhou_subway">æºä»£ç </a>è½¬æ¢ä¸ºGBKç¼–ç ï¼Œä¸ç„¶ç»ˆç«¯çœ‹è§çš„åªæœ‰ä¸€ç‰‡ä¹±ç ã€‚</p><h2 id="äº”ã€é¸£è°¢"><a href="#äº”ã€é¸£è°¢" class="headerlink" title="äº”ã€é¸£è°¢"></a>äº”ã€é¸£è°¢</h2><p>æœ¬ä»£ç ä¸»è¦æ¥è‡ªgithubä¸Šæ˜ŠCå’Œä»–çš„èˆå‹å¤§ä½¬ã€‚æœ€åˆçš„ç‰ˆæœ¬å› ä¸ºæœ‰ä¸€ç‚¹ç‚¹å°é—®é¢˜ï¼Œæ²¡æœ‰è§£å†³0æƒå€¼è¾¹çš„é—®é¢˜ï¼Œå¯¼è‡´åœ¨æµ‹è¯•çš„æ—¶å€™ç»å¸¸å´©ï¼ˆåæ¥æŸ¥å®æ˜¯å› ä¸ºä¸€ç›´å‹æ ˆæœ€åçˆ†å†…å­˜äº†ï¼‰ã€‚ä»”ç»†æ’æŸ¥æ‰æœ€åå‘ç°ï¼ŒåŸæ¥æ˜¯å»ºå›¾çš„æ—¶å€™ï¼Œæ²¡æœ‰ç»™æ¢ä¹˜ç«™ä¸€ä¸ªä»–ä»¬ä¹‹é—´è¿çº¿ï¼Œå¯¼è‡´åœ¨è¾“å‡ºçš„æ—¶å€™ä¸€ç›´å‹æ ˆï¼Œå› ä¸ºæ²¡æœ‰åˆ°è¾¾ç›®çš„åœ°ã€‚</p><p>å¦‚æœä¹Ÿæœ‰ç±»ä¼¼å¤§ä½œä¸šçš„éœ€æ±‚ï¼Œå¸Œæœ›è¿™ä»½ä»£ç èƒ½å¸®åˆ°ä½ ã€‚</p>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ </tag>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>[å­¦ä¹ ]huffmanå‹ç¼©</title>
    <link href="/2020/11/01/%E5%AD%A6%E4%B9%A0-huffman/"/>
    <url>/2020/11/01/%E5%AD%A6%E4%B9%A0-huffman/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆè¯†Huffman"><a href="#åˆè¯†Huffman" class="headerlink" title="åˆè¯†Huffman"></a>åˆè¯†Huffman</h2><p>ç®€å•è¯´æ˜Huffmanç¼–ç çš„åŸç†<br>ã€€ã€€å®ç°éœå¤«æ›¼ç¼–ç çš„æ–¹å¼ä¸»è¦æ˜¯åˆ›å»ºä¸€ä¸ªäºŒå‰æ ‘å’Œå…¶èŠ‚ç‚¹ã€‚è¿™äº›æ ‘çš„èŠ‚ç‚¹å¯ä»¥å­˜å‚¨åœ¨æ•°ç»„é‡Œï¼Œæ•°ç»„çš„å¤§å°ä¸ºç¬¦å·ï¼ˆsymbolsï¼‰æ•°çš„å¤§å°nï¼Œè€ŒèŠ‚ç‚¹åˆ†åˆ«æ˜¯ç»ˆç«¯èŠ‚ç‚¹ï¼ˆå¶èŠ‚ç‚¹ï¼‰ä¸éç»ˆç«¯èŠ‚ç‚¹ï¼ˆå†…éƒ¨èŠ‚ç‚¹ï¼‰ã€‚</p><p>ã€€ã€€ä¸€å¼€å§‹ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯ç»ˆç«¯èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å†…æœ‰ä¸‰ä¸ªå­—æ®µï¼š</p><p>ã€€ã€€1.ç¬¦å·ï¼ˆSymbolï¼‰</p><p>ã€€ã€€2.æƒé‡ï¼ˆWeightã€Probabilitiesã€Frequencyï¼‰</p><p>ã€€ã€€3.æŒ‡å‘çˆ¶èŠ‚ç‚¹çš„é“¾æ¥ï¼ˆLink to its parent nodeï¼‰</p><p>ã€€ã€€è€Œéç»ˆç«¯èŠ‚ç‚¹å†…æœ‰å››ä¸ªå­—æ®µï¼š</p><p>ã€€ã€€1.æƒé‡ï¼ˆWeightã€Probabilitiesã€Frequencyï¼‰</p><p>ã€€ã€€2.æŒ‡å‘ä¸¤ä¸ªå­èŠ‚ç‚¹çš„ é“¾æ¥ï¼ˆLinks to two child nodeï¼‰</p><p>ã€€ã€€3.æŒ‡å‘çˆ¶èŠ‚ç‚¹çš„é“¾æ¥ï¼ˆLink to its parent nodeï¼‰</p><p>ã€€ã€€åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬ç”¨â€™0â€™ä¸â€™1â€™åˆ†åˆ«ä»£è¡¨æŒ‡å‘å·¦å­èŠ‚ç‚¹ä¸å³å­èŠ‚ç‚¹ï¼Œæœ€åä¸ºå®Œæˆçš„äºŒå‰æ ‘å…±æœ‰nä¸ªç»ˆç«¯èŠ‚ç‚¹ä¸n-1ä¸ªéç»ˆç«¯èŠ‚ç‚¹ï¼Œå»é™¤äº†ä¸å¿…è¦çš„ç¬¦å·å¹¶äº§ç”Ÿæœ€ä½³çš„ç¼–ç é•¿åº¦ã€‚</p><p>ã€€ã€€è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç»ˆç«¯èŠ‚ç‚¹éƒ½åŒ…å«ç€ä¸€ä¸ªæƒé‡ï¼ˆWeightã€Probabilitiesã€Frequencyï¼‰ï¼Œä¸¤ä¸¤ç»ˆç«¯èŠ‚ç‚¹ç»“åˆä¼šäº§ç”Ÿä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œæ–°èŠ‚ç‚¹çš„æƒé‡æ˜¯ç”±ä¸¤ä¸ªæƒé‡æœ€å°çš„ç»ˆç«¯èŠ‚ç‚¹æƒé‡ä¹‹æ€»å’Œï¼Œå¹¶æŒç»­è¿›è¡Œæ­¤è¿‡ç¨‹ç›´åˆ°åªå‰©ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºæ­¢ã€‚</p><p>ã€€ã€€å®ç°éœå¤«æ›¼æ ‘çš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œå¯ä»¥ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriority Queueï¼‰ç®€å•è¾¾æˆè¿™ä¸ªè¿‡ç¨‹ï¼Œç»™ä¸æƒé‡è¾ƒä½çš„ç¬¦å·è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼ˆPriorityï¼‰ï¼Œç®—æ³•å¦‚ä¸‹ï¼š</p><p>ã€€ã€€â’ˆæŠŠnä¸ªç»ˆç«¯èŠ‚ç‚¹åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—ï¼Œåˆ™nä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆæƒPiï¼Œ1 â‰¤ i â‰¤ n</p><p>ã€€ã€€â’‰å¦‚æœé˜Ÿåˆ—å†…çš„èŠ‚ç‚¹æ•°&gt;1ï¼Œåˆ™ï¼š</p><p>ã€€ã€€ã€€â‘´ä»é˜Ÿåˆ—ä¸­ç§»é™¤ä¸¤ä¸ªæœ€å°çš„PièŠ‚ç‚¹ï¼Œå³è¿ç»­åšä¸¤æ¬¡removeï¼ˆminï¼ˆPiï¼‰, Priority_Queue)<br>ã€€ã€€ã€€â‘µäº§ç”Ÿä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œæ­¤èŠ‚ç‚¹ä¸ºï¼ˆ1ï¼‰ä¹‹ç§»é™¤èŠ‚ç‚¹ä¹‹çˆ¶èŠ‚ç‚¹ï¼Œè€Œæ­¤èŠ‚ç‚¹çš„æƒé‡å€¼ä¸ºï¼ˆ1ï¼‰ä¸¤èŠ‚ç‚¹ä¹‹æƒé‡å’Œ<br>ã€€ã€€ã€€â‘¶æŠŠï¼ˆ2ï¼‰äº§ç”Ÿä¹‹èŠ‚ç‚¹åŠ å…¥ä¼˜å…ˆé˜Ÿåˆ—ä¸­<br>ã€€ã€€â’Šæœ€ååœ¨ä¼˜å…ˆé˜Ÿåˆ—é‡Œçš„ç‚¹ä¸ºæ ‘çš„æ ¹èŠ‚ç‚¹ï¼ˆrootï¼‰<br>ã€€ã€€<br>ã€€ã€€è€Œæ­¤ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ï¼ˆ Time Complexityï¼‰ä¸ºOï¼ˆn log nï¼‰ï¼›å› ä¸ºæœ‰nä¸ªç»ˆç«¯èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ ‘æ€»å…±æœ‰2n-1ä¸ªèŠ‚ç‚¹ï¼Œä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—æ¯ä¸ªå¾ªç¯é¡»Oï¼ˆlog nï¼‰ã€‚</p><p>ã€€ã€€æ­¤å¤–ï¼Œæœ‰ä¸€ä¸ªæ›´å¿«çš„æ–¹å¼ä½¿æ—¶é—´å¤æ‚åº¦é™è‡³çº¿æ€§æ—¶é—´ï¼ˆLinear Timeï¼‰Oï¼ˆnï¼‰ï¼Œå°±æ˜¯ä½¿ç”¨ä¸¤ä¸ªé˜Ÿåˆ—ï¼ˆQueueï¼‰åˆ›ä»¶éœå¤«æ›¼æ ‘ã€‚ç¬¬ä¸€ä¸ªé˜Ÿåˆ—ç”¨æ¥å­˜å‚¨nä¸ªç¬¦å·ï¼ˆå³nä¸ªç»ˆç«¯èŠ‚ç‚¹ï¼‰çš„æƒé‡ï¼Œç¬¬äºŒä¸ªé˜Ÿåˆ—ç”¨æ¥å­˜å‚¨ä¸¤ä¸¤æƒé‡çš„åˆï¼ˆå³éç»ˆç«¯èŠ‚ç‚¹ï¼‰ã€‚æ­¤æ³•å¯ä¿è¯ç¬¬äºŒä¸ªé˜Ÿåˆ—çš„å‰ç«¯ï¼ˆFrontï¼‰æƒé‡æ°¸è¿œéƒ½æ˜¯æœ€å°å€¼ï¼Œä¸”æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>ã€€ã€€â’ˆæŠŠnä¸ªç»ˆç«¯èŠ‚ç‚¹åŠ å…¥ç¬¬ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆä¾ç…§æƒé‡å¤§å°æ’åˆ—ï¼Œæœ€å°åœ¨å‰ç«¯ï¼‰<br>ã€€<br>ã€€ã€€â’‰å¦‚æœé˜Ÿåˆ—å†…çš„èŠ‚ç‚¹æ•°&gt;1ï¼Œåˆ™ï¼š</p><p>ã€€ã€€ã€€â‘´ä»é˜Ÿåˆ—å‰ç«¯ç§»é™¤ä¸¤ä¸ªæœ€ä½æƒé‡çš„èŠ‚ç‚¹<br>ã€€ã€€ã€€â‘µå°†ï¼ˆ1ï¼‰ä¸­ç§»é™¤çš„ä¸¤ä¸ªèŠ‚ç‚¹æƒé‡ç›¸åŠ åˆæˆä¸€ä¸ªæ–°èŠ‚ç‚¹<br>ã€€ã€€ã€€â‘¶åŠ å…¥ç¬¬äºŒä¸ªé˜Ÿåˆ—<br>ã€€ã€€â’Šæœ€ååœ¨ç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹</p><p>ã€€ã€€è™½ç„¶ä½¿ç”¨æ­¤æ–¹æ³•æ¯”ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—çš„æ—¶é—´å¤æ‚åº¦è¿˜ä½ï¼Œä½†æ˜¯æ³¨æ„æ­¤æ³•çš„ç¬¬1é¡¹ï¼ŒèŠ‚ç‚¹å¿…é¡»ä¾ç…§æƒé‡å¤§å°åŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœèŠ‚ç‚¹åŠ å…¥é¡ºåºä¸æŒ‰å¤§å°ï¼Œåˆ™éœ€è¦ç»è¿‡æ’åºï¼Œåˆ™è‡³å°‘èŠ±äº†Oï¼ˆn log nï¼‰çš„æ—¶é—´å¤æ‚åº¦è®¡ç®—ã€‚</p><p>ã€€ã€€ä½†æ˜¯åœ¨ä¸åŒçš„çŠ¶å†µè€ƒé‡ä¸‹ï¼Œæ—¶é—´å¤æ‚åº¦å¹¶éæ˜¯æœ€é‡è¦çš„ï¼Œå¦‚æœæˆ‘ä»¬ä»Šå¤©è€ƒè™‘è‹±æ–‡å­—æ¯çš„å‡ºç°é¢‘ç‡ï¼Œå˜é‡nå°±æ˜¯è‹±æ–‡å­—æ¯çš„26ä¸ªå­—æ¯ï¼Œåˆ™ä½¿ç”¨å“ªä¸€ç§ç®—æ³•æ—¶é—´å¤æ‚åº¦éƒ½ä¸ä¼šå½±å“å¾ˆå¤§ï¼Œå› ä¸ºnä¸æ˜¯ä¸€ä¸ªåºå¤§çš„æ•°å­—ã€‚</p><h2 id="å®ç°æ–¹æ³•"><a href="#å®ç°æ–¹æ³•" class="headerlink" title="å®ç°æ–¹æ³•"></a>å®ç°æ–¹æ³•</h2><p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå…·ä½“ä»£ç ï¼Œè¿™é‡Œä»…å±•ç°éƒ¨åˆ†æ ¸å¿ƒä»£ç ã€‚</p><h3 id="HuffmanèŠ‚ç‚¹çš„å®šä¹‰"><a href="#HuffmanèŠ‚ç‚¹çš„å®šä¹‰" class="headerlink" title="HuffmanèŠ‚ç‚¹çš„å®šä¹‰"></a>HuffmanèŠ‚ç‚¹çš„å®šä¹‰</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Hufnode</span>&#123;<br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Hufnode</span> *lc;<span class="hljs-comment">//å·¦å³å­æ ‘</span><br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Hufnode</span> *rc;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> pow;<span class="hljs-comment">//å½“å‰èŠ‚ç‚¹çš„æƒé‡</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> Data;<span class="hljs-comment">//è¿™ä¸ªèŠ‚ç‚¹å¦‚æœæ˜¯å¶å­ç»“ç‚¹ï¼Œé‚£ä¹ˆå­˜å‚¨ç¼–ç å¯¹åº”çš„å­—ç¬¦</span><br>    <span class="hljs-type">bool</span> leaf;<span class="hljs-comment">//æ ‡è®°æ˜¯å¦æ˜¯å­—ç¬¦</span><br>    string code;<span class="hljs-comment">//å­˜å‚¨å¯¹åº”çš„Huffmanç¼–ç </span><br>    <span class="hljs-built_in">Hufnode</span>() : <span class="hljs-built_in">lc</span>(<span class="hljs-literal">NULL</span>), <span class="hljs-built_in">rc</span>(<span class="hljs-literal">NULL</span>), <span class="hljs-built_in">leaf</span>(<span class="hljs-literal">true</span>)&#123;&#125;<span class="hljs-comment">//åˆå§‹åŒ–èŠ‚ç‚¹</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Huffmanæ ‘çš„æ„å»º"><a href="#Huffmanæ ‘çš„æ„å»º" class="headerlink" title="Huffmanæ ‘çš„æ„å»º"></a>Huffmanæ ‘çš„æ„å»º</h3><p>æ ¹æ®å¼€å¤´ä»‹ç»çš„ä¸¤ç§æ–¹æ³•ï¼Œå„æœ‰åƒç§‹ï¼Œå…¶ä¸­æˆ‘ä»¬ä½¿ç”¨æ¯”è¾ƒå®¹æ˜“ç†è§£çš„æ–¹æ³•ï¼Œæ­¤å¤„ä¸ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ç­‰ç­‰ä¼˜åŒ–æ€§çš„ç®—æ³•ï¼Œè½¬å‘ä½¿ç”¨å†’æ³¡æ’åºï¼Œå› ä¸ºæ’åºçš„å†…å®¹ä¸ç®—å¤šï¼Œè€Œä¸”åœ¨ç¬¬ä¸€æ¬¡æ’åºå®Œæˆä¹‹åä¸ä¼šæœ‰è¾ƒå¤šçš„æ’åºè¦æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹å†’æ³¡ä¼˜åŒ–åŠ å¿«é€Ÿåº¦ï¼ˆä½¿å…¶å˜æˆä¸€ä¸ªæ’å…¥ç®—æ³•ï¼‰ã€‚</p><p>æ­¤å¤„å»ºç«‹ä¸€ä¸ªclassç±»ï¼Œå®ç°Huffmanæ ‘çš„æ„å»ºå’Œç›¸å…³åŠŸèƒ½ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hufman</span>&#123;<br><span class="hljs-keyword">private</span>:<br>    Hufnode * root<span class="hljs-comment">//è®°å½•ä¸‹Huffmanæ ‘çš„æ ¹èŠ‚ç‚¹</span><br>        map&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>, string&gt; code_map<span class="hljs-comment">//ç”¨æ¥å¿«é€Ÿè®¿é—®å­—ç¬¦å¯¹åº”çš„Huffmanç¼–ç </span><br>    <span class="hljs-keyword">public</span>:<br>        <span class="hljs-built_in">Hufman</span>();<span class="hljs-comment">//æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–Huffmanæ ‘</span><br>        <span class="hljs-function">Hufnode *<span class="hljs-title">return_root</span><span class="hljs-params">()</span></span>;  <span class="hljs-comment">//è·å¾—å½“å‰Huffmanæ ‘çš„æ ¹èŠ‚ç‚¹</span><br>        <span class="hljs-function"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title">pow_len</span><span class="hljs-params">()</span></span>;    <span class="hljs-comment">//è¿”å›æ–‡ä»¶æ‹¥æœ‰çš„å­—ç¬¦æ•°é‡  </span><br>        <span class="hljs-function">string <span class="hljs-title">return_code</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> c)</span></span>;<span class="hljs-comment">//æ ¹æ®å­—ç¬¦è¿”å›å¯¹åº”çš„Huffmanç¼–ç   </span><br>        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">(Hufnode *root)</span></span>;    <span class="hljs-comment">//é€’å½’è°ƒç”¨ï¼Œè§£æ„å‡½æ•°</span><br>        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">build_huf</span><span class="hljs-params">(Hufnode data[], <span class="hljs-type">int</span> size)</span></span>;<span class="hljs-comment">//æ„å»ºHuffmanæ ‘ï¼Œè¾“å…¥çš„æ˜¯èŠ‚ç‚¹æ•°é‡å’ŒèŠ‚ç‚¹  </span><br>        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">update_code</span><span class="hljs-params">(Hufnode *root, string fa, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *c)</span></span>;<span class="hljs-comment">//æ ¹æ®å»ºç«‹çš„Huffmanæ ‘ï¼Œé€’å½’ç»™æ¯ä¸€ä¸ªå­—ç¬¦ç”ŸæˆHuffmanç¼–ç   </span><br>        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">bob_sort</span><span class="hljs-params">(Hufnode data[], <span class="hljs-type">int</span> size)</span></span>;<span class="hljs-comment">//ä¼˜åŒ–è¿‡çš„å†’æ³¡æ’åº  </span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å—å±•ç¤ºçš„æ˜¯ Huffmanç±»çš„å£°æ˜ï¼Œå£°æ˜çš„å‡½æ•°å…·ä½“çš„å®ç°è‡ªè¡Œå®Œæˆã€‚</p><h3 id="å‹ç¼©å‡½æ•°çš„å®ç°"><a href="#å‹ç¼©å‡½æ•°çš„å®ç°" class="headerlink" title="å‹ç¼©å‡½æ•°çš„å®ç°"></a>å‹ç¼©å‡½æ•°çš„å®ç°</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">zip</span><span class="hljs-params">(<span class="hljs-type">char</span> *input, <span class="hljs-type">char</span> *output)</span></span>&#123;<br>FILE *fp = <span class="hljs-literal">NULL</span>, *outfile = <span class="hljs-literal">NULL</span>;<span class="hljs-comment">//æ–‡ä»¶è¾“å…¥å’Œè¾“å‡º</span><br>    byte_fre array[<span class="hljs-number">256</span>];<span class="hljs-comment">//ç”¨äºŒè¿›åˆ¶æ–¹å¼è¯»å…¥æ–‡ä»¶ï¼Œå¯ä»¥å®ç°å¯¹æ‰€æœ‰æ ¼å¼æ–‡ä»¶å…¼å®¹ï¼Œå¼€256ä¸ªç©ºé—´æ˜¯å› ä¸ºåªæœ‰256ç§ä¸åŒçš„å­—èŠ‚ã€‚</span><br>    Hufnode *data;<span class="hljs-comment">//Huffmanå»ºæ ‘çš„ä¸´æ—¶ç¼“å†²åŒº</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> char_temp = <span class="hljs-number">0</span>;<span class="hljs-comment">//å­—èŠ‚æ“ä½œæ–‡ä»¶çš„ç¼“å†²åŒº</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> code_len = <span class="hljs-number">0</span>;<span class="hljs-comment">//è®°å½•æ–‡ä»¶é•¿åº¦</span><br>    data = <span class="hljs-keyword">new</span> Hufnode[<span class="hljs-number">256</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++)<br>        array[i].data = i;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> buffer[MAX_LINE]; <span class="hljs-comment">// MAX_LINE æ˜¯ä¸€ä¸ªå®å®šä¹‰ï¼Œä»£è¡¨ç¼“å†²åŒºçš„å¤§å°ï¼Œæ­¤å¤„ä¸º1024</span><br>    buffer[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢åˆå§‹åŒ–zipå‹ç¼©å‡½æ•°ï¼Œç„¶åå¼€å§‹è¯»å…¥æ–‡ä»¶ï¼Œæ±‚è§£ç»Ÿè®¡æ•´ä¸ªæ–‡ä»¶ä¸åŒå­—èŠ‚æƒå€¼ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">while</span> (!<span class="hljs-built_in">feof</span>(fp) &amp;&amp; <span class="hljs-built_in">fread</span>(buffer, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, fp))<br>&#123;<br>    <span class="hljs-type">int</span> a = buffer[<span class="hljs-number">0</span>];<br>    array[a].fre++;<span class="hljs-comment">//ç»Ÿè®¡ä¸åŒçš„å­—èŠ‚æƒå€¼</span><br>    buffer[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">int</span> len = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++) <span class="hljs-comment">//æœé›†æƒå€¼ç”¨æ¥æ„å»ºhafumanæ ‘ </span><br>&#123;<br>    <span class="hljs-keyword">if</span> (array[i].fre &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        data[len].pow = array[i].fre;<br>        data[len].leaf = <span class="hljs-literal">true</span>;<br>        data[len++].Data = array[i].data;<br>    &#125;<br>&#125;<br>Hufman CODE;<br>CODE.<span class="hljs-built_in">build_huf</span>(data, len); <span class="hljs-comment">//æ­¤å¤„è°ƒç”¨hufmanç±»é‡Œé¢çš„å»ºæ ‘</span><br><br>len = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++) <span class="hljs-comment">// ä¸ºäº†åœ¨å…ƒæ•°æ®å†™å…¥ä¸åŒå­—èŠ‚æƒé‡</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (array[i].fre &gt; <span class="hljs-number">0</span>)<br>    &#123;<br>        data[len].pow = array[i].fre;<br>        data[len].leaf = <span class="hljs-literal">true</span>;<br>        data[len++].Data = array[i].data;<br>    &#125;<br>&#125;<br><br>outfile = <span class="hljs-built_in">fopen</span>(output, <span class="hljs-string">&quot;wb+&quot;</span>);<br><span class="hljs-built_in">fwrite</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)&amp;len, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>), <span class="hljs-number">1</span>, outfile);<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; len; i++)<br>&#123;<br>    <span class="hljs-built_in">fwrite</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)&amp;data[i].Data, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>), <span class="hljs-number">1</span>, outfile);<br>    <span class="hljs-built_in">fwrite</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)&amp;data[i].pow, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>), <span class="hljs-number">1</span>, outfile);<br>&#125;<br><br><span class="hljs-type">char</span> code_buf[<span class="hljs-number">256</span>] = <span class="hljs-string">&quot;\0&quot;</span>; <span class="hljs-comment">// </span><br><br><span class="hljs-built_in">rewind</span>(fp);<br><span class="hljs-type">int</span> file_len = CODE.<span class="hljs-built_in">pow_len</span>();<br><span class="hljs-built_in">fwrite</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> *)&amp;file_len, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>), <span class="hljs-number">1</span>, outfile); <span class="hljs-comment">// è¯»å–æ–‡ä»¶çš„å¤§å°</span><br><span class="hljs-built_in">fread</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)&amp;char_temp, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>), <span class="hljs-number">1</span>, fp);      <span class="hljs-comment">// æŒ‰ç…§å­—èŠ‚è¯»å–8ä¸ªbit</span><br><span class="hljs-type">int</span> temp = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">while</span> (!<span class="hljs-built_in">feof</span>(fp))<br>&#123;<br><br>    <span class="hljs-built_in">strcat</span>(code_buf, CODE.<span class="hljs-built_in">return_code</span>(char_temp).<span class="hljs-built_in">data</span>());<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">strlen</span>(code_buf) &gt;= <span class="hljs-number">8</span>)<br>    &#123;<br>        char_temp = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; ++i)<br>        &#123;<br>            char_temp &lt;&lt;= <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">if</span> (code_buf[i] == <span class="hljs-string">&#x27;1&#x27;</span>)<br>            &#123;<br>                char_temp |= <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">fwrite</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)&amp;char_temp, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>), <span class="hljs-number">1</span>, outfile); <span class="hljs-comment">// è¾“å‡º</span><br>        <span class="hljs-built_in">strcpy</span>(code_buf, code_buf + <span class="hljs-number">8</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">feof</span>(fp))<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-built_in">fread</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)&amp;char_temp, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>), <span class="hljs-number">1</span>, fp); <span class="hljs-comment">// è¯»å…¥æ–‡ä»¶æ•°æ®</span><br>&#125;<br><br><span class="hljs-comment">// å¤„ç†æœ€åä¸è¶³8ä½çš„æƒ…å†µ</span><br>code_len = <span class="hljs-built_in">strlen</span>(code_buf);<br><span class="hljs-keyword">if</span> (code_len &gt; <span class="hljs-number">0</span>)<br>&#123;<br>    <span class="hljs-built_in">memset</span>(&amp;char_temp, <span class="hljs-number">0</span>, <span class="hljs-built_in">sizeof</span>(char_temp));<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; code_len; ++i)<br>    &#123;<br>        char_temp &lt;&lt;= <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">if</span> (code_buf[i] == <span class="hljs-string">&#x27;1&#x27;</span>)<br>            char_temp |= <span class="hljs-number">1</span>;<br>    &#125;<br>    char_temp &lt;&lt;= <span class="hljs-number">8</span> - code_len;                                            <span class="hljs-comment">// ç§»åŠ¨åˆ°é«˜ä½</span><br>    <span class="hljs-built_in">fwrite</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)&amp;char_temp, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>), <span class="hljs-number">1</span>, outfile); <span class="hljs-comment">// </span><br>&#125;<br><span class="hljs-built_in">fclose</span>(fp);<br><span class="hljs-built_in">fclose</span>(outfile); <br><span class="hljs-keyword">delete</span>[] data;<br></code></pre></td></tr></table></figure><h3 id="è§£å‹å‡½æ•°"><a href="#è§£å‹å‡½æ•°" class="headerlink" title="è§£å‹å‡½æ•°"></a>è§£å‹å‡½æ•°</h3><p>ä¸‹é¢æ˜¯éœ€è¦ä½¿ç”¨çš„ä¸´æ—¶å˜é‡ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">unzip</span><span class="hljs-params">(<span class="hljs-type">char</span> *input, <span class="hljs-type">char</span> *output)</span></span>&#123;<br>FILE *inputf=<span class="hljs-literal">NULL</span>, *outputf=<span class="hljs-literal">NULL</span>;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> len=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> file_len=<span class="hljs-number">0</span>;<span class="hljs-comment">//è¯»å…¥çš„æ–‡ä»¶å¤§å°</span><br>    Hufnode *root = <span class="hljs-literal">NULL</span>;<span class="hljs-comment">//ä¸´æ—¶æŒ‡é’ˆ</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> node_num=<span class="hljs-number">0</span>;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> code_temp = <span class="hljs-number">0</span>; <span class="hljs-comment">// ç¼“å†²åŒº</span><br>    byte_fre array[<span class="hljs-number">256</span>];<span class="hljs-comment">//ç»Ÿè®¡æƒé‡</span><br>    inputf = <span class="hljs-built_in">fopen</span>(input, <span class="hljs-string">&quot;rb&quot;</span>);<br>    outputf = <span class="hljs-built_in">fopen</span>(output, <span class="hljs-string">&quot;wb+&quot;</span>);<br><br></code></pre></td></tr></table></figure><p>ç„¶åæ˜¯æ­£å¼è¯»å–å‹ç¼©çš„æ–‡ä»¶å¼€å§‹è§£å‹ã€‚ï¼ˆä»£ç å¹¶æ²¡æœ‰éªŒè¯è§£å‹æ–‡ä»¶æ˜¯å¦æ˜¯ä¸Šè¿°å‹ç¼©ç®—æ³•ç”Ÿæˆçš„ï¼Œè€Œä¸”æ˜¯ä»¥å­—èŠ‚æµè¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ‰€ä»¥ä»»ä½•æ–‡ä»¶éƒ½å¯ä»¥è¢«è¿™ä¸ªå‡½æ•°è¯»å–å¹¶å°è¯•è§£å‹ï¼‰ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">if</span> (inputf == <span class="hljs-literal">NULL</span>)<br>        <span class="hljs-keyword">return</span>;<br>    <span class="hljs-built_in">fread</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)&amp;len, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>), <span class="hljs-number">1</span>, inputf);<span class="hljs-comment">//å…ˆè¯»å–å­—ç¬¦ç§ç±»</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i; i &lt; len; i++)<br>    &#123;<br>        <span class="hljs-built_in">fread</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)&amp;array[i].data, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>), <span class="hljs-number">1</span>, inputf);<br>        <span class="hljs-built_in">fread</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> *)&amp;array[i].fre, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>), <span class="hljs-number">1</span>, inputf);<br>    &#125;<br>    Hufnode data[<span class="hljs-number">256</span>];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) <span class="hljs-comment">//collecting data to build huffman tree </span><br>    &#123;<br>        <span class="hljs-keyword">if</span> (array[i].fre &gt; <span class="hljs-number">0</span>)<br>        &#123;<br>            data[i].pow = array[i].fre;<br>            data[i].leaf = <span class="hljs-literal">true</span>;<br>            data[i].Data = array[i].data;<br>        &#125;<br>    &#125;<br>    Hufman CODE;<br>    CODE.<span class="hljs-built_in">build_huf</span>(data, len);<span class="hljs-comment">//æ ¹æ®è¯»å…¥çš„å­—èŠ‚æƒé‡é‡å»ºhuffmanæ ‘</span><br><br>    <span class="hljs-built_in">fread</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)&amp;file_len, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>), <span class="hljs-number">1</span>, inputf); <span class="hljs-comment">//è¯»å–æ–‡ä»¶å¤§å°</span><br>    root = CODE.<span class="hljs-built_in">return_root</span>();<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> writen_len = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>    <span class="hljs-built_in">fread</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)&amp;code_temp, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>), <span class="hljs-number">1</span>, inputf); <span class="hljs-comment">//æ¯æ¬¡ä¸€ä¸ªå­—èŠ‚è¿›è¡Œè§£å‹</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; ++i)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (code_temp &amp; <span class="hljs-number">128</span>)<br>                root = root-&gt;rc;<br>            <span class="hljs-keyword">else</span><br>                root = root-&gt;lc;<br><br>            <span class="hljs-keyword">if</span> (root-&gt;leaf == <span class="hljs-literal">true</span>)<br>            &#123;<br>                <span class="hljs-built_in">fwrite</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)&amp;root-&gt;Data, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>), <span class="hljs-number">1</span>, outputf);<br>                ++writen_len;<br>                <span class="hljs-keyword">if</span> (writen_len &gt;= file_len)<br>                    <span class="hljs-keyword">break</span>;                 <span class="hljs-comment">// è·³å‡ºå¾ªç¯</span><br>                root = CODE.<span class="hljs-built_in">return_root</span>(); <span class="hljs-comment">// æ¢å¤</span><br>            &#125;<br>            code_temp &lt;&lt;= <span class="hljs-number">1</span>; <span class="hljs-comment">// switch next bit to the highest</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (writen_len &gt;= file_len)<br>            <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// æ–‡ä»¶å¤§å°æ£€æµ‹</span><br>    &#125;<br>    <span class="hljs-built_in">fread</span>((<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)&amp;code_temp, <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span>), <span class="hljs-number">1</span>, inputf);<br><br>    <span class="hljs-comment">// close the file</span><br>    <span class="hljs-built_in">fclose</span>(inputf);<br>    <span class="hljs-built_in">fclose</span>(outputf);<br></code></pre></td></tr></table></figure><h3 id="mainéƒ¨åˆ†"><a href="#mainéƒ¨åˆ†" class="headerlink" title="mainéƒ¨åˆ†"></a>mainéƒ¨åˆ†</h3><p>è¿™ä¸ªä¸œè¥¿å°±æ˜¯éœ€è¦æ ¹æ®å®é™…æƒ…å†µç¼–å†™ï¼Œæ­¤å¤„ä¸å†ç²˜è´´å®Œæ•´çš„ä»£ç ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">char</span> input[<span class="hljs-number">100</span>] = &#123;<span class="hljs-number">0</span>&#125;, output[<span class="hljs-number">100</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-type">int</span> opcode = <span class="hljs-number">-1</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>    &#123;<br>        <span class="hljs-built_in">welcome</span>();<br>        cin &gt;&gt; opcode;<br>        <span class="hljs-keyword">switch</span> (opcode)<span class="hljs-comment">//three cases</span><br>        &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<span class="hljs-comment">//zip</span><br>            cout &lt;&lt; <span class="hljs-string">&quot;Your file name of input&quot;</span> &lt;&lt; endl;<br>            cin &gt;&gt; input;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-built_in">file_name</span>(input) == <span class="hljs-literal">false</span>)<br>            &#123;<br>                cin &gt;&gt; input;<br>                <span class="hljs-keyword">if</span> (input[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;0&#x27;</span> &amp;&amp; input[<span class="hljs-number">1</span>] == <span class="hljs-number">0</span>)<br>                &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>                &#125;<br>            &#125;<br>            cout &lt;&lt; <span class="hljs-string">&quot;Your file name of output&quot;</span> &lt;&lt; endl;<br>            cin &gt;&gt; output;<br>            <span class="hljs-built_in">zip</span>(input, output);<br>            cout &lt;&lt; <span class="hljs-string">&quot;Zip behaviour is complete&quot;</span> &lt;&lt; endl<br>                 &lt;&lt; endl;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<span class="hljs-comment">//unzip</span><br>            cout &lt;&lt; <span class="hljs-string">&quot;Your file name of input&quot;</span> &lt;&lt; endl;<br>            cin &gt;&gt; input;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-built_in">file_name</span>(input) == <span class="hljs-literal">false</span>)<br>            &#123;<br>                cin &gt;&gt; input;<br>                <span class="hljs-keyword">if</span> (input[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;0&#x27;</span> &amp;&amp; input[<span class="hljs-number">1</span>] == <span class="hljs-number">0</span>)<br>                &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>                &#125;<br>            &#125;<br>            cout &lt;&lt; <span class="hljs-string">&quot;Your file name of output&quot;</span> &lt;&lt; endl;<br>            cin &gt;&gt; output;<br>            <span class="hljs-built_in">unzip</span>(input, output);<br>            cout &lt;&lt; <span class="hljs-string">&quot;Unzip behaviour is complete&quot;</span> &lt;&lt; endl<br>                 &lt;&lt; endl;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<span class="hljs-comment">//exit</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            cout &lt;&lt; <span class="hljs-string">&quot;Your Input is not allowed&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="ç›®å‰çš„é—®é¢˜"><a href="#ç›®å‰çš„é—®é¢˜" class="headerlink" title="ç›®å‰çš„é—®é¢˜"></a>ç›®å‰çš„é—®é¢˜</h3><p>åœ¨ä»£ç æ³¨é‡Šä¸­æåŠè¿‡ï¼Œè§£å‹ç¼©æ˜¯ä¸èƒ½å¤ŸéªŒè¯å‹ç¼©çš„æ–‡ä»¶æ˜¯å¦æ˜¯Huffmanå‹ç¼©ç®—æ³•ç”Ÿæˆçš„ï¼Œå¦‚æœç›´æ¥è§£å‹ä¸€ä¸ªæ­£å¸¸çš„æ–‡ä»¶ï¼Œä¼šè§£å‹å‡ºæ¥ä¸€ä¸ªå‹ç¼©ç‚¸å¼¹æˆ–è€…ä¸€ä¸ªå•¥ä¹Ÿæ²¡æœ‰ã€‚ä¸ä¹‹é…å¥—çš„å‹ç¼©ç®—æ³•ä¸­ä¹Ÿæ²¡æœ‰åŠ å…¥ç›¸åº”çš„éªŒè¯ç¨‹åºã€‚æ²¡æœ‰å¯¹å•ä¸€å­—èŠ‚ç±»å‹è¿›è¡Œç‰¹åŒ–å¤„ç†ï¼Œæ¯”å¦‚è¯´ï¼Œå‹ç¼©ä¸€ä¸ªæ–‡æœ¬å…¨éƒ¨æ˜¯â€œaâ€çš„æ–‡æœ¬æ–‡ä»¶ä¼šä¸¢å¤±æ•°æ®ï¼Œå› ä¸ºåœ¨å»ºç«‹å“ˆå¤«æ›¼æ ‘çš„æ—¶å€™æ²¡æœ‰ç‰¹åŒ–è€ƒè™‘åªæœ‰ä¸€ç§å­—èŠ‚ç±»å‹çš„æƒ…å†µï¼Œä¹‹åä¿®æ”¹åŠ å…¥ã€‚</p><h3 id="æ²¡äº†"><a href="#æ²¡äº†" class="headerlink" title="æ²¡äº†"></a>æ²¡äº†</h3><p>ä½œä¸‹æ­¤æ–‡ï¼Œåªæ˜¯è®°ä¸€æ¬¡è¢«è¿«ä»é›¶å¼€å§‹å®Œæˆä¸€ä¸ªæ•°æ®ç»“æ„ä½œä¸šï¼Œ~<br>dissä¸€ä¸‹qhyã€‚åº”è¯¥ä¸ä¼šæœ‰äººè®¤å‡ºæ¥å§ã€‚å¦‚æœæ°å·§ä¹Ÿæ˜¯è¿™ä¸ªè€å¸ˆæ•™å­¦çš„ï¼Œ~</p>]]></content>
    
    
    
    <tags>
      
      <tag>å­¦ä¹ </tag>
      
      <tag>æ•°æ®ç»“æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
